{"ast":null,"code":"'use strict';\n\nvar Point = require('./types/Point');\n\nvar attrRegexps = {};\n\nfunction getAttrRegexp(attrName) {\n  if (attrRegexps[attrName]) {\n    return attrRegexps[attrName];\n  }\n\n  attrRegexps[attrName] = new RegExp(' ' + attrName + '=\"((?:\\\\\\\\(?=\")\"|[^\"])+)\"', 'i');\n  return attrRegexps[attrName];\n}\n\nfunction setHtmlAttribute(html, attrName, value) {\n  var attr = ' ' + attrName + '=\"' + value + '\"';\n\n  if (html.indexOf(' ' + attrName + '=\"') === -1) {\n    html = html.replace(/<[a-z]+/i, function (beginning) {\n      return beginning + attr;\n    });\n  } else {\n    html = html.replace(getAttrRegexp(attrName), attr);\n  }\n\n  return html;\n}\n\nfunction fixed(number) {\n  return number.toFixed(3).replace('.000', '');\n}\n\nfunction mod(a, n) {\n  return a >= n ? a % n : a >= 0 ? a : n - 1 - (-1 - a) % n;\n}\n\nfunction xprod(p1, p2) {\n  return p1.x * p2.y - p1.y * p2.x;\n}\n\nfunction cyclic(a, b, c) {\n  if (a <= c) {\n    return a <= b && b < c;\n  } else {\n    return a <= b || b < c;\n  }\n}\n\nfunction sign(i) {\n  return i > 0 ? 1 : i < 0 ? -1 : 0;\n}\n\nfunction quadform(Q, w) {\n  var v = new Array(3),\n      i,\n      j,\n      sum;\n  v[0] = w.x;\n  v[1] = w.y;\n  v[2] = 1;\n  sum = 0.0;\n\n  for (i = 0; i < 3; i++) {\n    for (j = 0; j < 3; j++) {\n      sum += v[i] * Q.at(i, j) * v[j];\n    }\n  }\n\n  return sum;\n}\n\nfunction interval(lambda, a, b) {\n  var res = new Point();\n  res.x = a.x + lambda * (b.x - a.x);\n  res.y = a.y + lambda * (b.y - a.y);\n  return res;\n}\n\nfunction dorth_infty(p0, p2) {\n  var r = new Point();\n  r.y = sign(p2.x - p0.x);\n  r.x = -sign(p2.y - p0.y);\n  return r;\n}\n\nfunction ddenom(p0, p2) {\n  var r = dorth_infty(p0, p2);\n  return r.y * (p2.x - p0.x) - r.x * (p2.y - p0.y);\n}\n\nfunction dpara(p0, p1, p2) {\n  var x1, y1, x2, y2;\n  x1 = p1.x - p0.x;\n  y1 = p1.y - p0.y;\n  x2 = p2.x - p0.x;\n  y2 = p2.y - p0.y;\n  return x1 * y2 - x2 * y1;\n}\n\nfunction cprod(p0, p1, p2, p3) {\n  var x1, y1, x2, y2;\n  x1 = p1.x - p0.x;\n  y1 = p1.y - p0.y;\n  x2 = p3.x - p2.x;\n  y2 = p3.y - p2.y;\n  return x1 * y2 - x2 * y1;\n}\n\nfunction iprod(p0, p1, p2) {\n  var x1, y1, x2, y2;\n  x1 = p1.x - p0.x;\n  y1 = p1.y - p0.y;\n  x2 = p2.x - p0.x;\n  y2 = p2.y - p0.y;\n  return x1 * x2 + y1 * y2;\n}\n\nfunction iprod1(p0, p1, p2, p3) {\n  var x1, y1, x2, y2;\n  x1 = p1.x - p0.x;\n  y1 = p1.y - p0.y;\n  x2 = p3.x - p2.x;\n  y2 = p3.y - p2.y;\n  return x1 * x2 + y1 * y2;\n}\n\nfunction ddist(p, q) {\n  return Math.sqrt((p.x - q.x) * (p.x - q.x) + (p.y - q.y) * (p.y - q.y));\n}\n\nmodule.exports = {\n  luminance: function (r, g, b) {\n    return Math.round(0.2126 * r + 0.7153 * g + 0.0721 * b);\n  },\n  between: function (val, min, max) {\n    return val >= min && val <= max;\n  },\n  clamp: function (val, min, max) {\n    return Math.min(max, Math.max(min, val));\n  },\n  isNumber: function (val) {\n    return typeof val === 'number';\n  },\n  setHtmlAttr: setHtmlAttribute,\n\n  /**\r\n   * Generates path instructions for given curve\r\n   *\r\n   * @param {Curve} curve\r\n   * @param {Number} [scale]\r\n   * @returns {string}\r\n   */\n  renderCurve: function (curve, scale) {\n    scale = scale || 1;\n    var startingPoint = curve.c[(curve.n - 1) * 3 + 2];\n    var path = 'M ' + fixed(startingPoint.x * scale) + ' ' + fixed(startingPoint.y * scale) + ' ';\n    curve.tag.forEach(function (tag, i) {\n      var i3 = i * 3;\n      var p0 = curve.c[i3];\n      var p1 = curve.c[i3 + 1];\n      var p2 = curve.c[i3 + 2];\n\n      if (tag === \"CURVE\") {\n        path += 'C ';\n        path += fixed(p0.x * scale) + ' ' + fixed(p0.y * scale) + ', ';\n        path += fixed(p1.x * scale) + ' ' + fixed(p1.y * scale) + ', ';\n        path += fixed(p2.x * scale) + ' ' + fixed(p2.y * scale) + ' ';\n      } else if (tag === \"CORNER\") {\n        path += 'L ';\n        path += fixed(p1.x * scale) + ' ' + fixed(p1.y * scale) + ' ';\n        path += fixed(p2.x * scale) + ' ' + fixed(p2.y * scale) + ' ';\n      }\n    });\n    return path;\n  },\n  bezier: function bezier(t, p0, p1, p2, p3) {\n    var s = 1 - t,\n        res = new Point();\n    res.x = s * s * s * p0.x + 3 * (s * s * t) * p1.x + 3 * (t * t * s) * p2.x + t * t * t * p3.x;\n    res.y = s * s * s * p0.y + 3 * (s * s * t) * p1.y + 3 * (t * t * s) * p2.y + t * t * t * p3.y;\n    return res;\n  },\n  tangent: function tangent(p0, p1, p2, p3, q0, q1) {\n    var A, B, C, a, b, c, d, s, r1, r2;\n    A = cprod(p0, p1, q0, q1);\n    B = cprod(p1, p2, q0, q1);\n    C = cprod(p2, p3, q0, q1);\n    a = A - 2 * B + C;\n    b = -2 * A + 2 * B;\n    c = A;\n    d = b * b - 4 * a * c;\n\n    if (a === 0 || d < 0) {\n      return -1.0;\n    }\n\n    s = Math.sqrt(d);\n    r1 = (-b + s) / (2 * a);\n    r2 = (-b - s) / (2 * a);\n\n    if (r1 >= 0 && r1 <= 1) {\n      return r1;\n    } else if (r2 >= 0 && r2 <= 1) {\n      return r2;\n    } else {\n      return -1.0;\n    }\n  },\n  mod: mod,\n  xprod: xprod,\n  cyclic: cyclic,\n  sign: sign,\n  quadform: quadform,\n  interval: interval,\n  dorth_infty: dorth_infty,\n  ddenom: ddenom,\n  dpara: dpara,\n  cprod: cprod,\n  iprod: iprod,\n  iprod1: iprod1,\n  ddist: ddist\n};","map":{"version":3,"sources":["/Users/zakstratton/Documents/design-tool/node_modules/potrace/lib/utils.js"],"names":["Point","require","attrRegexps","getAttrRegexp","attrName","RegExp","setHtmlAttribute","html","value","attr","indexOf","replace","beginning","fixed","number","toFixed","mod","a","n","xprod","p1","p2","x","y","cyclic","b","c","sign","i","quadform","Q","w","v","Array","j","sum","at","interval","lambda","res","dorth_infty","p0","r","ddenom","dpara","x1","y1","x2","y2","cprod","p3","iprod","iprod1","ddist","p","q","Math","sqrt","module","exports","luminance","g","round","between","val","min","max","clamp","isNumber","setHtmlAttr","renderCurve","curve","scale","startingPoint","path","tag","forEach","i3","bezier","t","s","tangent","q0","q1","A","B","C","d","r1","r2"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar Point = require('./types/Point');\r\nvar attrRegexps = {};\r\n\r\nfunction getAttrRegexp(attrName) {\r\n  if (attrRegexps[attrName]) {\r\n    return attrRegexps[attrName];\r\n  }\r\n\r\n  attrRegexps[attrName] = new RegExp(' ' + attrName + '=\"((?:\\\\\\\\(?=\")\"|[^\"])+)\"', 'i');\r\n  return attrRegexps[attrName];\r\n}\r\n\r\nfunction setHtmlAttribute(html, attrName, value) {\r\n  var attr = ' ' + attrName + '=\"' + value + '\"';\r\n\r\n  if (html.indexOf(' ' + attrName + '=\"') === -1) {\r\n    html = html.replace(/<[a-z]+/i, function(beginning) { return beginning + attr; });\r\n  } else {\r\n    html = html.replace(getAttrRegexp(attrName), attr);\r\n  }\r\n\r\n  return html;\r\n}\r\n\r\nfunction fixed(number) {\r\n  return number.toFixed(3).replace('.000', '');\r\n}\r\n\r\nfunction mod(a, n) {\r\n  return a >= n ? a % n : a>=0 ? a : n-1-(-1-a) % n;\r\n}\r\n\r\nfunction xprod(p1, p2) {\r\n  return p1.x * p2.y - p1.y * p2.x;\r\n}\r\n\r\nfunction cyclic(a, b, c) {\r\n  if (a <= c) {\r\n    return (a <= b && b < c);\r\n  } else {\r\n    return (a <= b || b < c);\r\n  }\r\n}\r\n\r\nfunction sign(i) {\r\n  return i > 0 ? 1 : i < 0 ? -1 : 0;\r\n}\r\n\r\nfunction quadform(Q, w) {\r\n  var v = new Array(3), i, j, sum;\r\n\r\n  v[0] = w.x;\r\n  v[1] = w.y;\r\n  v[2] = 1;\r\n  sum = 0.0;\r\n\r\n  for (i=0; i<3; i++) {\r\n    for (j=0; j<3; j++) {\r\n      sum += v[i] * Q.at(i, j) * v[j];\r\n    }\r\n  }\r\n  return sum;\r\n}\r\n\r\nfunction interval(lambda, a, b) {\r\n  var res = new Point();\r\n\r\n  res.x = a.x + lambda * (b.x - a.x);\r\n  res.y = a.y + lambda * (b.y - a.y);\r\n  return res;\r\n}\r\n\r\nfunction dorth_infty(p0, p2) {\r\n  var r = new Point();\r\n\r\n  r.y = sign(p2.x - p0.x);\r\n  r.x = -sign(p2.y - p0.y);\r\n\r\n  return r;\r\n}\r\n\r\nfunction ddenom(p0, p2) {\r\n  var r = dorth_infty(p0, p2);\r\n\r\n  return r.y * (p2.x - p0.x) - r.x * (p2.y - p0.y);\r\n}\r\n\r\nfunction dpara(p0, p1, p2) {\r\n  var x1, y1, x2, y2;\r\n\r\n  x1 = p1.x - p0.x;\r\n  y1 = p1.y - p0.y;\r\n  x2 = p2.x - p0.x;\r\n  y2 = p2.y - p0.y;\r\n\r\n  return x1 * y2 - x2 * y1;\r\n}\r\n\r\nfunction cprod(p0, p1, p2, p3) {\r\n  var x1, y1, x2, y2;\r\n\r\n  x1 = p1.x - p0.x;\r\n  y1 = p1.y - p0.y;\r\n  x2 = p3.x - p2.x;\r\n  y2 = p3.y - p2.y;\r\n\r\n  return x1 * y2 - x2 * y1;\r\n}\r\n\r\nfunction iprod(p0, p1, p2) {\r\n  var x1, y1, x2, y2;\r\n\r\n  x1 = p1.x - p0.x;\r\n  y1 = p1.y - p0.y;\r\n  x2 = p2.x - p0.x;\r\n  y2 = p2.y - p0.y;\r\n\r\n  return x1*x2 + y1*y2;\r\n}\r\n\r\nfunction iprod1(p0, p1, p2, p3) {\r\n  var x1, y1, x2, y2;\r\n\r\n  x1 = p1.x - p0.x;\r\n  y1 = p1.y - p0.y;\r\n  x2 = p3.x - p2.x;\r\n  y2 = p3.y - p2.y;\r\n\r\n  return x1 * x2 + y1 * y2;\r\n}\r\n\r\nfunction ddist(p, q) {\r\n  return Math.sqrt((p.x - q.x) * (p.x - q.x) + (p.y - q.y) * (p.y - q.y));\r\n}\r\n\r\nmodule.exports = {\r\n  luminance: function (r, g, b) {\r\n    return Math.round(0.2126 * r + 0.7153 * g + 0.0721 * b);\r\n  },\r\n\r\n  between: function(val, min, max) {\r\n    return val >= min && val <= max;\r\n  },\r\n\r\n  clamp: function(val, min, max) {\r\n    return Math.min(max, Math.max(min, val));\r\n  },\r\n  \r\n  isNumber: function(val) {\r\n    return typeof val === 'number';\r\n  },\r\n\r\n  setHtmlAttr: setHtmlAttribute,\r\n\r\n  /**\r\n   * Generates path instructions for given curve\r\n   *\r\n   * @param {Curve} curve\r\n   * @param {Number} [scale]\r\n   * @returns {string}\r\n   */\r\n  renderCurve: function(curve, scale) {\r\n    scale = scale || 1;\r\n\r\n    var startingPoint = curve.c[(curve.n - 1) * 3 + 2];\r\n\r\n    var path = 'M '\r\n      + fixed(startingPoint.x * scale) + ' '\r\n      + fixed(startingPoint.y * scale) + ' ';\r\n\r\n    curve.tag.forEach(function(tag, i) {\r\n      var i3 = i * 3;\r\n      var p0 = curve.c[i3];\r\n      var p1 = curve.c[i3 + 1];\r\n      var p2 = curve.c[i3 + 2];\r\n\r\n      if (tag === \"CURVE\") {\r\n        path += 'C ';\r\n        path += fixed(p0.x * scale) + ' ' + fixed(p0.y * scale) + ', ';\r\n        path += fixed(p1.x * scale) + ' ' + fixed(p1.y * scale) + ', ';\r\n        path += fixed(p2.x * scale) + ' ' + fixed(p2.y * scale) + ' ';\r\n      } else if (tag === \"CORNER\") {\r\n        path += 'L ';\r\n        path += fixed(p1.x * scale) + ' ' + fixed(p1.y * scale) + ' ';\r\n        path += fixed(p2.x * scale) + ' ' + fixed(p2.y * scale) + ' ';\r\n      }\r\n    });\r\n\r\n    return path;\r\n  },\r\n  \r\n  bezier: function bezier(t, p0, p1, p2, p3) {\r\n    var s = 1 - t, res = new Point();\r\n\r\n    res.x = s*s*s*p0.x + 3*(s*s*t)*p1.x + 3*(t*t*s)*p2.x + t*t*t*p3.x;\r\n    res.y = s*s*s*p0.y + 3*(s*s*t)*p1.y + 3*(t*t*s)*p2.y + t*t*t*p3.y;\r\n\r\n    return res;\r\n  },\r\n\r\n  tangent: function tangent(p0, p1, p2, p3, q0, q1) {\r\n    var A, B, C, a, b, c, d, s, r1, r2;\r\n\r\n    A = cprod(p0, p1, q0, q1);\r\n    B = cprod(p1, p2, q0, q1);\r\n    C = cprod(p2, p3, q0, q1);\r\n\r\n    a = A - 2 * B + C;\r\n    b = -2 * A + 2 * B;\r\n    c = A;\r\n\r\n    d = b * b - 4 * a * c;\r\n\r\n    if (a===0 || d<0) {\r\n      return -1.0;\r\n    }\r\n\r\n    s = Math.sqrt(d);\r\n\r\n    r1 = (-b + s) / (2 * a);\r\n    r2 = (-b - s) / (2 * a);\r\n\r\n    if (r1 >= 0 && r1 <= 1) {\r\n      return r1;\r\n    } else if (r2 >= 0 && r2 <= 1) {\r\n      return r2;\r\n    } else {\r\n      return -1.0;\r\n    }\r\n  },\r\n\r\n  mod: mod,\r\n  xprod: xprod,\r\n  cyclic: cyclic,\r\n  sign: sign,\r\n  quadform: quadform,\r\n  interval: interval,\r\n  dorth_infty: dorth_infty,\r\n  ddenom: ddenom,\r\n  dpara: dpara,\r\n  cprod: cprod,\r\n  iprod: iprod,\r\n  iprod1: iprod1,\r\n  ddist: ddist\r\n};"]},"metadata":{},"sourceType":"script"}