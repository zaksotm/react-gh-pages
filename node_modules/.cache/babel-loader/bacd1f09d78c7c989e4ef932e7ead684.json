{"ast":null,"code":"// Generated by CoffeeScript 1.6.2\n(function () {\n  var $,\n      Analyze,\n      Blender,\n      Calculate,\n      Caman,\n      CamanParser,\n      Canvas,\n      Convert,\n      Event,\n      Fiber,\n      Filter,\n      IO,\n      Image,\n      Layer,\n      Log,\n      Module,\n      Pixel,\n      Plugin,\n      Renderer,\n      Root,\n      Store,\n      Util,\n      fs,\n      moduleKeywords,\n      slice,\n      vignetteFilters,\n      __indexOf = [].indexOf || function (item) {\n    for (var i = 0, l = this.length; i < l; i++) {\n      if (i in this && this[i] === item) return i;\n    }\n\n    return -1;\n  },\n      __slice = [].slice,\n      __hasProp = {}.hasOwnProperty,\n      __bind = function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n      __extends = function (child, parent) {\n    for (var key in parent) {\n      if (__hasProp.call(parent, key)) child[key] = parent[key];\n    }\n\n    function ctor() {\n      this.constructor = child;\n    }\n\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n    child.__super__ = parent.prototype;\n    return child;\n  };\n\n  moduleKeywords = ['extended', 'included'];\n\n  Module = function () {\n    function Module() {}\n\n    Module[\"extends\"] = function (obj) {\n      var key, value, _ref;\n\n      for (key in obj) {\n        value = obj[key];\n\n        if (__indexOf.call(moduleKeywords, key) < 0) {\n          this[key] = value;\n        }\n      }\n\n      if ((_ref = obj.extended) != null) {\n        _ref.apply(this);\n      }\n\n      return this;\n    };\n\n    Module.includes = function (obj) {\n      var key, value, _ref;\n\n      for (key in obj) {\n        value = obj[key];\n\n        if (__indexOf.call(moduleKeywords, key) < 0) {\n          this.prototype[key] = value;\n        }\n      }\n\n      if ((_ref = obj.included) != null) {\n        _ref.apply(this);\n      }\n\n      return this;\n    };\n\n    Module.delegate = function () {\n      var args, source, target, _i, _len, _results;\n\n      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n      target = args.pop();\n      _results = [];\n\n      for (_i = 0, _len = args.length; _i < _len; _i++) {\n        source = args[_i];\n\n        _results.push(this.prototype[source] = target.prototype[source]);\n      }\n\n      return _results;\n    };\n\n    Module.aliasFunction = function (to, from) {\n      var _this = this;\n\n      return this.prototype[to] = function () {\n        var args;\n        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n        return _this.prototype[from].apply(_this, args);\n      };\n    };\n\n    Module.aliasProperty = function (to, from) {\n      return Object.defineProperty(this.prototype, to, {\n        get: function () {\n          return this[from];\n        },\n        set: function (val) {\n          return this[from] = val;\n        }\n      });\n    };\n\n    Module.included = function (func) {\n      return func.call(this, this.prototype);\n    };\n\n    return Module;\n  }();\n\n  slice = Array.prototype.slice;\n\n  $ = function (sel, root) {\n    if (root == null) {\n      root = document;\n    }\n\n    if (typeof sel === \"object\" || typeof exports !== \"undefined\" && exports !== null) {\n      return sel;\n    }\n\n    return root.querySelector(sel);\n  };\n\n  Util = function () {\n    function Util() {}\n\n    Util.uniqid = function () {\n      var id;\n      id = 0;\n      return {\n        get: function () {\n          return id++;\n        }\n      };\n    }();\n\n    Util.extend = function () {\n      var copy, dest, obj, prop, src, _i, _len;\n\n      obj = arguments[0], src = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      dest = obj;\n\n      for (_i = 0, _len = src.length; _i < _len; _i++) {\n        copy = src[_i];\n\n        for (prop in copy) {\n          if (!__hasProp.call(copy, prop)) continue;\n          dest[prop] = copy[prop];\n        }\n      }\n\n      return dest;\n    };\n\n    Util.clampRGB = function (val) {\n      if (val < 0) {\n        return 0;\n      }\n\n      if (val > 255) {\n        return 255;\n      }\n\n      return val;\n    };\n\n    Util.copyAttributes = function (from, to, opts) {\n      var attr, _i, _len, _ref, _ref1, _results;\n\n      if (opts == null) {\n        opts = {};\n      }\n\n      _ref = from.attributes;\n      _results = [];\n\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        attr = _ref[_i];\n\n        if (opts.except != null && (_ref1 = attr.nodeName, __indexOf.call(opts.except, _ref1) >= 0)) {\n          continue;\n        }\n\n        _results.push(to.setAttribute(attr.nodeName, attr.nodeValue));\n      }\n\n      return _results;\n    };\n\n    Util.dataArray = function (length) {\n      if (length == null) {\n        length = 0;\n      }\n\n      if (Caman.NodeJS || window.Uint8Array != null) {\n        return new Uint8Array(length);\n      }\n\n      return new Array(length);\n    };\n\n    return Util;\n  }();\n\n  if (typeof exports !== \"undefined\" && exports !== null) {\n    Root = exports;\n    Canvas = require('canvas');\n    Image = Canvas.Image;\n    Fiber = require('fibers');\n    fs = require('fs');\n  } else {\n    Root = window;\n  }\n\n  Caman = function (_super) {\n    __extends(Caman, _super);\n\n    Caman.version = {\n      release: \"4.1.2\",\n      date: \"7/27/2013\"\n    };\n    Caman.DEBUG = false;\n    Caman.allowRevert = true;\n    Caman.crossOrigin = \"anonymous\";\n    Caman.remoteProxy = \"\";\n    Caman.proxyParam = \"camanProxyUrl\";\n    Caman.NodeJS = typeof exports !== \"undefined\" && exports !== null;\n    Caman.autoload = !Caman.NodeJS;\n\n    Caman.toString = function () {\n      return \"Version \" + Caman.version.release + \", Released \" + Caman.version.date;\n    };\n\n    Caman.getAttrId = function (canvas) {\n      if (Caman.NodeJS) {\n        return true;\n      }\n\n      if (typeof canvas === \"string\") {\n        canvas = $(canvas);\n      }\n\n      if (!(canvas != null && canvas.getAttribute != null)) {\n        return null;\n      }\n\n      return canvas.getAttribute('data-caman-id');\n    };\n\n    function Caman() {\n      this.nodeFileReady = __bind(this.nodeFileReady, this);\n\n      var args,\n          callback,\n          id,\n          _this = this;\n\n      if (arguments.length === 0) {\n        throw \"Invalid arguments\";\n      }\n\n      if (this instanceof Caman) {\n        this.finishInit = this.finishInit.bind(this);\n        this.imageLoaded = this.imageLoaded.bind(this);\n        args = arguments[0];\n\n        if (!Caman.NodeJS) {\n          id = parseInt(Caman.getAttrId(args[0]), 10);\n          callback = typeof args[1] === \"function\" ? args[1] : typeof args[2] === \"function\" ? args[2] : function () {};\n\n          if (!isNaN(id) && Store.has(id)) {\n            return Store.execute(id, callback);\n          }\n        }\n\n        this.id = Util.uniqid.get();\n        this.initializedPixelData = this.originalPixelData = null;\n        this.cropCoordinates = {\n          x: 0,\n          y: 0\n        };\n        this.cropped = false;\n        this.resized = false;\n        this.pixelStack = [];\n        this.layerStack = [];\n        this.canvasQueue = [];\n        this.currentLayer = null;\n        this.scaled = false;\n        this.analyze = new Analyze(this);\n        this.renderer = new Renderer(this);\n        this.domIsLoaded(function () {\n          _this.parseArguments(args);\n\n          return _this.setup();\n        });\n        return this;\n      } else {\n        return new Caman(arguments);\n      }\n    }\n\n    Caman.prototype.domIsLoaded = function (cb) {\n      var listener,\n          _this = this;\n\n      if (Caman.NodeJS) {\n        return setTimeout(function () {\n          return cb.call(_this);\n        }, 0);\n      } else {\n        if (document.readyState === \"complete\") {\n          Log.debug(\"DOM initialized\");\n          return setTimeout(function () {\n            return cb.call(_this);\n          }, 0);\n        } else {\n          listener = function () {\n            if (document.readyState === \"complete\") {\n              Log.debug(\"DOM initialized\");\n              return cb.call(_this);\n            }\n          };\n\n          return document.addEventListener(\"readystatechange\", listener, false);\n        }\n      }\n    };\n\n    Caman.prototype.parseArguments = function (args) {\n      var key, val, _ref, _results;\n\n      if (args.length === 0) {\n        throw \"Invalid arguments given\";\n      }\n\n      this.initObj = null;\n      this.initType = null;\n      this.imageUrl = null;\n\n      this.callback = function () {};\n\n      this.setInitObject(args[0]);\n\n      if (args.length === 1) {\n        return;\n      }\n\n      switch (typeof args[1]) {\n        case \"string\":\n          this.imageUrl = args[1];\n          break;\n\n        case \"function\":\n          this.callback = args[1];\n      }\n\n      if (args.length === 2) {\n        return;\n      }\n\n      this.callback = args[2];\n\n      if (args.length === 4) {\n        _ref = args[4];\n        _results = [];\n\n        for (key in _ref) {\n          if (!__hasProp.call(_ref, key)) continue;\n          val = _ref[key];\n\n          _results.push(this.options[key] = val);\n        }\n\n        return _results;\n      }\n    };\n\n    Caman.prototype.setInitObject = function (obj) {\n      if (Caman.NodeJS) {\n        this.initObj = obj;\n        this.initType = 'node';\n        return;\n      }\n\n      if (typeof obj === \"object\") {\n        this.initObj = obj;\n      } else {\n        this.initObj = $(obj);\n      }\n\n      if (this.initObj == null) {\n        throw \"Could not find image or canvas for initialization.\";\n      }\n\n      return this.initType = this.initObj.nodeName.toLowerCase();\n    };\n\n    Caman.prototype.setup = function () {\n      switch (this.initType) {\n        case \"node\":\n          return this.initNode();\n\n        case \"img\":\n          return this.initImage();\n\n        case \"canvas\":\n          return this.initCanvas();\n      }\n    };\n\n    Caman.prototype.initNode = function () {\n      Log.debug(\"Initializing for NodeJS\");\n\n      if (typeof this.initObj === \"string\") {\n        return fs.readFile(this.initObj, this.nodeFileReady);\n      } else {\n        return this.nodeFileReady(null, this.initObj);\n      }\n    };\n\n    Caman.prototype.nodeFileReady = function (err, data) {\n      if (err) {\n        throw err;\n      }\n\n      this.image = new Image();\n      this.image.src = data;\n      Log.debug(\"Image loaded. Width = \" + this.imageWidth() + \", Height = \" + this.imageHeight());\n      this.canvas = new Canvas(this.imageWidth(), this.imageHeight());\n      return this.finishInit();\n    };\n\n    Caman.prototype.initImage = function () {\n      this.image = this.initObj;\n      this.canvas = document.createElement('canvas');\n      this.context = this.canvas.getContext('2d');\n      Util.copyAttributes(this.image, this.canvas, {\n        except: ['src']\n      });\n      this.image.parentNode.replaceChild(this.canvas, this.image);\n      this.imageAdjustments();\n      return this.waitForImageLoaded();\n    };\n\n    Caman.prototype.initCanvas = function () {\n      this.canvas = this.initObj;\n      this.context = this.canvas.getContext('2d');\n\n      if (this.imageUrl != null) {\n        this.image = document.createElement('img');\n        this.image.src = this.imageUrl;\n        this.imageAdjustments();\n        return this.waitForImageLoaded();\n      } else {\n        return this.finishInit();\n      }\n    };\n\n    Caman.prototype.imageAdjustments = function () {\n      if (this.needsHiDPISwap()) {\n        Log.debug(this.image.src, \"->\", this.hiDPIReplacement());\n        this.swapped = true;\n        this.image.src = this.hiDPIReplacement();\n      }\n\n      if (IO.isRemote(this.image)) {\n        this.image.src = IO.proxyUrl(this.image.src);\n        return Log.debug(\"Remote image detected, using URL = \" + this.image.src);\n      }\n    };\n\n    Caman.prototype.waitForImageLoaded = function () {\n      if (this.isImageLoaded()) {\n        return this.imageLoaded();\n      } else {\n        return this.image.onload = this.imageLoaded;\n      }\n    };\n\n    Caman.prototype.isImageLoaded = function () {\n      if (!this.image.complete) {\n        return false;\n      }\n\n      if (this.image.naturalWidth != null && this.image.naturalWidth === 0) {\n        return false;\n      }\n\n      return true;\n    };\n\n    Caman.prototype.imageWidth = function () {\n      return this.image.width || this.image.naturalWidth;\n    };\n\n    Caman.prototype.imageHeight = function () {\n      return this.image.height || this.image.naturalHeight;\n    };\n\n    Caman.prototype.imageLoaded = function () {\n      Log.debug(\"Image loaded. Width = \" + this.imageWidth() + \", Height = \" + this.imageHeight());\n\n      if (this.swapped) {\n        this.canvas.width = this.imageWidth() / this.hiDPIRatio();\n        this.canvas.height = this.imageHeight() / this.hiDPIRatio();\n      } else {\n        this.canvas.width = this.imageWidth();\n        this.canvas.height = this.imageHeight();\n      }\n\n      return this.finishInit();\n    };\n\n    Caman.prototype.finishInit = function () {\n      var i, pixel, _i, _len, _ref;\n\n      if (this.context == null) {\n        this.context = this.canvas.getContext('2d');\n      }\n\n      this.originalWidth = this.preScaledWidth = this.width = this.canvas.width;\n      this.originalHeight = this.preScaledHeight = this.height = this.canvas.height;\n      this.hiDPIAdjustments();\n\n      if (!this.hasId()) {\n        this.assignId();\n      }\n\n      if (this.image != null) {\n        this.context.drawImage(this.image, 0, 0, this.imageWidth(), this.imageHeight(), 0, 0, this.preScaledWidth, this.preScaledHeight);\n      }\n\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      this.pixelData = this.imageData.data;\n\n      if (Caman.allowRevert) {\n        this.initializedPixelData = Util.dataArray(this.pixelData.length);\n        this.originalPixelData = Util.dataArray(this.pixelData.length);\n        _ref = this.pixelData;\n\n        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n          pixel = _ref[i];\n          this.initializedPixelData[i] = pixel;\n          this.originalPixelData[i] = pixel;\n        }\n      }\n\n      this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n\n      if (!Caman.NodeJS) {\n        Store.put(this.id, this);\n      }\n\n      this.callback.call(this, this);\n      return this.callback = function () {};\n    };\n\n    Caman.prototype.reloadCanvasData = function () {\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      return this.pixelData = this.imageData.data;\n    };\n\n    Caman.prototype.resetOriginalPixelData = function () {\n      var i, pixel, _i, _len, _ref, _results;\n\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n\n      this.originalPixelData = Util.dataArray(this.pixelData.length);\n      _ref = this.pixelData;\n      _results = [];\n\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n\n        _results.push(this.originalPixelData[i] = pixel);\n      }\n\n      return _results;\n    };\n\n    Caman.prototype.hasId = function () {\n      return Caman.getAttrId(this.canvas) != null;\n    };\n\n    Caman.prototype.assignId = function () {\n      if (Caman.NodeJS || this.canvas.getAttribute('data-caman-id')) {\n        return;\n      }\n\n      return this.canvas.setAttribute('data-caman-id', this.id);\n    };\n\n    Caman.prototype.hiDPIDisabled = function () {\n      return this.canvas.getAttribute('data-caman-hidpi-disabled') !== null;\n    };\n\n    Caman.prototype.hiDPIAdjustments = function () {\n      var ratio;\n\n      if (Caman.NodeJS || !this.needsHiDPISwap()) {\n        return;\n      }\n\n      ratio = this.hiDPIRatio();\n\n      if (ratio !== 1) {\n        Log.debug(\"HiDPI ratio = \" + ratio);\n        this.scaled = true;\n        this.preScaledWidth = this.canvas.width;\n        this.preScaledHeight = this.canvas.height;\n        this.canvas.width = this.preScaledWidth * ratio;\n        this.canvas.height = this.preScaledHeight * ratio;\n        this.canvas.style.width = \"\" + this.preScaledWidth + \"px\";\n        this.canvas.style.height = \"\" + this.preScaledHeight + \"px\";\n        this.context.scale(ratio, ratio);\n        this.width = this.originalWidth = this.canvas.width;\n        return this.height = this.originalHeight = this.canvas.height;\n      }\n    };\n\n    Caman.prototype.hiDPIRatio = function () {\n      var backingStoreRatio, devicePixelRatio;\n      devicePixelRatio = window.devicePixelRatio || 1;\n      backingStoreRatio = this.context.webkitBackingStorePixelRatio || this.context.mozBackingStorePixelRatio || this.context.msBackingStorePixelRatio || this.context.oBackingStorePixelRatio || this.context.backingStorePixelRatio || 1;\n      return devicePixelRatio / backingStoreRatio;\n    };\n\n    Caman.prototype.hiDPICapable = function () {\n      return window.devicePixelRatio != null && window.devicePixelRatio !== 1;\n    };\n\n    Caman.prototype.needsHiDPISwap = function () {\n      if (this.hiDPIDisabled() || !this.hiDPICapable()) {\n        return false;\n      }\n\n      return this.hiDPIReplacement() !== null;\n    };\n\n    Caman.prototype.hiDPIReplacement = function () {\n      if (this.image == null) {\n        return null;\n      }\n\n      return this.image.getAttribute('data-caman-hidpi');\n    };\n\n    Caman.prototype.replaceCanvas = function (newCanvas) {\n      var oldCanvas;\n      oldCanvas = this.canvas;\n      this.canvas = newCanvas;\n      this.context = this.canvas.getContext('2d');\n\n      if (!Caman.NodeJS) {\n        oldCanvas.parentNode.replaceChild(this.canvas, oldCanvas);\n      }\n\n      this.width = this.canvas.width;\n      this.height = this.canvas.height;\n      this.reloadCanvasData();\n      return this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n    };\n\n    Caman.prototype.render = function (callback) {\n      var _this = this;\n\n      if (callback == null) {\n        callback = function () {};\n      }\n\n      Event.trigger(this, \"renderStart\");\n      return this.renderer.execute(function () {\n        _this.context.putImageData(_this.imageData, 0, 0);\n\n        return callback.call(_this);\n      });\n    };\n\n    Caman.prototype.revert = function (updateContext) {\n      var i, pixel, _i, _len, _ref;\n\n      if (updateContext == null) {\n        updateContext = true;\n      }\n\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n\n      _ref = this.originalVisiblePixels();\n\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n        this.pixelData[i] = pixel;\n      }\n\n      if (updateContext) {\n        return this.context.putImageData(this.imageData, 0, 0);\n      }\n    };\n\n    Caman.prototype.reset = function () {\n      var canvas, ctx, i, imageData, pixel, pixelData, _i, _len, _ref;\n\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = this.originalWidth;\n      canvas.height = this.originalHeight;\n      ctx = canvas.getContext('2d');\n      imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      pixelData = imageData.data;\n      _ref = this.initializedPixelData;\n\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n        pixelData[i] = pixel;\n      }\n\n      ctx.putImageData(imageData, 0, 0);\n      this.cropCoordinates = {\n        x: 0,\n        y: 0\n      };\n      this.resized = false;\n      return this.replaceCanvas(canvas);\n    };\n\n    Caman.prototype.originalVisiblePixels = function () {\n      var canvas, coord, ctx, endX, endY, i, imageData, pixel, pixelData, pixels, scaledCanvas, startX, startY, width, _i, _j, _len, _ref, _ref1, _ref2, _ref3;\n\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n\n      pixels = [];\n      startX = this.cropCoordinates.x;\n      endX = startX + this.width;\n      startY = this.cropCoordinates.y;\n      endY = startY + this.height;\n\n      if (this.resized) {\n        canvas = document.createElement('canvas');\n        canvas.width = this.originalWidth;\n        canvas.height = this.originalHeight;\n        ctx = canvas.getContext('2d');\n        imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        pixelData = imageData.data;\n        _ref = this.originalPixelData;\n\n        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n          pixel = _ref[i];\n          pixelData[i] = pixel;\n        }\n\n        ctx.putImageData(imageData, 0, 0);\n        scaledCanvas = document.createElement('canvas');\n        scaledCanvas.width = this.width;\n        scaledCanvas.height = this.height;\n        ctx = scaledCanvas.getContext('2d');\n        ctx.drawImage(canvas, 0, 0, this.originalWidth, this.originalHeight, 0, 0, this.width, this.height);\n        pixelData = ctx.getImageData(0, 0, this.width, this.height).data;\n        width = this.width;\n      } else {\n        pixelData = this.originalPixelData;\n        width = this.originalWidth;\n      }\n\n      for (i = _j = 0, _ref1 = pixelData.length; _j < _ref1; i = _j += 4) {\n        coord = Pixel.locationToCoordinates(i, width);\n\n        if (startX <= (_ref2 = coord.x) && _ref2 < endX && startY <= (_ref3 = coord.y) && _ref3 < endY) {\n          pixels.push(pixelData[i], pixelData[i + 1], pixelData[i + 2], pixelData[i + 3]);\n        }\n      }\n\n      return pixels;\n    };\n\n    Caman.prototype.process = function (name, processFn) {\n      this.renderer.add({\n        type: Filter.Type.Single,\n        name: name,\n        processFn: processFn\n      });\n      return this;\n    };\n\n    Caman.prototype.processKernel = function (name, adjust, divisor, bias) {\n      var i, _i, _ref;\n\n      if (divisor == null) {\n        divisor = null;\n      }\n\n      if (bias == null) {\n        bias = 0;\n      }\n\n      if (divisor == null) {\n        divisor = 0;\n\n        for (i = _i = 0, _ref = adjust.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n          divisor += adjust[i];\n        }\n      }\n\n      this.renderer.add({\n        type: Filter.Type.Kernel,\n        name: name,\n        adjust: adjust,\n        divisor: divisor,\n        bias: bias\n      });\n      return this;\n    };\n\n    Caman.prototype.processPlugin = function (plugin, args) {\n      this.renderer.add({\n        type: Filter.Type.Plugin,\n        plugin: plugin,\n        args: args\n      });\n      return this;\n    };\n\n    Caman.prototype.newLayer = function (callback) {\n      var layer;\n      layer = new Layer(this);\n      this.canvasQueue.push(layer);\n      this.renderer.add({\n        type: Filter.Type.LayerDequeue\n      });\n      callback.call(layer);\n      this.renderer.add({\n        type: Filter.Type.LayerFinished\n      });\n      return this;\n    };\n\n    Caman.prototype.executeLayer = function (layer) {\n      return this.pushContext(layer);\n    };\n\n    Caman.prototype.pushContext = function (layer) {\n      this.layerStack.push(this.currentLayer);\n      this.pixelStack.push(this.pixelData);\n      this.currentLayer = layer;\n      return this.pixelData = layer.pixelData;\n    };\n\n    Caman.prototype.popContext = function () {\n      this.pixelData = this.pixelStack.pop();\n      return this.currentLayer = this.layerStack.pop();\n    };\n\n    Caman.prototype.applyCurrentLayer = function () {\n      return this.currentLayer.applyToParent();\n    };\n\n    return Caman;\n  }(Module);\n\n  Root.Caman = Caman;\n\n  Caman.Analyze = function () {\n    function Analyze(c) {\n      this.c = c;\n    }\n\n    Analyze.prototype.calculateLevels = function () {\n      var i, levels, numPixels, _i, _j, _k, _ref;\n\n      levels = {\n        r: {},\n        g: {},\n        b: {}\n      };\n\n      for (i = _i = 0; _i <= 255; i = ++_i) {\n        levels.r[i] = 0;\n        levels.g[i] = 0;\n        levels.b[i] = 0;\n      }\n\n      for (i = _j = 0, _ref = this.c.pixelData.length; _j < _ref; i = _j += 4) {\n        levels.r[this.c.pixelData[i]]++;\n        levels.g[this.c.pixelData[i + 1]]++;\n        levels.b[this.c.pixelData[i + 2]]++;\n      }\n\n      numPixels = this.c.pixelData.length / 4;\n\n      for (i = _k = 0; _k <= 255; i = ++_k) {\n        levels.r[i] /= numPixels;\n        levels.g[i] /= numPixels;\n        levels.b[i] /= numPixels;\n      }\n\n      return levels;\n    };\n\n    return Analyze;\n  }();\n\n  Analyze = Caman.Analyze;\n\n  Caman.DOMUpdated = function () {\n    var img, imgs, parser, _i, _len, _results;\n\n    imgs = document.querySelectorAll(\"img[data-caman]\");\n\n    if (!(imgs.length > 0)) {\n      return;\n    }\n\n    _results = [];\n\n    for (_i = 0, _len = imgs.length; _i < _len; _i++) {\n      img = imgs[_i];\n\n      _results.push(parser = new CamanParser(img, function () {\n        this.parse();\n        return this.execute();\n      }));\n    }\n\n    return _results;\n  };\n\n  if (Caman.autoload) {\n    (function () {\n      if (document.readyState === \"complete\") {\n        return Caman.DOMUpdated();\n      } else {\n        return document.addEventListener(\"DOMContentLoaded\", Caman.DOMUpdated, false);\n      }\n    })();\n  }\n\n  CamanParser = function () {\n    var INST_REGEX;\n    INST_REGEX = \"(\\\\w+)\\\\((.*?)\\\\)\";\n\n    function CamanParser(ele, ready) {\n      this.dataStr = ele.getAttribute('data-caman');\n      this.caman = Caman(ele, ready.bind(this));\n    }\n\n    CamanParser.prototype.parse = function () {\n      var args, e, filter, func, inst, instFunc, m, r, unparsedInstructions, _i, _len, _ref, _results;\n\n      this.ele = this.caman.canvas;\n      r = new RegExp(INST_REGEX, 'g');\n      unparsedInstructions = this.dataStr.match(r);\n\n      if (!(unparsedInstructions.length > 0)) {\n        return;\n      }\n\n      r = new RegExp(INST_REGEX);\n      _results = [];\n\n      for (_i = 0, _len = unparsedInstructions.length; _i < _len; _i++) {\n        inst = unparsedInstructions[_i];\n        _ref = inst.match(r), m = _ref[0], filter = _ref[1], args = _ref[2];\n        instFunc = new Function(\"return function() {        this.\" + filter + \"(\" + args + \");      };\");\n\n        try {\n          func = instFunc();\n\n          _results.push(func.call(this.caman));\n        } catch (_error) {\n          e = _error;\n\n          _results.push(Log.debug(e));\n        }\n      }\n\n      return _results;\n    };\n\n    CamanParser.prototype.execute = function () {\n      var ele;\n      ele = this.ele;\n      return this.caman.render(function () {\n        return ele.parentNode.replaceChild(this.toImage(), ele);\n      });\n    };\n\n    return CamanParser;\n  }();\n\n  Caman.Blender = function () {\n    function Blender() {}\n\n    Blender.blenders = {};\n\n    Blender.register = function (name, func) {\n      return this.blenders[name] = func;\n    };\n\n    Blender.execute = function (name, rgbaLayer, rgbaParent) {\n      return this.blenders[name](rgbaLayer, rgbaParent);\n    };\n\n    return Blender;\n  }();\n\n  Blender = Caman.Blender;\n\n  Caman.Calculate = function () {\n    function Calculate() {}\n\n    Calculate.distance = function (x1, y1, x2, y2) {\n      return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n    };\n\n    Calculate.randomRange = function (min, max, getFloat) {\n      var rand;\n\n      if (getFloat == null) {\n        getFloat = false;\n      }\n\n      rand = min + Math.random() * (max - min);\n\n      if (getFloat) {\n        return rand.toFixed(getFloat);\n      } else {\n        return Math.round(rand);\n      }\n    };\n\n    Calculate.luminance = function (rgba) {\n      return 0.299 * rgba.r + 0.587 * rgba.g + 0.114 * rgba.b;\n    };\n\n    Calculate.bezier = function (start, ctrl1, ctrl2, end, lowBound, highBound) {\n      var Ax, Ay, Bx, By, Cx, Cy, bezier, curveX, curveY, i, j, leftCoord, rightCoord, t, x0, x1, x2, x3, y0, y1, y2, y3, _i, _j, _k, _ref, _ref1;\n\n      x0 = start[0];\n      y0 = start[1];\n      x1 = ctrl1[0];\n      y1 = ctrl1[1];\n      x2 = ctrl2[0];\n      y2 = ctrl2[1];\n      x3 = end[0];\n      y3 = end[1];\n      bezier = {};\n      Cx = parseInt(3 * (x1 - x0), 10);\n      Bx = 3 * (x2 - x1) - Cx;\n      Ax = x3 - x0 - Cx - Bx;\n      Cy = 3 * (y1 - y0);\n      By = 3 * (y2 - y1) - Cy;\n      Ay = y3 - y0 - Cy - By;\n\n      for (i = _i = 0; _i < 1000; i = ++_i) {\n        t = i / 1000;\n        curveX = Math.round(Ax * Math.pow(t, 3) + Bx * Math.pow(t, 2) + Cx * t + x0);\n        curveY = Math.round(Ay * Math.pow(t, 3) + By * Math.pow(t, 2) + Cy * t + y0);\n\n        if (lowBound && curveY < lowBound) {\n          curveY = lowBound;\n        } else if (highBound && curveY > highBound) {\n          curveY = highBound;\n        }\n\n        bezier[curveX] = curveY;\n      }\n\n      if (bezier.length < end[0] + 1) {\n        for (i = _j = 0, _ref = end[0]; 0 <= _ref ? _j <= _ref : _j >= _ref; i = 0 <= _ref ? ++_j : --_j) {\n          if (bezier[i] == null) {\n            leftCoord = [i - 1, bezier[i - 1]];\n\n            for (j = _k = i, _ref1 = end[0]; i <= _ref1 ? _k <= _ref1 : _k >= _ref1; j = i <= _ref1 ? ++_k : --_k) {\n              if (bezier[j] != null) {\n                rightCoord = [j, bezier[j]];\n                break;\n              }\n            }\n\n            bezier[i] = leftCoord[1] + (rightCoord[1] - leftCoord[1]) / (rightCoord[0] - leftCoord[0]) * (i - leftCoord[0]);\n          }\n        }\n      }\n\n      if (bezier[end[0]] == null) {\n        bezier[end[0]] = bezier[end[0] - 1];\n      }\n\n      return bezier;\n    };\n\n    return Calculate;\n  }();\n\n  Calculate = Caman.Calculate;\n\n  Caman.Convert = function () {\n    function Convert() {}\n\n    Convert.hexToRGB = function (hex) {\n      var b, g, r;\n\n      if (hex.charAt(0) === \"#\") {\n        hex = hex.substr(1);\n      }\n\n      r = parseInt(hex.substr(0, 2), 16);\n      g = parseInt(hex.substr(2, 2), 16);\n      b = parseInt(hex.substr(4, 2), 16);\n      return {\n        r: r,\n        g: g,\n        b: b\n      };\n    };\n\n    Convert.rgbToHSL = function (r, g, b) {\n      var d, h, l, max, min, s;\n\n      if (typeof r === \"object\") {\n        g = r.g;\n        b = r.b;\n        r = r.r;\n      }\n\n      r /= 255;\n      g /= 255;\n      b /= 255;\n      max = Math.max(r, g, b);\n      min = Math.min(r, g, b);\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0;\n      } else {\n        d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n        h = function () {\n          switch (max) {\n            case r:\n              return (g - b) / d + (g < b ? 6 : 0);\n\n            case g:\n              return (b - r) / d + 2;\n\n            case b:\n              return (r - g) / d + 4;\n          }\n        }();\n\n        h /= 6;\n      }\n\n      return {\n        h: h,\n        s: s,\n        l: l\n      };\n    };\n\n    Convert.hslToRGB = function (h, s, l) {\n      var b, g, p, q, r;\n\n      if (typeof h === \"object\") {\n        s = h.s;\n        l = h.l;\n        h = h.h;\n      }\n\n      if (s === 0) {\n        r = g = b = l;\n      } else {\n        q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        p = 2 * l - q;\n        r = this.hueToRGB(p, q, h + 1 / 3);\n        g = this.hueToRGB(p, q, h);\n        b = this.hueToRGB(p, q, h - 1 / 3);\n      }\n\n      return {\n        r: r * 255,\n        g: g * 255,\n        b: b * 255\n      };\n    };\n\n    Convert.hueToRGB = function (p, q, t) {\n      if (t < 0) {\n        t += 1;\n      }\n\n      if (t > 1) {\n        t -= 1;\n      }\n\n      if (t < 1 / 6) {\n        return p + (q - p) * 6 * t;\n      }\n\n      if (t < 1 / 2) {\n        return q;\n      }\n\n      if (t < 2 / 3) {\n        return p + (q - p) * (2 / 3 - t) * 6;\n      }\n\n      return p;\n    };\n\n    Convert.rgbToHSV = function (r, g, b) {\n      var d, h, max, min, s, v;\n      r /= 255;\n      g /= 255;\n      b /= 255;\n      max = Math.max(r, g, b);\n      min = Math.min(r, g, b);\n      v = max;\n      d = max - min;\n      s = max === 0 ? 0 : d / max;\n\n      if (max === min) {\n        h = 0;\n      } else {\n        h = function () {\n          switch (max) {\n            case r:\n              return (g - b) / d + (g < b ? 6 : 0);\n\n            case g:\n              return (b - r) / d + 2;\n\n            case b:\n              return (r - g) / d + 4;\n          }\n        }();\n\n        h /= 6;\n      }\n\n      return {\n        h: h,\n        s: s,\n        v: v\n      };\n    };\n\n    Convert.hsvToRGB = function (h, s, v) {\n      var b, f, g, i, p, q, r, t;\n      i = Math.floor(h * 6);\n      f = h * 6 - i;\n      p = v * (1 - s);\n      q = v * (1 - f * s);\n      t = v * (1 - (1 - f) * s);\n\n      switch (i % 6) {\n        case 0:\n          r = v;\n          g = t;\n          b = p;\n          break;\n\n        case 1:\n          r = q;\n          g = v;\n          b = p;\n          break;\n\n        case 2:\n          r = p;\n          g = v;\n          b = t;\n          break;\n\n        case 3:\n          r = p;\n          g = q;\n          b = v;\n          break;\n\n        case 4:\n          r = t;\n          g = p;\n          b = v;\n          break;\n\n        case 5:\n          r = v;\n          g = p;\n          b = q;\n      }\n\n      return {\n        r: Math.floor(r * 255),\n        g: Math.floor(g * 255),\n        b: Math.floor(b * 255)\n      };\n    };\n\n    Convert.rgbToXYZ = function (r, g, b) {\n      var x, y, z;\n      r /= 255;\n      g /= 255;\n      b /= 255;\n\n      if (r > 0.04045) {\n        r = Math.pow((r + 0.055) / 1.055, 2.4);\n      } else {\n        r /= 12.92;\n      }\n\n      if (g > 0.04045) {\n        g = Math.pow((g + 0.055) / 1.055, 2.4);\n      } else {\n        g /= 12.92;\n      }\n\n      if (b > 0.04045) {\n        b = Math.pow((b + 0.055) / 1.055, 2.4);\n      } else {\n        b /= 12.92;\n      }\n\n      x = r * 0.4124 + g * 0.3576 + b * 0.1805;\n      y = r * 0.2126 + g * 0.7152 + b * 0.0722;\n      z = r * 0.0193 + g * 0.1192 + b * 0.9505;\n      return {\n        x: x * 100,\n        y: y * 100,\n        z: z * 100\n      };\n    };\n\n    Convert.xyzToRGB = function (x, y, z) {\n      var b, g, r;\n      x /= 100;\n      y /= 100;\n      z /= 100;\n      r = 3.2406 * x + -1.5372 * y + -0.4986 * z;\n      g = -0.9689 * x + 1.8758 * y + 0.0415 * z;\n      b = 0.0557 * x + -0.2040 * y + 1.0570 * z;\n\n      if (r > 0.0031308) {\n        r = 1.055 * Math.pow(r, 0.4166666667) - 0.055;\n      } else {\n        r *= 12.92;\n      }\n\n      if (g > 0.0031308) {\n        g = 1.055 * Math.pow(g, 0.4166666667) - 0.055;\n      } else {\n        g *= 12.92;\n      }\n\n      if (b > 0.0031308) {\n        b = 1.055 * Math.pow(b, 0.4166666667) - 0.055;\n      } else {\n        b *= 12.92;\n      }\n\n      return {\n        r: r * 255,\n        g: g * 255,\n        b: b * 255\n      };\n    };\n\n    Convert.xyzToLab = function (x, y, z) {\n      var a, b, l, whiteX, whiteY, whiteZ;\n\n      if (typeof x === \"object\") {\n        y = x.y;\n        z = x.z;\n        x = x.x;\n      }\n\n      whiteX = 95.047;\n      whiteY = 100.0;\n      whiteZ = 108.883;\n      x /= whiteX;\n      y /= whiteY;\n      z /= whiteZ;\n\n      if (x > 0.008856451679) {\n        x = Math.pow(x, 0.3333333333);\n      } else {\n        x = 7.787037037 * x + 0.1379310345;\n      }\n\n      if (y > 0.008856451679) {\n        y = Math.pow(y, 0.3333333333);\n      } else {\n        y = 7.787037037 * y + 0.1379310345;\n      }\n\n      if (z > 0.008856451679) {\n        z = Math.pow(z, 0.3333333333);\n      } else {\n        z = 7.787037037 * z + 0.1379310345;\n      }\n\n      l = 116 * y - 16;\n      a = 500 * (x - y);\n      b = 200 * (y - z);\n      return {\n        l: l,\n        a: a,\n        b: b\n      };\n    };\n\n    Convert.labToXYZ = function (l, a, b) {\n      var x, y, z;\n\n      if (typeof l === \"object\") {\n        a = l.a;\n        b = l.b;\n        l = l.l;\n      }\n\n      y = (l + 16) / 116;\n      x = y + a / 500;\n      z = y - b / 200;\n\n      if (x > 0.2068965517) {\n        x = x * x * x;\n      } else {\n        x = 0.1284185493 * (x - 0.1379310345);\n      }\n\n      if (y > 0.2068965517) {\n        y = y * y * y;\n      } else {\n        y = 0.1284185493 * (y - 0.1379310345);\n      }\n\n      if (z > 0.2068965517) {\n        z = z * z * z;\n      } else {\n        z = 0.1284185493 * (z - 0.1379310345);\n      }\n\n      return {\n        x: x * 95.047,\n        y: y * 100.0,\n        z: z * 108.883\n      };\n    };\n\n    Convert.rgbToLab = function (r, g, b) {\n      var xyz;\n\n      if (typeof r === \"object\") {\n        g = r.g;\n        b = r.b;\n        r = r.r;\n      }\n\n      xyz = this.rgbToXYZ(r, g, b);\n      return this.xyzToLab(xyz);\n    };\n\n    Convert.labToRGB = function (l, a, b) {};\n\n    return Convert;\n  }();\n\n  Convert = Caman.Convert;\n\n  Caman.Event = function () {\n    function Event() {}\n\n    Event.events = {};\n    Event.types = [\"processStart\", \"processComplete\", \"renderStart\", \"renderFinished\", \"blockStarted\", \"blockFinished\"];\n\n    Event.trigger = function (target, type, data) {\n      var event, _i, _len, _ref, _results;\n\n      if (data == null) {\n        data = null;\n      }\n\n      if (this.events[type] && this.events[type].length) {\n        _ref = this.events[type];\n        _results = [];\n\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          event = _ref[_i];\n\n          if (event.target === null || target.id === event.target.id) {\n            _results.push(event.fn.call(target, data));\n          } else {\n            _results.push(void 0);\n          }\n        }\n\n        return _results;\n      }\n    };\n\n    Event.listen = function (target, type, fn) {\n      var _fn, _type;\n\n      if (typeof target === \"string\") {\n        _type = target;\n        _fn = type;\n        target = null;\n        type = _type;\n        fn = _fn;\n      }\n\n      if (__indexOf.call(this.types, type) < 0) {\n        return false;\n      }\n\n      if (!this.events[type]) {\n        this.events[type] = [];\n      }\n\n      this.events[type].push({\n        target: target,\n        fn: fn\n      });\n      return true;\n    };\n\n    return Event;\n  }();\n\n  Event = Caman.Event;\n\n  Caman.Filter = function () {\n    function Filter() {}\n\n    Filter.Type = {\n      Single: 1,\n      Kernel: 2,\n      LayerDequeue: 3,\n      LayerFinished: 4,\n      LoadOverlay: 5,\n      Plugin: 6\n    };\n\n    Filter.register = function (name, filterFunc) {\n      return Caman.prototype[name] = filterFunc;\n    };\n\n    return Filter;\n  }();\n\n  Filter = Caman.Filter;\n\n  Caman.IO = function () {\n    function IO() {}\n\n    IO.domainRegex = /(?:(?:http|https):\\/\\/)((?:\\w+)\\.(?:(?:\\w|\\.)+))/;\n\n    IO.isRemote = function (img) {\n      if (img == null) {\n        return false;\n      }\n\n      if (this.corsEnabled(img)) {\n        return false;\n      }\n\n      return this.isURLRemote(img.src);\n    };\n\n    IO.corsEnabled = function (img) {\n      var _ref;\n\n      return img.crossOrigin != null && ((_ref = img.crossOrigin.toLowerCase()) === 'anonymous' || _ref === 'use-credentials');\n    };\n\n    IO.isURLRemote = function (url) {\n      var matches;\n      matches = url.match(this.domainRegex);\n\n      if (matches) {\n        return matches[1] !== document.domain;\n      } else {\n        return false;\n      }\n    };\n\n    IO.remoteCheck = function (src) {\n      if (this.isURLRemote(src)) {\n        if (!Caman.remoteProxy.length) {\n          Log.info(\"Attempting to load a remote image without a configured proxy. URL: \" + src);\n        } else {\n          if (Caman.isURLRemote(Caman.remoteProxy)) {\n            Log.info(\"Cannot use a remote proxy for loading images.\");\n            return;\n          }\n\n          return this.proxyUrl(src);\n        }\n      }\n    };\n\n    IO.proxyUrl = function (src) {\n      return \"\" + Caman.remoteProxy + \"?\" + Caman.proxyParam + \"=\" + encodeURIComponent(src);\n    };\n\n    IO.useProxy = function (lang) {\n      var langToExt;\n      langToExt = {\n        ruby: 'rb',\n        python: 'py',\n        perl: 'pl',\n        javascript: 'js'\n      };\n      lang = lang.toLowerCase();\n\n      if (langToExt[lang] != null) {\n        lang = langToExt[lang];\n      }\n\n      return \"proxies/caman_proxy.\" + lang;\n    };\n\n    return IO;\n  }();\n\n  Caman.prototype.save = function () {\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      return this.nodeSave.apply(this, arguments);\n    } else {\n      return this.browserSave.apply(this, arguments);\n    }\n  };\n\n  Caman.prototype.browserSave = function (type) {\n    var image;\n\n    if (type == null) {\n      type = \"png\";\n    }\n\n    type = type.toLowerCase();\n    image = this.toBase64(type).replace(\"image/\" + type, \"image/octet-stream\");\n    return document.location.href = image;\n  };\n\n  Caman.prototype.nodeSave = function (file, overwrite) {\n    var e, stats;\n\n    if (overwrite == null) {\n      overwrite = true;\n    }\n\n    try {\n      stats = fs.statSync(file);\n\n      if (stats.isFile() && !overwrite) {\n        return false;\n      }\n    } catch (_error) {\n      e = _error;\n      Log.debug(\"Creating output file \" + file);\n    }\n\n    return fs.writeFile(file, this.canvas.toBuffer(), function () {\n      return Log.debug(\"Finished writing to \" + file);\n    });\n  };\n\n  Caman.prototype.toImage = function (type) {\n    var img;\n    img = document.createElement('img');\n    img.src = this.toBase64(type);\n    img.width = this.dimensions.width;\n    img.height = this.dimensions.height;\n\n    if (window.devicePixelRatio) {\n      img.width /= window.devicePixelRatio;\n      img.height /= window.devicePixelRatio;\n    }\n\n    return img;\n  };\n\n  Caman.prototype.toBase64 = function (type) {\n    if (type == null) {\n      type = \"png\";\n    }\n\n    type = type.toLowerCase();\n    return this.canvas.toDataURL(\"image/\" + type);\n  };\n\n  IO = Caman.IO;\n\n  Caman.Layer = function () {\n    function Layer(c) {\n      this.c = c;\n      this.filter = this.c;\n      this.options = {\n        blendingMode: 'normal',\n        opacity: 1.0\n      };\n      this.layerID = Util.uniqid.get();\n      this.canvas = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      this.canvas.width = this.c.dimensions.width;\n      this.canvas.height = this.c.dimensions.height;\n      this.context = this.canvas.getContext('2d');\n      this.context.createImageData(this.canvas.width, this.canvas.height);\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      this.pixelData = this.imageData.data;\n    }\n\n    Layer.prototype.newLayer = function (cb) {\n      return this.c.newLayer.call(this.c, cb);\n    };\n\n    Layer.prototype.setBlendingMode = function (mode) {\n      this.options.blendingMode = mode;\n      return this;\n    };\n\n    Layer.prototype.opacity = function (opacity) {\n      this.options.opacity = opacity / 100;\n      return this;\n    };\n\n    Layer.prototype.copyParent = function () {\n      var i, parentData, _i, _ref;\n\n      parentData = this.c.pixelData;\n\n      for (i = _i = 0, _ref = this.c.pixelData.length; _i < _ref; i = _i += 4) {\n        this.pixelData[i] = parentData[i];\n        this.pixelData[i + 1] = parentData[i + 1];\n        this.pixelData[i + 2] = parentData[i + 2];\n        this.pixelData[i + 3] = parentData[i + 3];\n      }\n\n      return this;\n    };\n\n    Layer.prototype.fillColor = function () {\n      return this.c.fillColor.apply(this.c, arguments);\n    };\n\n    Layer.prototype.overlayImage = function (image) {\n      if (typeof image === \"object\") {\n        image = image.src;\n      } else if (typeof image === \"string\" && image[0] === \"#\") {\n        image = $(image).src;\n      }\n\n      if (!image) {\n        return this;\n      }\n\n      this.c.renderer.renderQueue.push({\n        type: Filter.Type.LoadOverlay,\n        src: image,\n        layer: this\n      });\n      return this;\n    };\n\n    Layer.prototype.applyToParent = function () {\n      var i, layerData, parentData, result, rgbaLayer, rgbaParent, _i, _ref, _results;\n\n      parentData = this.c.pixelStack[this.c.pixelStack.length - 1];\n      layerData = this.c.pixelData;\n      _results = [];\n\n      for (i = _i = 0, _ref = layerData.length; _i < _ref; i = _i += 4) {\n        rgbaParent = {\n          r: parentData[i],\n          g: parentData[i + 1],\n          b: parentData[i + 2],\n          a: parentData[i + 3]\n        };\n        rgbaLayer = {\n          r: layerData[i],\n          g: layerData[i + 1],\n          b: layerData[i + 2],\n          a: layerData[i + 3]\n        };\n        result = Blender.execute(this.options.blendingMode, rgbaLayer, rgbaParent);\n        result.r = Util.clampRGB(result.r);\n        result.g = Util.clampRGB(result.g);\n        result.b = Util.clampRGB(result.b);\n\n        if (result.a == null) {\n          result.a = rgbaLayer.a;\n        }\n\n        parentData[i] = rgbaParent.r - (rgbaParent.r - result.r) * (this.options.opacity * (result.a / 255));\n        parentData[i + 1] = rgbaParent.g - (rgbaParent.g - result.g) * (this.options.opacity * (result.a / 255));\n\n        _results.push(parentData[i + 2] = rgbaParent.b - (rgbaParent.b - result.b) * (this.options.opacity * (result.a / 255)));\n      }\n\n      return _results;\n    };\n\n    return Layer;\n  }();\n\n  Layer = Caman.Layer;\n\n  Caman.Logger = function () {\n    function Logger() {\n      var name, _i, _len, _ref;\n\n      _ref = ['log', 'info', 'warn', 'error'];\n\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        name = _ref[_i];\n\n        this[name] = function (name) {\n          return function () {\n            var args, e;\n            args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n\n            if (!Caman.DEBUG) {\n              return;\n            }\n\n            try {\n              return console[name].apply(console, args);\n            } catch (_error) {\n              e = _error;\n              return console[name](args);\n            }\n          };\n        }(name);\n      }\n\n      this.debug = this.log;\n    }\n\n    return Logger;\n  }();\n\n  Log = new Caman.Logger();\n\n  Caman.Pixel = function () {\n    Pixel.coordinatesToLocation = function (x, y, width) {\n      return (y * width + x) * 4;\n    };\n\n    Pixel.locationToCoordinates = function (loc, width) {\n      var x, y;\n      y = Math.floor(loc / (width * 4));\n      x = loc % (width * 4) / 4;\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    function Pixel(r, g, b, a, c) {\n      this.r = r != null ? r : 0;\n      this.g = g != null ? g : 0;\n      this.b = b != null ? b : 0;\n      this.a = a != null ? a : 255;\n      this.c = c != null ? c : null;\n      this.loc = 0;\n    }\n\n    Pixel.prototype.setContext = function (c) {\n      return this.c = c;\n    };\n\n    Pixel.prototype.locationXY = function () {\n      var x, y;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      y = this.c.dimensions.height - Math.floor(this.loc / (this.c.dimensions.width * 4));\n      x = this.loc % (this.c.dimensions.width * 4) / 4;\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    Pixel.prototype.pixelAtLocation = function (loc) {\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      return new Pixel(this.c.pixelData[loc], this.c.pixelData[loc + 1], this.c.pixelData[loc + 2], this.c.pixelData[loc + 3], this.c);\n    };\n\n    Pixel.prototype.getPixelRelative = function (horiz, vert) {\n      var newLoc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      newLoc = this.loc + this.c.dimensions.width * 4 * (vert * -1) + 4 * horiz;\n\n      if (newLoc > this.c.pixelData.length || newLoc < 0) {\n        return new Pixel(0, 0, 0, 255, this.c);\n      }\n\n      return this.pixelAtLocation(newLoc);\n    };\n\n    Pixel.prototype.putPixelRelative = function (horiz, vert, rgba) {\n      var nowLoc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      nowLoc = this.loc + this.c.dimensions.width * 4 * (vert * -1) + 4 * horiz;\n\n      if (newLoc > this.c.pixelData.length || newLoc < 0) {\n        return;\n      }\n\n      this.c.pixelData[newLoc] = rgba.r;\n      this.c.pixelData[newLoc + 1] = rgba.g;\n      this.c.pixelData[newLoc + 2] = rgba.b;\n      this.c.pixelData[newLoc + 3] = rgba.a;\n      return true;\n    };\n\n    Pixel.prototype.getPixel = function (x, y) {\n      var loc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      loc = this.coordinatesToLocation(x, y, this.width);\n      return this.pixelAtLocation(loc);\n    };\n\n    Pixel.prototype.putPixel = function (x, y, rgba) {\n      var loc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n\n      loc = this.coordinatesToLocation(x, y, this.width);\n      this.c.pixelData[loc] = rgba.r;\n      this.c.pixelData[loc + 1] = rgba.g;\n      this.c.pixelData[loc + 2] = rgba.b;\n      return this.c.pixelData[loc + 3] = rgba.a;\n    };\n\n    Pixel.prototype.toString = function () {\n      return this.toKey();\n    };\n\n    Pixel.prototype.toHex = function (includeAlpha) {\n      var hex;\n\n      if (includeAlpha == null) {\n        includeAlpha = false;\n      }\n\n      hex = '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16);\n\n      if (includeAlpha) {\n        return hex + this.a.toString(16);\n      } else {\n        return hex;\n      }\n    };\n\n    return Pixel;\n  }();\n\n  Pixel = Caman.Pixel;\n\n  Caman.Plugin = function () {\n    function Plugin() {}\n\n    Plugin.plugins = {};\n\n    Plugin.register = function (name, plugin) {\n      return this.plugins[name] = plugin;\n    };\n\n    Plugin.execute = function (context, name, args) {\n      return this.plugins[name].apply(context, args);\n    };\n\n    return Plugin;\n  }();\n\n  Plugin = Caman.Plugin;\n\n  Caman.Renderer = function () {\n    Renderer.Blocks = Caman.NodeJS ? require('os').cpus().length : 4;\n\n    function Renderer(c) {\n      this.c = c;\n      this.processNext = __bind(this.processNext, this);\n      this.renderQueue = [];\n      this.modPixelData = null;\n    }\n\n    Renderer.prototype.add = function (job) {\n      if (job == null) {\n        return;\n      }\n\n      return this.renderQueue.push(job);\n    };\n\n    Renderer.prototype.processNext = function () {\n      var layer;\n\n      if (this.renderQueue.length === 0) {\n        Event.trigger(this, \"renderFinished\");\n\n        if (this.finishedFn != null) {\n          this.finishedFn.call(this.c);\n        }\n\n        return this;\n      }\n\n      this.currentJob = this.renderQueue.shift();\n\n      switch (this.currentJob.type) {\n        case Filter.Type.LayerDequeue:\n          layer = this.c.canvasQueue.shift();\n          this.c.executeLayer(layer);\n          return this.processNext();\n\n        case Filter.Type.LayerFinished:\n          this.c.applyCurrentLayer();\n          this.c.popContext();\n          return this.processNext();\n\n        case Filter.Type.LoadOverlay:\n          return this.loadOverlay(this.currentJob.layer, this.currentJob.src);\n\n        case Filter.Type.Plugin:\n          return this.executePlugin();\n\n        default:\n          return this.executeFilter();\n      }\n    };\n\n    Renderer.prototype.execute = function (callback) {\n      this.finishedFn = callback;\n      this.modPixelData = Util.dataArray(this.c.pixelData.length);\n      return this.processNext();\n    };\n\n    Renderer.prototype.eachBlock = function (fn) {\n      var blockN,\n          blockPixelLength,\n          bnum,\n          end,\n          f,\n          i,\n          lastBlockN,\n          n,\n          start,\n          _i,\n          _ref,\n          _results,\n          _this = this;\n\n      this.blocksDone = 0;\n      n = this.c.pixelData.length;\n      blockPixelLength = Math.floor(n / 4 / Renderer.Blocks);\n      blockN = blockPixelLength * 4;\n      lastBlockN = blockN + n / 4 % Renderer.Blocks * 4;\n      _results = [];\n\n      for (i = _i = 0, _ref = Renderer.Blocks; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        start = i * blockN;\n        end = start + (i === Renderer.Blocks - 1 ? lastBlockN : blockN);\n\n        if (Caman.NodeJS) {\n          f = Fiber(function () {\n            return fn.call(_this, i, start, end);\n          });\n          bnum = f.run();\n\n          _results.push(this.blockFinished(bnum));\n        } else {\n          _results.push(setTimeout(function (i, start, end) {\n            return function () {\n              return fn.call(_this, i, start, end);\n            };\n          }(i, start, end), 0));\n        }\n      }\n\n      return _results;\n    };\n\n    Renderer.prototype.executeFilter = function () {\n      Event.trigger(this.c, \"processStart\", this.currentJob);\n\n      if (this.currentJob.type === Filter.Type.Single) {\n        return this.eachBlock(this.renderBlock);\n      } else {\n        return this.eachBlock(this.renderKernel);\n      }\n    };\n\n    Renderer.prototype.executePlugin = function () {\n      Log.debug(\"Executing plugin \" + this.currentJob.plugin);\n      Plugin.execute(this.c, this.currentJob.plugin, this.currentJob.args);\n      Log.debug(\"Plugin \" + this.currentJob.plugin + \" finished!\");\n      return this.processNext();\n    };\n\n    Renderer.prototype.renderBlock = function (bnum, start, end) {\n      var i, pixel, _i;\n\n      Log.debug(\"Block #\" + bnum + \" - Filter: \" + this.currentJob.name + \", Start: \" + start + \", End: \" + end);\n      Event.trigger(this.c, \"blockStarted\", {\n        blockNum: bnum,\n        totalBlocks: Renderer.Blocks,\n        startPixel: start,\n        endPixel: end\n      });\n      pixel = new Pixel();\n      pixel.setContext(this.c);\n\n      for (i = _i = start; _i < end; i = _i += 4) {\n        pixel.loc = i;\n        pixel.r = this.c.pixelData[i];\n        pixel.g = this.c.pixelData[i + 1];\n        pixel.b = this.c.pixelData[i + 2];\n        pixel.a = this.c.pixelData[i + 3];\n        this.currentJob.processFn(pixel);\n        this.c.pixelData[i] = Util.clampRGB(pixel.r);\n        this.c.pixelData[i + 1] = Util.clampRGB(pixel.g);\n        this.c.pixelData[i + 2] = Util.clampRGB(pixel.b);\n        this.c.pixelData[i + 3] = Util.clampRGB(pixel.a);\n      }\n\n      if (Caman.NodeJS) {\n        return Fiber[\"yield\"](bnum);\n      } else {\n        return this.blockFinished(bnum);\n      }\n    };\n\n    Renderer.prototype.renderKernel = function (bnum, start, end) {\n      var adjust, adjustSize, bias, builder, builderIndex, divisor, i, j, k, kernel, n, name, p, pixel, res, _i, _j, _k;\n\n      name = this.currentJob.name;\n      bias = this.currentJob.bias;\n      divisor = this.currentJob.divisor;\n      n = this.c.pixelData.length;\n      adjust = this.currentJob.adjust;\n      adjustSize = Math.sqrt(adjust.length);\n      kernel = [];\n      Log.debug(\"Rendering kernel - Filter: \" + this.currentJob.name);\n      start = Math.max(start, this.c.dimensions.width * 4 * ((adjustSize - 1) / 2));\n      end = Math.min(end, n - this.c.dimensions.width * 4 * ((adjustSize - 1) / 2));\n      builder = (adjustSize - 1) / 2;\n      pixel = new Pixel();\n      pixel.setContext(this.c);\n\n      for (i = _i = start; _i < end; i = _i += 4) {\n        pixel.loc = i;\n        builderIndex = 0;\n\n        for (j = _j = -builder; -builder <= builder ? _j <= builder : _j >= builder; j = -builder <= builder ? ++_j : --_j) {\n          for (k = _k = builder; builder <= -builder ? _k <= -builder : _k >= -builder; k = builder <= -builder ? ++_k : --_k) {\n            p = pixel.getPixelRelative(j, k);\n            kernel[builderIndex * 3] = p.r;\n            kernel[builderIndex * 3 + 1] = p.g;\n            kernel[builderIndex * 3 + 2] = p.b;\n            builderIndex++;\n          }\n        }\n\n        res = this.processKernel(adjust, kernel, divisor, bias);\n        this.modPixelData[i] = Util.clampRGB(res.r);\n        this.modPixelData[i + 1] = Util.clampRGB(res.g);\n        this.modPixelData[i + 2] = Util.clampRGB(res.b);\n        this.modPixelData[i + 3] = this.c.pixelData[i + 3];\n      }\n\n      if (Caman.NodeJS) {\n        return Fiber[\"yield\"](bnum);\n      } else {\n        return this.blockFinished(bnum);\n      }\n    };\n\n    Renderer.prototype.blockFinished = function (bnum) {\n      var i, _i, _ref;\n\n      if (bnum >= 0) {\n        Log.debug(\"Block #\" + bnum + \" finished! Filter: \" + this.currentJob.name);\n      }\n\n      this.blocksDone++;\n      Event.trigger(this.c, \"blockFinished\", {\n        blockNum: bnum,\n        blocksFinished: this.blocksDone,\n        totalBlocks: Renderer.Blocks\n      });\n\n      if (this.blocksDone === Renderer.Blocks) {\n        if (this.currentJob.type === Filter.Type.Kernel) {\n          for (i = _i = 0, _ref = this.c.pixelData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n            this.c.pixelData[i] = this.modPixelData[i];\n          }\n        }\n\n        if (bnum >= 0) {\n          Log.debug(\"Filter \" + this.currentJob.name + \" finished!\");\n        }\n\n        Event.trigger(this.c, \"processComplete\", this.currentJob);\n        return this.processNext();\n      }\n    };\n\n    Renderer.prototype.processKernel = function (adjust, kernel, divisor, bias) {\n      var i, val, _i, _ref;\n\n      val = {\n        r: 0,\n        g: 0,\n        b: 0\n      };\n\n      for (i = _i = 0, _ref = adjust.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        val.r += adjust[i] * kernel[i * 3];\n        val.g += adjust[i] * kernel[i * 3 + 1];\n        val.b += adjust[i] * kernel[i * 3 + 2];\n      }\n\n      val.r = val.r / divisor + bias;\n      val.g = val.g / divisor + bias;\n      val.b = val.b / divisor + bias;\n      return val;\n    };\n\n    Renderer.prototype.loadOverlay = function (layer, src) {\n      var img,\n          proxyUrl,\n          _this = this;\n\n      img = document.createElement('img');\n\n      img.onload = function () {\n        layer.context.drawImage(img, 0, 0, _this.c.dimensions.width, _this.c.dimensions.height);\n        layer.imageData = layer.context.getImageData(0, 0, _this.c.dimensions.width, _this.c.dimensions.height);\n        layer.pixelData = layer.imageData.data;\n        _this.c.pixelData = layer.pixelData;\n        return _this.processNext();\n      };\n\n      proxyUrl = IO.remoteCheck(src);\n      return img.src = proxyUrl != null ? proxyUrl : src;\n    };\n\n    return Renderer;\n  }();\n\n  Renderer = Caman.Renderer;\n\n  Caman.Store = function () {\n    function Store() {}\n\n    Store.items = {};\n\n    Store.has = function (search) {\n      return this.items[search] != null;\n    };\n\n    Store.get = function (search) {\n      return this.items[search];\n    };\n\n    Store.put = function (name, obj) {\n      return this.items[name] = obj;\n    };\n\n    Store.execute = function (search, callback) {\n      var _this = this;\n\n      setTimeout(function () {\n        return callback.call(_this.get(search), _this.get(search));\n      }, 0);\n      return this.get(search);\n    };\n\n    Store.flush = function (name) {\n      if (name == null) {\n        name = false;\n      }\n\n      if (name) {\n        return delete this.items[name];\n      } else {\n        return this.items = {};\n      }\n    };\n\n    return Store;\n  }();\n\n  Store = Caman.Store;\n  Blender.register(\"normal\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaLayer.r,\n      g: rgbaLayer.g,\n      b: rgbaLayer.b\n    };\n  });\n  Blender.register(\"multiply\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaLayer.r * rgbaParent.r / 255,\n      g: rgbaLayer.g * rgbaParent.g / 255,\n      b: rgbaLayer.b * rgbaParent.b / 255\n    };\n  });\n  Blender.register(\"screen\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: 255 - (255 - rgbaLayer.r) * (255 - rgbaParent.r) / 255,\n      g: 255 - (255 - rgbaLayer.g) * (255 - rgbaParent.g) / 255,\n      b: 255 - (255 - rgbaLayer.b) * (255 - rgbaParent.b) / 255\n    };\n  });\n  Blender.register(\"overlay\", function (rgbaLayer, rgbaParent) {\n    var result;\n    result = {};\n    result.r = rgbaParent.r > 128 ? 255 - 2 * (255 - rgbaLayer.r) * (255 - rgbaParent.r) / 255 : rgbaParent.r * rgbaLayer.r * 2 / 255;\n    result.g = rgbaParent.g > 128 ? 255 - 2 * (255 - rgbaLayer.g) * (255 - rgbaParent.g) / 255 : rgbaParent.g * rgbaLayer.g * 2 / 255;\n    result.b = rgbaParent.b > 128 ? 255 - 2 * (255 - rgbaLayer.b) * (255 - rgbaParent.b) / 255 : rgbaParent.b * rgbaLayer.b * 2 / 255;\n    return result;\n  });\n  Blender.register(\"difference\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaLayer.r - rgbaParent.r,\n      g: rgbaLayer.g - rgbaParent.g,\n      b: rgbaLayer.b - rgbaParent.b\n    };\n  });\n  Blender.register(\"addition\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r + rgbaLayer.r,\n      g: rgbaParent.g + rgbaLayer.g,\n      b: rgbaParent.b + rgbaLayer.b\n    };\n  });\n  Blender.register(\"exclusion\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: 128 - 2 * (rgbaParent.r - 128) * (rgbaLayer.r - 128) / 255,\n      g: 128 - 2 * (rgbaParent.g - 128) * (rgbaLayer.g - 128) / 255,\n      b: 128 - 2 * (rgbaParent.b - 128) * (rgbaLayer.b - 128) / 255\n    };\n  });\n  Blender.register(\"softLight\", function (rgbaLayer, rgbaParent) {\n    var result;\n    result = {};\n    result.r = rgbaParent.r > 128 ? 255 - (255 - rgbaParent.r) * (255 - (rgbaLayer.r - 128)) / 255 : rgbaParent.r * (rgbaLayer.r + 128) / 255;\n    result.g = rgbaParent.g > 128 ? 255 - (255 - rgbaParent.g) * (255 - (rgbaLayer.g - 128)) / 255 : rgbaParent.g * (rgbaLayer.g + 128) / 255;\n    result.b = rgbaParent.b > 128 ? 255 - (255 - rgbaParent.b) * (255 - (rgbaLayer.b - 128)) / 255 : rgbaParent.b * (rgbaLayer.b + 128) / 255;\n    return result;\n  });\n  Blender.register(\"lighten\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r > rgbaLayer.r ? rgbaParent.r : rgbaLayer.r,\n      g: rgbaParent.g > rgbaLayer.g ? rgbaParent.g : rgbaLayer.g,\n      b: rgbaParent.b > rgbaLayer.b ? rgbaParent.b : rgbaLayer.b\n    };\n  });\n  Blender.register(\"darken\", function (rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r > rgbaLayer.r ? rgbaLayer.r : rgbaParent.r,\n      g: rgbaParent.g > rgbaLayer.g ? rgbaLayer.g : rgbaParent.g,\n      b: rgbaParent.b > rgbaLayer.b ? rgbaLayer.b : rgbaParent.b\n    };\n  });\n  Filter.register(\"fillColor\", function () {\n    var color;\n\n    if (arguments.length === 1) {\n      color = Convert.hexToRGB(arguments[0]);\n    } else {\n      color = {\n        r: arguments[0],\n        g: arguments[1],\n        b: arguments[2]\n      };\n    }\n\n    return this.process(\"fillColor\", function (rgba) {\n      rgba.r = color.r;\n      rgba.g = color.g;\n      rgba.b = color.b;\n      rgba.a = 255;\n      return rgba;\n    });\n  });\n  Filter.register(\"brightness\", function (adjust) {\n    adjust = Math.floor(255 * (adjust / 100));\n    return this.process(\"brightness\", function (rgba) {\n      rgba.r += adjust;\n      rgba.g += adjust;\n      rgba.b += adjust;\n      return rgba;\n    });\n  });\n  Filter.register(\"saturation\", function (adjust) {\n    adjust *= -0.01;\n    return this.process(\"saturation\", function (rgba) {\n      var max;\n      max = Math.max(rgba.r, rgba.g, rgba.b);\n\n      if (rgba.r !== max) {\n        rgba.r += (max - rgba.r) * adjust;\n      }\n\n      if (rgba.g !== max) {\n        rgba.g += (max - rgba.g) * adjust;\n      }\n\n      if (rgba.b !== max) {\n        rgba.b += (max - rgba.b) * adjust;\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"vibrance\", function (adjust) {\n    adjust *= -1;\n    return this.process(\"vibrance\", function (rgba) {\n      var amt, avg, max;\n      max = Math.max(rgba.r, rgba.g, rgba.b);\n      avg = (rgba.r + rgba.g + rgba.b) / 3;\n      amt = Math.abs(max - avg) * 2 / 255 * adjust / 100;\n\n      if (rgba.r !== max) {\n        rgba.r += (max - rgba.r) * amt;\n      }\n\n      if (rgba.g !== max) {\n        rgba.g += (max - rgba.g) * amt;\n      }\n\n      if (rgba.b !== max) {\n        rgba.b += (max - rgba.b) * amt;\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"greyscale\", function (adjust) {\n    return this.process(\"greyscale\", function (rgba) {\n      var avg;\n      avg = Calculate.luminance(rgba);\n      rgba.r = avg;\n      rgba.g = avg;\n      rgba.b = avg;\n      return rgba;\n    });\n  });\n  Filter.register(\"contrast\", function (adjust) {\n    adjust = Math.pow((adjust + 100) / 100, 2);\n    return this.process(\"contrast\", function (rgba) {\n      rgba.r /= 255;\n      rgba.r -= 0.5;\n      rgba.r *= adjust;\n      rgba.r += 0.5;\n      rgba.r *= 255;\n      rgba.g /= 255;\n      rgba.g -= 0.5;\n      rgba.g *= adjust;\n      rgba.g += 0.5;\n      rgba.g *= 255;\n      rgba.b /= 255;\n      rgba.b -= 0.5;\n      rgba.b *= adjust;\n      rgba.b += 0.5;\n      rgba.b *= 255;\n      return rgba;\n    });\n  });\n  Filter.register(\"hue\", function (adjust) {\n    return this.process(\"hue\", function (rgba) {\n      var b, g, h, hsv, r, _ref;\n\n      hsv = Convert.rgbToHSV(rgba.r, rgba.g, rgba.b);\n      h = hsv.h * 100;\n      h += Math.abs(adjust);\n      h = h % 100;\n      h /= 100;\n      hsv.h = h;\n      _ref = Convert.hsvToRGB(hsv.h, hsv.s, hsv.v), r = _ref.r, g = _ref.g, b = _ref.b;\n      rgba.r = r;\n      rgba.g = g;\n      rgba.b = b;\n      return rgba;\n    });\n  });\n  Filter.register(\"colorize\", function () {\n    var level, rgb;\n\n    if (arguments.length === 2) {\n      rgb = Convert.hexToRGB(arguments[0]);\n      level = arguments[1];\n    } else if (arguments.length === 4) {\n      rgb = {\n        r: arguments[0],\n        g: arguments[1],\n        b: arguments[2]\n      };\n      level = arguments[3];\n    }\n\n    return this.process(\"colorize\", function (rgba) {\n      rgba.r -= (rgba.r - rgb.r) * (level / 100);\n      rgba.g -= (rgba.g - rgb.g) * (level / 100);\n      rgba.b -= (rgba.b - rgb.b) * (level / 100);\n      return rgba;\n    });\n  });\n  Filter.register(\"invert\", function () {\n    return this.process(\"invert\", function (rgba) {\n      rgba.r = 255 - rgba.r;\n      rgba.g = 255 - rgba.g;\n      rgba.b = 255 - rgba.b;\n      return rgba;\n    });\n  });\n  Filter.register(\"sepia\", function (adjust) {\n    if (adjust == null) {\n      adjust = 100;\n    }\n\n    adjust /= 100;\n    return this.process(\"sepia\", function (rgba) {\n      rgba.r = Math.min(255, rgba.r * (1 - 0.607 * adjust) + rgba.g * (0.769 * adjust) + rgba.b * (0.189 * adjust));\n      rgba.g = Math.min(255, rgba.r * (0.349 * adjust) + rgba.g * (1 - 0.314 * adjust) + rgba.b * (0.168 * adjust));\n      rgba.b = Math.min(255, rgba.r * (0.272 * adjust) + rgba.g * (0.534 * adjust) + rgba.b * (1 - 0.869 * adjust));\n      return rgba;\n    });\n  });\n  Filter.register(\"gamma\", function (adjust) {\n    return this.process(\"gamma\", function (rgba) {\n      rgba.r = Math.pow(rgba.r / 255, adjust) * 255;\n      rgba.g = Math.pow(rgba.g / 255, adjust) * 255;\n      rgba.b = Math.pow(rgba.b / 255, adjust) * 255;\n      return rgba;\n    });\n  });\n  Filter.register(\"noise\", function (adjust) {\n    adjust = Math.abs(adjust) * 2.55;\n    return this.process(\"noise\", function (rgba) {\n      var rand;\n      rand = Calculate.randomRange(adjust * -1, adjust);\n      rgba.r += rand;\n      rgba.g += rand;\n      rgba.b += rand;\n      return rgba;\n    });\n  });\n  Filter.register(\"clip\", function (adjust) {\n    adjust = Math.abs(adjust) * 2.55;\n    return this.process(\"clip\", function (rgba) {\n      if (rgba.r > 255 - adjust) {\n        rgba.r = 255;\n      } else if (rgba.r < adjust) {\n        rgba.r = 0;\n      }\n\n      if (rgba.g > 255 - adjust) {\n        rgba.g = 255;\n      } else if (rgba.g < adjust) {\n        rgba.g = 0;\n      }\n\n      if (rgba.b > 255 - adjust) {\n        rgba.b = 255;\n      } else if (rgba.b < adjust) {\n        rgba.b = 0;\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"channels\", function (options) {\n    var chan, value;\n\n    if (typeof options !== \"object\") {\n      return this;\n    }\n\n    for (chan in options) {\n      if (!__hasProp.call(options, chan)) continue;\n      value = options[chan];\n\n      if (value === 0) {\n        delete options[chan];\n        continue;\n      }\n\n      options[chan] /= 100;\n    }\n\n    if (options.length === 0) {\n      return this;\n    }\n\n    return this.process(\"channels\", function (rgba) {\n      if (options.red != null) {\n        if (options.red > 0) {\n          rgba.r += (255 - rgba.r) * options.red;\n        } else {\n          rgba.r -= rgba.r * Math.abs(options.red);\n        }\n      }\n\n      if (options.green != null) {\n        if (options.green > 0) {\n          rgba.g += (255 - rgba.g) * options.green;\n        } else {\n          rgba.g -= rgba.g * Math.abs(options.green);\n        }\n      }\n\n      if (options.blue != null) {\n        if (options.blue > 0) {\n          rgba.b += (255 - rgba.b) * options.blue;\n        } else {\n          rgba.b -= rgba.b * Math.abs(options.blue);\n        }\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"curves\", function () {\n    var bezier, chans, cps, ctrl1, ctrl2, end, i, start, _i, _j, _ref, _ref1;\n\n    chans = arguments[0], cps = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n\n    if (typeof chans === \"string\") {\n      chans = chans.split(\"\");\n    }\n\n    if (chans[0] === \"v\") {\n      chans = ['r', 'g', 'b'];\n    }\n\n    if (cps.length < 3 || cps.length > 4) {\n      throw \"Invalid number of arguments to curves filter\";\n    }\n\n    start = cps[0];\n    ctrl1 = cps[1];\n    ctrl2 = cps.length === 4 ? cps[2] : cps[1];\n    end = cps[cps.length - 1];\n    bezier = Calculate.bezier(start, ctrl1, ctrl2, end, 0, 255);\n\n    if (start[0] > 0) {\n      for (i = _i = 0, _ref = start[0]; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        bezier[i] = start[1];\n      }\n    }\n\n    if (end[0] < 255) {\n      for (i = _j = _ref1 = end[0]; _ref1 <= 255 ? _j <= 255 : _j >= 255; i = _ref1 <= 255 ? ++_j : --_j) {\n        bezier[i] = end[1];\n      }\n    }\n\n    return this.process(\"curves\", function (rgba) {\n      var _k, _ref2;\n\n      for (i = _k = 0, _ref2 = chans.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {\n        rgba[chans[i]] = bezier[rgba[chans[i]]];\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"exposure\", function (adjust) {\n    var ctrl1, ctrl2, p;\n    p = Math.abs(adjust) / 100;\n    ctrl1 = [0, 255 * p];\n    ctrl2 = [255 - 255 * p, 255];\n\n    if (adjust < 0) {\n      ctrl1 = ctrl1.reverse();\n      ctrl2 = ctrl2.reverse();\n    }\n\n    return this.curves('rgb', [0, 0], ctrl1, ctrl2, [255, 255]);\n  });\n  Caman.Plugin.register(\"crop\", function (width, height, x, y) {\n    var canvas, ctx;\n\n    if (x == null) {\n      x = 0;\n    }\n\n    if (y == null) {\n      y = 0;\n    }\n\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas(width, height);\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = width;\n      canvas.height = height;\n    }\n\n    ctx = canvas.getContext('2d');\n    ctx.drawImage(this.canvas, x, y, width, height, 0, 0, width, height);\n    this.cropCoordinates = {\n      x: x,\n      y: y\n    };\n    this.cropped = true;\n    return this.replaceCanvas(canvas);\n  });\n  Caman.Plugin.register(\"resize\", function (newDims) {\n    var canvas, ctx;\n\n    if (newDims == null) {\n      newDims = null;\n    }\n\n    if (newDims === null || newDims.width == null && newDims.height == null) {\n      Log.error(\"Invalid or missing dimensions given for resize\");\n      return;\n    }\n\n    if (newDims.width == null) {\n      newDims.width = this.canvas.width * newDims.height / this.canvas.height;\n    } else if (newDims.height == null) {\n      newDims.height = this.canvas.height * newDims.width / this.canvas.width;\n    }\n\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas(newDims.width, newDims.height);\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = newDims.width;\n      canvas.height = newDims.height;\n    }\n\n    ctx = canvas.getContext('2d');\n    ctx.drawImage(this.canvas, 0, 0, this.canvas.width, this.canvas.height, 0, 0, newDims.width, newDims.height);\n    this.resized = true;\n    return this.replaceCanvas(canvas);\n  });\n  Caman.Filter.register(\"crop\", function () {\n    return this.processPlugin(\"crop\", Array.prototype.slice.call(arguments, 0));\n  });\n  Caman.Filter.register(\"resize\", function () {\n    return this.processPlugin(\"resize\", Array.prototype.slice.call(arguments, 0));\n  });\n  Caman.Filter.register(\"boxBlur\", function () {\n    return this.processKernel(\"Box Blur\", [1, 1, 1, 1, 1, 1, 1, 1, 1]);\n  });\n  Caman.Filter.register(\"heavyRadialBlur\", function () {\n    return this.processKernel(\"Heavy Radial Blur\", [0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0]);\n  });\n  Caman.Filter.register(\"gaussianBlur\", function () {\n    return this.processKernel(\"Gaussian Blur\", [1, 4, 6, 4, 1, 4, 16, 24, 16, 4, 6, 24, 36, 24, 6, 4, 16, 24, 16, 4, 1, 4, 6, 4, 1]);\n  });\n  Caman.Filter.register(\"motionBlur\", function (degrees) {\n    var kernel;\n\n    if (degrees === 0 || degrees === 180) {\n      kernel = [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0];\n    } else if (degrees > 0 && degrees < 90 || degrees > 180 && degrees < 270) {\n      kernel = [0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0];\n    } else if (degrees === 90 || degrees === 270) {\n      kernel = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    } else {\n      kernel = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];\n    }\n\n    return this.processKernel(\"Motion Blur\", kernel);\n  });\n  Caman.Filter.register(\"sharpen\", function (amt) {\n    if (amt == null) {\n      amt = 100;\n    }\n\n    amt /= 100;\n    return this.processKernel(\"Sharpen\", [0, -amt, 0, -amt, 4 * amt + 1, -amt, 0, -amt, 0]);\n  });\n  vignetteFilters = {\n    brightness: function (rgba, amt, opts) {\n      rgba.r = rgba.r - rgba.r * amt * opts.strength;\n      rgba.g = rgba.g - rgba.g * amt * opts.strength;\n      rgba.b = rgba.b - rgba.b * amt * opts.strength;\n      return rgba;\n    },\n    gamma: function (rgba, amt, opts) {\n      rgba.r = Math.pow(rgba.r / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      rgba.g = Math.pow(rgba.g / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      rgba.b = Math.pow(rgba.b / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      return rgba;\n    },\n    colorize: function (rgba, amt, opts) {\n      rgba.r -= (rgba.r - opts.color.r) * amt;\n      rgba.g -= (rgba.g - opts.color.g) * amt;\n      rgba.b -= (rgba.b - opts.color.b) * amt;\n      return rgba;\n    }\n  };\n  Filter.register(\"vignette\", function (size, strength) {\n    var bezier, center, end, start;\n\n    if (strength == null) {\n      strength = 60;\n    }\n\n    if (typeof size === \"string\" && size.substr(-1) === \"%\") {\n      if (this.dimensions.height > this.dimensions.width) {\n        size = this.dimensions.width * (parseInt(size.substr(0, size.length - 1), 10) / 100);\n      } else {\n        size = this.dimensions.height * (parseInt(size.substr(0, size.length - 1), 10) / 100);\n      }\n    }\n\n    strength /= 100;\n    center = [this.dimensions.width / 2, this.dimensions.height / 2];\n    start = Math.sqrt(Math.pow(center[0], 2) + Math.pow(center[1], 2));\n    end = start - size;\n    bezier = Calculate.bezier([0, 1], [30, 30], [70, 60], [100, 80]);\n    return this.process(\"vignette\", function (rgba) {\n      var dist, div, loc;\n      loc = rgba.locationXY();\n      dist = Calculate.distance(loc.x, loc.y, center[0], center[1]);\n\n      if (dist > end) {\n        div = Math.max(1, bezier[Math.round((dist - end) / size * 100)] / 10 * strength);\n        rgba.r = Math.pow(rgba.r / 255, div) * 255;\n        rgba.g = Math.pow(rgba.g / 255, div) * 255;\n        rgba.b = Math.pow(rgba.b / 255, div) * 255;\n      }\n\n      return rgba;\n    });\n  });\n  Filter.register(\"rectangularVignette\", function (opts) {\n    var defaults, dim, percent, size, _i, _len, _ref;\n\n    defaults = {\n      strength: 50,\n      cornerRadius: 0,\n      method: 'brightness',\n      color: {\n        r: 0,\n        g: 0,\n        b: 0\n      }\n    };\n    opts = Util.extend(defaults, opts);\n\n    if (!opts.size) {\n      return this;\n    } else if (typeof opts.size === \"string\") {\n      percent = parseInt(opts.size, 10) / 100;\n      opts.size = {\n        width: this.dimensions.width * percent,\n        height: this.dimensions.height * percent\n      };\n    } else if (typeof opts.size === \"object\") {\n      _ref = [\"width\", \"height\"];\n\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        dim = _ref[_i];\n\n        if (typeof opts.size[dim] === \"string\") {\n          opts.size[dim] = this.dimensions[dim] * (parseInt(opts.size[dim], 10) / 100);\n        }\n      }\n    } else if (opts.size === \"number\") {\n      size = opts.size;\n      opts.size = {\n        width: size,\n        height: size\n      };\n    }\n\n    if (typeof opts.cornerRadius === \"string\") {\n      opts.cornerRadius = opts.size.width / 2 * (parseInt(opts.cornerRadius, 10) / 100);\n    }\n\n    opts.strength /= 100;\n    opts.size.width = Math.floor(opts.size.width);\n    opts.size.height = Math.floor(opts.size.height);\n    opts.image = {\n      width: this.dimensions.width,\n      height: this.dimensions.height\n    };\n\n    if (opts.method === \"colorize\" && typeof opts.color === \"string\") {\n      opts.color = Convert.hexToRGB(opts.color);\n    }\n\n    opts.coords = {\n      left: (this.dimensions.width - opts.size.width) / 2,\n      right: this.dimensions.width - opts.coords.left,\n      bottom: (this.dimensions.height - opts.size.height) / 2,\n      top: this.dimensions.height - opts.coords.bottom\n    };\n    opts.corners = [{\n      x: opts.coords.left + opts.cornerRadius,\n      y: opts.coords.top - opts.cornerRadius\n    }, {\n      x: opts.coords.right - opts.cornerRadius,\n      y: opts.coords.top - opts.cornerRadius\n    }, {\n      x: opts.coords.right - opts.cornerRadius,\n      y: opts.coords.bottom + opts.cornerRadius\n    }, {\n      x: opts.coords.left + opts.cornerRadius,\n      y: opts.coords.bottom + opts.cornerRadius\n    }];\n    opts.maxDist = Calculate.distance(0, 0, opts.corners[3].x, opts.corners[3].y) - opts.cornerRadius;\n    return this.process(\"rectangularVignette\", function (rgba) {\n      var amt, loc, radialDist;\n      loc = rgba.locationXY();\n\n      if (loc.x > opts.corners[0].x && loc.x < opts.corners[1].x && loc.y > opts.coords.bottom && loc.y < opts.coords.top) {\n        return rgba;\n      }\n\n      if (loc.x > opts.coords.left && loc.x < opts.coords.right && loc.y > opts.corners[3].y && loc.y < opts.corners[2].y) {\n        return rgba;\n      }\n\n      if (loc.x > opts.corners[0].x && loc.x < opts.corners[1].x && loc.y > opts.coords.top) {\n        amt = (loc.y - opts.coords.top) / opts.maxDist;\n      } else if (loc.y > opts.corners[2].y && loc.y < opts.corners[1].y && loc.x > opts.coords.right) {\n        amt = (loc.x - opts.coords.right) / opts.maxDist;\n      } else if (loc.x > opts.corners[0].x && loc.x < opts.corners[1].x && loc.y < opts.coords.bottom) {\n        amt = (opts.coords.bottom - loc.y) / opts.maxDist;\n      } else if (loc.y > opts.corners[2].y && loc.y < opts.corners[1].y && loc.x < opts.coords.left) {\n        amt = (opts.coords.left - loc.x) / opts.maxDist;\n      } else if (loc.x <= opts.corners[0].x && loc.y >= opts.corners[0].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[0].x, opts.corners[0].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x >= opts.corners[1].x && loc.y >= opts.corners[1].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[1].x, opts.corners[1].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x >= opts.corners[2].x && loc.y <= opts.corners[2].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[2].x, opts.corners[2].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x <= opts.corners[3].x && loc.y <= opts.corners[3].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[3].x, opts.corners[3].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      }\n\n      if (amt < 0) {\n        return rgba;\n      }\n\n      return vignetteFilters[opts.method](rgba, amt, opts);\n    });\n  });\n  /*\n  CompoundBlur - Blurring with varying radii for Canvas\n  \n  Version:   0.1\n  Author:  Mario Klingemann\n  Contact:   mario@quasimondo.com\n  Website:  http://www.quasimondo.com/StackBlurForCanvas\n  Twitter:  @quasimondo\n  Modified By: Ryan LeFevre (@meltingice)\n  \n  In case you find this class useful - especially in commercial projects -\n  I am not totally unhappy for a small donation to my PayPal account\n  mario@quasimondo.de\n  \n  Copyright (c) 2011 Mario Klingemann\n  \n  Permission is hereby granted, free of charge, to any person\n  obtaining a copy of this software and associated documentation\n  files (the \"Software\"), to deal in the Software without\n  restriction, including without limitation the rights to use,\n  copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following\n  conditions:\n  \n  The above copyright notice and this permission notice shall be\n  included in all copies or substantial portions of the Software.\n  \n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n  WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n  */\n\n  (function () {\n    var BlurStack, getLinearGradientMap, getRadialGradientMap, mul_table, shg_table;\n    mul_table = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\n    shg_table = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n\n    getLinearGradientMap = function (width, height, centerX, centerY, angle, length, mirrored) {\n      var cnv, context, gradient, x1, x2, y1, y2;\n      cnv = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      cnv.width = width;\n      cnv.height = height;\n      x1 = centerX + Math.cos(angle) * length * 0.5;\n      y1 = centerY + Math.sin(angle) * length * 0.5;\n      x2 = centerX - Math.cos(angle) * length * 0.5;\n      y2 = centerY - Math.sin(angle) * length * 0.5;\n      context = cnv.getContext(\"2d\");\n      gradient = context.createLinearGradient(x1, y1, x2, y2);\n\n      if (!mirrored) {\n        gradient.addColorStop(0, \"white\");\n        gradient.addColorStop(1, \"black\");\n      } else {\n        gradient.addColorStop(0, \"white\");\n        gradient.addColorStop(0.5, \"black\");\n        gradient.addColorStop(1, \"white\");\n      }\n\n      context.fillStyle = gradient;\n      context.fillRect(0, 0, width, height);\n      return context.getImageData(0, 0, width, height);\n    };\n\n    getRadialGradientMap = function (width, height, centerX, centerY, radius1, radius2) {\n      var cnv, context, gradient;\n      cnv = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      cnv.width = width;\n      cnv.height = height;\n      context = cnv.getContext(\"2d\");\n      gradient = context.createRadialGradient(centerX, centerY, radius1, centerX, centerY, radius2);\n      gradient.addColorStop(1, \"white\");\n      gradient.addColorStop(0, \"black\");\n      context.fillStyle = gradient;\n      context.fillRect(0, 0, width, height);\n      return context.getImageData(0, 0, width, height);\n    };\n\n    BlurStack = function () {\n      this.r = 0;\n      this.g = 0;\n      this.b = 0;\n      this.a = 0;\n      return this.next = null;\n    };\n\n    Caman.Plugin.register(\"compoundBlur\", function (radiusData, radius, increaseFactor, blurLevels) {\n      var b_in_sum, b_out_sum, b_sum, blend, currentIndex, div, g_in_sum, g_out_sum, g_sum, height, heightMinus1, i, iblend, idx, imagePixels, index, iradius, lookupValue, mul_sum, p, pb, pg, pixels, pr, r_in_sum, r_out_sum, r_sum, radiusPixels, radiusPlus1, rbs, shg_sum, stack, stackEnd, stackIn, stackOut, stackStart, steps, sumFactor, w4, wh, wh4, width, widthMinus1, x, y, yi, yp, yw, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;\n\n      width = this.dimensions.width;\n      height = this.dimensions.height;\n      imagePixels = this.pixelData;\n      radiusPixels = radiusData.data;\n      wh = width * height;\n      wh4 = wh << 2;\n      pixels = [];\n\n      for (i = _i = 0; 0 <= wh4 ? _i < wh4 : _i > wh4; i = 0 <= wh4 ? ++_i : --_i) {\n        pixels[i] = imagePixels[i];\n      }\n\n      currentIndex = 0;\n      steps = blurLevels;\n      blurLevels -= 1;\n\n      while (steps-- >= 0) {\n        iradius = radius + 0.5 | 0;\n\n        if (iradius === 0) {\n          continue;\n        }\n\n        if (iradius > 256) {\n          iradius = 256;\n        }\n\n        div = iradius + iradius + 1;\n        w4 = width << 2;\n        widthMinus1 = width - 1;\n        heightMinus1 = height - 1;\n        radiusPlus1 = iradius + 1;\n        sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n        stackStart = new BlurStack();\n        stackEnd = void 0;\n        stack = stackStart;\n\n        for (i = _j = 1; 1 <= div ? _j < div : _j > div; i = 1 <= div ? ++_j : --_j) {\n          stack = stack.next = new BlurStack();\n\n          if (i === radiusPlus1) {\n            stackEnd = stack;\n          }\n        }\n\n        stack.next = stackStart;\n        stackIn = null;\n        stackOut = null;\n        yw = yi = 0;\n        mul_sum = mul_table[iradius];\n        shg_sum = shg_table[iradius];\n\n        for (y = _k = 0; 0 <= height ? _k < height : _k > height; y = 0 <= height ? ++_k : --_k) {\n          r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n          r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n          g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n          b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n          r_sum += sumFactor * pr;\n          g_sum += sumFactor * pg;\n          b_sum += sumFactor * pb;\n          stack = stackStart;\n\n          for (i = _l = 0; 0 <= radiusPlus1 ? _l < radiusPlus1 : _l > radiusPlus1; i = 0 <= radiusPlus1 ? ++_l : --_l) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n          }\n\n          for (i = _m = 1; 1 <= radiusPlus1 ? _m < radiusPlus1 : _m > radiusPlus1; i = 1 <= radiusPlus1 ? ++_m : --_m) {\n            p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n            r_sum += (stack.r = pr = pixels[p]) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = pg = pixels[p + 1]) * rbs;\n            b_sum += (stack.b = pb = pixels[p + 2]) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            stack = stack.next;\n          }\n\n          stackIn = stackStart;\n          stackOut = stackEnd;\n\n          for (x = _n = 0; 0 <= width ? _n < width : _n > width; x = 0 <= width ? ++_n : --_n) {\n            pixels[yi] = r_sum * mul_sum >> shg_sum;\n            pixels[yi + 1] = g_sum * mul_sum >> shg_sum;\n            pixels[yi + 2] = b_sum * mul_sum >> shg_sum;\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            p = yw + ((p = x + radiusPlus1) < widthMinus1 ? p : widthMinus1) << 2;\n            r_in_sum += stackIn.r = pixels[p];\n            g_in_sum += stackIn.g = pixels[p + 1];\n            b_in_sum += stackIn.b = pixels[p + 2];\n            r_sum += r_in_sum;\n            g_sum += g_in_sum;\n            b_sum += b_in_sum;\n            stackIn = stackIn.next;\n            r_out_sum += pr = stackOut.r;\n            g_out_sum += pg = stackOut.g;\n            b_out_sum += pb = stackOut.b;\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            stackOut = stackOut.next;\n            yi += 4;\n          }\n\n          yw += width;\n        }\n\n        for (x = _o = 0; 0 <= width ? _o < width : _o > width; x = 0 <= width ? ++_o : --_o) {\n          g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n          yi = x << 2;\n          r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n          g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n          b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n          r_sum += sumFactor * pr;\n          g_sum += sumFactor * pg;\n          b_sum += sumFactor * pb;\n          stack = stackStart;\n\n          for (i = _p = 0; 0 <= radiusPlus1 ? _p < radiusPlus1 : _p > radiusPlus1; i = 0 <= radiusPlus1 ? ++_p : --_p) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n          }\n\n          yp = width;\n\n          for (i = _q = 1; 1 <= radiusPlus1 ? _q < radiusPlus1 : _q > radiusPlus1; i = 1 <= radiusPlus1 ? ++_q : --_q) {\n            yi = yp + x << 2;\n            r_sum += (stack.r = pr = pixels[yi]) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = pg = pixels[yi + 1]) * rbs;\n            b_sum += (stack.b = pb = pixels[yi + 2]) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            stack = stack.next;\n\n            if (i < heightMinus1) {\n              yp += width;\n            }\n          }\n\n          yi = x;\n          stackIn = stackStart;\n          stackOut = stackEnd;\n\n          for (y = _r = 0; 0 <= height ? _r < height : _r > height; y = 0 <= height ? ++_r : --_r) {\n            p = yi << 2;\n            pixels[p] = r_sum * mul_sum >> shg_sum;\n            pixels[p + 1] = g_sum * mul_sum >> shg_sum;\n            pixels[p + 2] = b_sum * mul_sum >> shg_sum;\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            p = x + ((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width << 2;\n            r_sum += r_in_sum += stackIn.r = pixels[p];\n            g_sum += g_in_sum += stackIn.g = pixels[p + 1];\n            b_sum += b_in_sum += stackIn.b = pixels[p + 2];\n            stackIn = stackIn.next;\n            r_out_sum += pr = stackOut.r;\n            g_out_sum += pg = stackOut.g;\n            b_out_sum += pb = stackOut.b;\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            stackOut = stackOut.next;\n            yi += width;\n          }\n        }\n\n        radius *= increaseFactor;\n        i = wh;\n\n        while (--i > -1) {\n          idx = i << 2;\n          lookupValue = (radiusPixels[idx + 2] & 0xff) / 255.0 * blurLevels;\n          index = lookupValue | 0;\n\n          if (index === currentIndex) {\n            blend = 256.0 * (lookupValue - (lookupValue | 0));\n            iblend = 256 - blend;\n            imagePixels[idx] = imagePixels[idx] * iblend + pixels[idx] * blend >> 8;\n            imagePixels[idx + 1] = imagePixels[idx + 1] * iblend + pixels[idx + 1] * blend >> 8;\n            imagePixels[idx + 2] = imagePixels[idx + 2] * iblend + pixels[idx + 2] * blend >> 8;\n          } else if (index === currentIndex + 1) {\n            imagePixels[idx] = pixels[idx];\n            imagePixels[idx + 1] = pixels[idx + 1];\n            imagePixels[idx + 2] = pixels[idx + 2];\n          }\n        }\n\n        currentIndex++;\n      }\n\n      return this;\n    });\n    Caman.Filter.register(\"tiltShift\", function (opts) {\n      var defaults, gradient;\n      defaults = {\n        center: {\n          x: this.dimensions.width / 2,\n          y: this.dimensions.height / 2\n        },\n        angle: 45,\n        focusWidth: 200,\n        startRadius: 3,\n        radiusFactor: 1.5,\n        steps: 3\n      };\n      opts = Util.extend(defaults, opts);\n      opts.angle *= Math.PI / 180;\n      gradient = getLinearGradientMap(this.dimensions.width, this.dimensions.height, opts.center.x, opts.center.y, opts.angle, opts.focusWidth, true);\n      return this.processPlugin(\"compoundBlur\", [gradient, opts.startRadius, opts.radiusFactor, opts.steps]);\n    });\n    return Caman.Filter.register(\"radialBlur\", function (opts) {\n      var defaults, gradient, radius1, radius2;\n      defaults = {\n        size: 50,\n        center: {\n          x: this.dimensions.width / 2,\n          y: this.dimensions.height / 2\n        },\n        startRadius: 3,\n        radiusFactor: 1.5,\n        steps: 3,\n        radius: null\n      };\n      opts = Util.extend(defaults, opts);\n\n      if (!opts.radius) {\n        opts.radius = this.dimensions.width < this.dimensions.height ? this.dimensions.height : this.dimensions.width;\n      }\n\n      radius1 = opts.radius / 2 - opts.size;\n      radius2 = opts.radius / 2;\n      gradient = getRadialGradientMap(this.dimensions.width, this.dimensions.height, opts.center.x, opts.center.y, radius1, radius2);\n      return this.processPlugin(\"compoundBlur\", [gradient, opts.startRadius, opts.radiusFactor, opts.steps]);\n    });\n  })();\n\n  Caman.Filter.register(\"edgeEnhance\", function () {\n    return this.processKernel(\"Edge Enhance\", [0, 0, 0, -1, 1, 0, 0, 0, 0]);\n  });\n  Caman.Filter.register(\"edgeDetect\", function () {\n    return this.processKernel(\"Edge Detect\", [-1, -1, -1, -1, 8, -1, -1, -1, -1]);\n  });\n  Caman.Filter.register(\"emboss\", function () {\n    return this.processKernel(\"Emboss\", [-2, -1, 0, -1, 1, 1, 0, 1, 2]);\n  });\n  Caman.Filter.register(\"posterize\", function (adjust) {\n    var numOfAreas, numOfValues;\n    numOfAreas = 256 / adjust;\n    numOfValues = 255 / (adjust - 1);\n    return this.process(\"posterize\", function (rgba) {\n      rgba.r = Math.floor(Math.floor(rgba.r / numOfAreas) * numOfValues);\n      rgba.g = Math.floor(Math.floor(rgba.g / numOfAreas) * numOfValues);\n      rgba.b = Math.floor(Math.floor(rgba.b / numOfAreas) * numOfValues);\n      return rgba;\n    });\n  });\n  Caman.Filter.register(\"vintage\", function (vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n\n    this.greyscale();\n    this.contrast(5);\n    this.noise(3);\n    this.sepia(100);\n    this.channels({\n      red: 8,\n      blue: 2,\n      green: 4\n    });\n    this.gamma(0.87);\n\n    if (vignette) {\n      return this.vignette(\"40%\", 30);\n    }\n  });\n  Caman.Filter.register(\"lomo\", function (vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n\n    this.brightness(15);\n    this.exposure(15);\n    this.curves('rgb', [0, 0], [200, 0], [155, 255], [255, 255]);\n    this.saturation(-20);\n    this.gamma(1.8);\n\n    if (vignette) {\n      this.vignette(\"50%\", 60);\n    }\n\n    return this.brightness(5);\n  });\n  Caman.Filter.register(\"clarity\", function (grey) {\n    if (grey == null) {\n      grey = false;\n    }\n\n    this.vibrance(20);\n    this.curves('rgb', [5, 0], [130, 150], [190, 220], [250, 255]);\n    this.sharpen(15);\n    this.vignette(\"45%\", 20);\n\n    if (grey) {\n      this.greyscale();\n      this.contrast(4);\n    }\n\n    return this;\n  });\n  Caman.Filter.register(\"sinCity\", function () {\n    this.contrast(100);\n    this.brightness(15);\n    this.exposure(10);\n    this.posterize(80);\n    this.clip(30);\n    return this.greyscale();\n  });\n  Caman.Filter.register(\"sunrise\", function () {\n    this.exposure(3.5);\n    this.saturation(-5);\n    this.vibrance(50);\n    this.sepia(60);\n    this.colorize(\"#e87b22\", 10);\n    this.channels({\n      red: 8,\n      blue: 8\n    });\n    this.contrast(5);\n    this.gamma(1.2);\n    return this.vignette(\"55%\", 25);\n  });\n  Caman.Filter.register(\"crossProcess\", function () {\n    this.exposure(5);\n    this.colorize(\"#e87b22\", 4);\n    this.sepia(20);\n    this.channels({\n      blue: 8,\n      red: 3\n    });\n    this.curves('b', [0, 0], [100, 150], [180, 180], [255, 255]);\n    this.contrast(15);\n    this.vibrance(75);\n    return this.gamma(1.6);\n  });\n  Caman.Filter.register(\"orangePeel\", function () {\n    this.curves('rgb', [0, 0], [100, 50], [140, 200], [255, 255]);\n    this.vibrance(-30);\n    this.saturation(-30);\n    this.colorize('#ff9000', 30);\n    this.contrast(-5);\n    return this.gamma(1.4);\n  });\n  Caman.Filter.register(\"love\", function () {\n    this.brightness(5);\n    this.exposure(8);\n    this.contrast(4);\n    this.colorize('#c42007', 30);\n    this.vibrance(50);\n    return this.gamma(1.3);\n  });\n  Caman.Filter.register(\"grungy\", function () {\n    this.gamma(1.5);\n    this.clip(25);\n    this.saturation(-60);\n    this.contrast(5);\n    this.noise(5);\n    return this.vignette(\"50%\", 30);\n  });\n  Caman.Filter.register(\"jarques\", function () {\n    this.saturation(-35);\n    this.curves('b', [20, 0], [90, 120], [186, 144], [255, 230]);\n    this.curves('r', [0, 0], [144, 90], [138, 120], [255, 255]);\n    this.curves('g', [10, 0], [115, 105], [148, 100], [255, 248]);\n    this.curves('rgb', [0, 0], [120, 100], [128, 140], [255, 255]);\n    return this.sharpen(20);\n  });\n  Caman.Filter.register(\"pinhole\", function () {\n    this.greyscale();\n    this.sepia(10);\n    this.exposure(10);\n    this.contrast(15);\n    return this.vignette(\"60%\", 35);\n  });\n  Caman.Filter.register(\"oldBoot\", function () {\n    this.saturation(-20);\n    this.vibrance(-50);\n    this.gamma(1.1);\n    this.sepia(30);\n    this.channels({\n      red: -10,\n      blue: 5\n    });\n    this.curves('rgb', [0, 0], [80, 50], [128, 230], [255, 255]);\n    return this.vignette(\"60%\", 30);\n  });\n  Caman.Filter.register(\"glowingSun\", function (vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n\n    this.brightness(10);\n    this.newLayer(function () {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(80);\n      this.copyParent();\n      this.filter.gamma(0.8);\n      this.filter.contrast(50);\n      return this.filter.exposure(10);\n    });\n    this.newLayer(function () {\n      this.setBlendingMode(\"softLight\");\n      this.opacity(80);\n      return this.fillColor(\"#f49600\");\n    });\n    this.exposure(20);\n    this.gamma(0.8);\n\n    if (vignette) {\n      return this.vignette(\"45%\", 20);\n    }\n  });\n  Caman.Filter.register(\"hazyDays\", function () {\n    this.gamma(1.2);\n    this.newLayer(function () {\n      this.setBlendingMode(\"overlay\");\n      this.opacity(60);\n      this.copyParent();\n      this.filter.channels({\n        red: 5\n      });\n      return this.filter.stackBlur(15);\n    });\n    this.newLayer(function () {\n      this.setBlendingMode(\"addition\");\n      this.opacity(40);\n      return this.fillColor(\"#6899ba\");\n    });\n    this.newLayer(function () {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(35);\n      this.copyParent();\n      this.filter.brightness(40);\n      this.filter.vibrance(40);\n      this.filter.exposure(30);\n      this.filter.contrast(15);\n      this.filter.curves('r', [0, 40], [128, 128], [128, 128], [255, 215]);\n      this.filter.curves('g', [0, 40], [128, 128], [128, 128], [255, 215]);\n      this.filter.curves('b', [0, 40], [128, 128], [128, 128], [255, 215]);\n      return this.filter.stackBlur(5);\n    });\n    this.curves('r', [20, 0], [128, 158], [128, 128], [235, 255]);\n    this.curves('g', [20, 0], [128, 128], [128, 128], [235, 255]);\n    this.curves('b', [20, 0], [128, 108], [128, 128], [235, 255]);\n    return this.vignette(\"45%\", 20);\n  });\n  Caman.Filter.register(\"herMajesty\", function () {\n    this.brightness(40);\n    this.colorize(\"#ea1c5d\", 10);\n    this.curves('b', [0, 10], [128, 180], [190, 190], [255, 255]);\n    this.newLayer(function () {\n      this.setBlendingMode('overlay');\n      this.opacity(50);\n      this.copyParent();\n      this.filter.gamma(0.7);\n      return this.newLayer(function () {\n        this.setBlendingMode('normal');\n        this.opacity(60);\n        return this.fillColor('#ea1c5d');\n      });\n    });\n    this.newLayer(function () {\n      this.setBlendingMode('multiply');\n      this.opacity(60);\n      this.copyParent();\n      this.filter.saturation(50);\n      this.filter.hue(90);\n      return this.filter.contrast(10);\n    });\n    this.gamma(1.4);\n    this.vibrance(-30);\n    this.newLayer(function () {\n      this.opacity(10);\n      return this.fillColor('#e5f0ff');\n    });\n    return this;\n  });\n  Caman.Filter.register(\"nostalgia\", function () {\n    this.saturation(20);\n    this.gamma(1.4);\n    this.greyscale();\n    this.contrast(5);\n    this.sepia(100);\n    this.channels({\n      red: 8,\n      blue: 2,\n      green: 4\n    });\n    this.gamma(0.8);\n    this.contrast(5);\n    this.exposure(10);\n    this.newLayer(function () {\n      this.setBlendingMode('overlay');\n      this.copyParent();\n      this.opacity(55);\n      return this.filter.stackBlur(10);\n    });\n    return this.vignette(\"50%\", 30);\n  });\n  Caman.Filter.register(\"hemingway\", function () {\n    this.greyscale();\n    this.contrast(10);\n    this.gamma(0.9);\n    this.newLayer(function () {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(40);\n      this.copyParent();\n      this.filter.exposure(15);\n      this.filter.contrast(15);\n      return this.filter.channels({\n        green: 10,\n        red: 5\n      });\n    });\n    this.sepia(30);\n    this.curves('rgb', [0, 10], [120, 90], [180, 200], [235, 255]);\n    this.channels({\n      red: 5,\n      green: -2\n    });\n    return this.exposure(15);\n  });\n  Caman.Filter.register(\"concentrate\", function () {\n    this.sharpen(40);\n    this.saturation(-50);\n    this.channels({\n      red: 3\n    });\n    this.newLayer(function () {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(80);\n      this.copyParent();\n      this.filter.sharpen(5);\n      this.filter.contrast(50);\n      this.filter.exposure(10);\n      return this.filter.channels({\n        blue: 5\n      });\n    });\n    return this.brightness(10);\n  });\n  Caman.Plugin.register(\"rotate\", function (degrees) {\n    var angle, canvas, ctx, height, to_radians, width, x, y;\n    angle = degrees % 360;\n\n    if (angle === 0) {\n      return this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n    }\n\n    to_radians = Math.PI / 180;\n\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas();\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n    }\n\n    if (angle === 90 || angle === -270 || angle === 270 || angle === -90) {\n      width = this.canvas.height;\n      height = this.canvas.width;\n      x = width / 2;\n      y = height / 2;\n    } else if (angle === 180) {\n      width = this.canvas.width;\n      height = this.canvas.height;\n      x = width / 2;\n      y = height / 2;\n    } else {\n      width = Math.sqrt(Math.pow(this.originalWidth, 2) + Math.pow(this.originalHeight, 2));\n      height = width;\n      x = this.canvas.height / 2;\n      y = this.canvas.width / 2;\n    }\n\n    canvas.width = width;\n    canvas.height = height;\n    ctx = canvas.getContext('2d');\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle * to_radians);\n    ctx.drawImage(this.canvas, -this.canvas.width / 2, -this.canvas.height / 2, this.canvas.width, this.canvas.height);\n    ctx.restore();\n    return this.replaceCanvas(canvas);\n  });\n  Caman.Filter.register(\"rotate\", function () {\n    return this.processPlugin(\"rotate\", Array.prototype.slice.call(arguments, 0));\n  });\n  /*\n  StackBlur - a fast almost Gaussian Blur For Canvas v0.31 modified for CamanJS\n  \n  Version:   0.31\n  Author:    Mario Klingemann\n  Contact:   mario@quasimondo.com\n  Website:  http://www.quasimondo.com/StackBlurForCanvas\n  Twitter:  @quasimondo\n  Modified By: Ryan LeFevre (@meltingice)\n  \n  In case you find this class useful - especially in commercial projects -\n  I am not totally unhappy for a small donation to my PayPal account\n  mario@quasimondo.de\n  \n  Or support me on flattr: \n  https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n  \n  Copyright (c) 2010 Mario Klingemann\n  \n  Permission is hereby granted, free of charge, to any person\n  obtaining a copy of this software and associated documentation\n  files (the \"Software\"), to deal in the Software without\n  restriction, including without limitation the rights to use,\n  copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following\n  conditions:\n  \n  The above copyright notice and this permission notice shall be\n  included in all copies or substantial portions of the Software.\n  \n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n  WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n  */\n\n  (function () {\n    var BlurStack, mul_table, shg_table;\n    mul_table = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\n    shg_table = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n\n    BlurStack = function () {\n      this.r = 0;\n      this.g = 0;\n      this.b = 0;\n      this.a = 0;\n      return this.next = null;\n    };\n\n    Caman.Plugin.register(\"stackBlur\", function (radius) {\n      var b_in_sum, b_out_sum, b_sum, div, g_in_sum, g_out_sum, g_sum, height, heightMinus1, i, mul_sum, p, pb, pg, pixels, pr, r_in_sum, r_out_sum, r_sum, radiusPlus1, rbs, shg_sum, stack, stackEnd, stackIn, stackOut, stackStart, sumFactor, w4, width, widthMinus1, x, y, yi, yp, yw, _i, _j, _k, _l, _m, _n, _o, _p, _q;\n\n      if (isNaN(radius) || radius < 1) {\n        return;\n      }\n\n      radius |= 0;\n      pixels = this.pixelData;\n      width = this.dimensions.width;\n      height = this.dimensions.height;\n      div = radius + radius + 1;\n      w4 = width << 2;\n      widthMinus1 = width - 1;\n      heightMinus1 = height - 1;\n      radiusPlus1 = radius + 1;\n      sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n      stackStart = new BlurStack();\n      stack = stackStart;\n\n      for (i = _i = 1; 1 <= div ? _i < div : _i > div; i = 1 <= div ? ++_i : --_i) {\n        stack = stack.next = new BlurStack();\n\n        if (i === radiusPlus1) {\n          stackEnd = stack;\n        }\n      }\n\n      stack.next = stackStart;\n      stackIn = null;\n      stackOut = null;\n      yw = yi = 0;\n      mul_sum = mul_table[radius];\n      shg_sum = shg_table[radius];\n\n      for (y = _j = 0; 0 <= height ? _j < height : _j > height; y = 0 <= height ? ++_j : --_j) {\n        r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        stack = stackStart;\n\n        for (i = _k = 0; 0 <= radiusPlus1 ? _k < radiusPlus1 : _k > radiusPlus1; i = 0 <= radiusPlus1 ? ++_k : --_k) {\n          stack.r = pr;\n          stack.g = pg;\n          stack.b = pb;\n          stack = stack.next;\n        }\n\n        for (i = _l = 1; 1 <= radiusPlus1 ? _l < radiusPlus1 : _l > radiusPlus1; i = 1 <= radiusPlus1 ? ++_l : --_l) {\n          p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n          r_sum += (stack.r = pr = pixels[p]) * (rbs = radiusPlus1 - i);\n          g_sum += (stack.g = pg = pixels[p + 1]) * rbs;\n          b_sum += (stack.b = pb = pixels[p + 2]) * rbs;\n          r_in_sum += pr;\n          g_in_sum += pg;\n          b_in_sum += pb;\n          stack = stack.next;\n        }\n\n        stackIn = stackStart;\n        stackOut = stackEnd;\n\n        for (x = _m = 0; 0 <= width ? _m < width : _m > width; x = 0 <= width ? ++_m : --_m) {\n          pixels[yi] = r_sum * mul_sum >> shg_sum;\n          pixels[yi + 1] = g_sum * mul_sum >> shg_sum;\n          pixels[yi + 2] = b_sum * mul_sum >> shg_sum;\n          r_sum -= r_out_sum;\n          g_sum -= g_out_sum;\n          b_sum -= b_out_sum;\n          r_out_sum -= stackIn.r;\n          g_out_sum -= stackIn.g;\n          b_out_sum -= stackIn.b;\n          p = yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1) << 2;\n          r_in_sum += stackIn.r = pixels[p];\n          g_in_sum += stackIn.g = pixels[p + 1];\n          b_in_sum += stackIn.b = pixels[p + 2];\n          r_sum += r_in_sum;\n          g_sum += g_in_sum;\n          b_sum += b_in_sum;\n          stackIn = stackIn.next;\n          r_out_sum += pr = stackOut.r;\n          g_out_sum += pg = stackOut.g;\n          b_out_sum += pb = stackOut.b;\n          r_in_sum -= pr;\n          g_in_sum -= pg;\n          b_in_sum -= pb;\n          stackOut = stackOut.next;\n          yi += 4;\n        }\n\n        yw += width;\n      }\n\n      for (x = _n = 0; 0 <= width ? _n < width : _n > width; x = 0 <= width ? ++_n : --_n) {\n        g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n        yi = x << 2;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        stack = stackStart;\n\n        for (i = _o = 0; 0 <= radiusPlus1 ? _o < radiusPlus1 : _o > radiusPlus1; i = 0 <= radiusPlus1 ? ++_o : --_o) {\n          stack.r = pr;\n          stack.g = pg;\n          stack.b = pb;\n          stack = stack.next;\n        }\n\n        yp = width;\n\n        for (i = _p = 1; 1 <= radius ? _p <= radius : _p >= radius; i = 1 <= radius ? ++_p : --_p) {\n          yi = yp + x << 2;\n          r_sum += (stack.r = pr = pixels[yi]) * (rbs = radiusPlus1 - i);\n          g_sum += (stack.g = pg = pixels[yi + 1]) * rbs;\n          b_sum += (stack.b = pb = pixels[yi + 2]) * rbs;\n          r_in_sum += pr;\n          g_in_sum += pg;\n          b_in_sum += pb;\n          stack = stack.next;\n\n          if (i < heightMinus1) {\n            yp += width;\n          }\n        }\n\n        yi = x;\n        stackIn = stackStart;\n        stackOut = stackEnd;\n\n        for (y = _q = 0; 0 <= height ? _q < height : _q > height; y = 0 <= height ? ++_q : --_q) {\n          p = yi << 2;\n          pixels[p] = r_sum * mul_sum >> shg_sum;\n          pixels[p + 1] = g_sum * mul_sum >> shg_sum;\n          pixels[p + 2] = b_sum * mul_sum >> shg_sum;\n          r_sum -= r_out_sum;\n          g_sum -= g_out_sum;\n          b_sum -= b_out_sum;\n          r_out_sum -= stackIn.r;\n          g_out_sum -= stackIn.g;\n          b_out_sum -= stackIn.b;\n          p = x + ((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width << 2;\n          r_sum += r_in_sum += stackIn.r = pixels[p];\n          g_sum += g_in_sum += stackIn.g = pixels[p + 1];\n          b_sum += b_in_sum += stackIn.b = pixels[p + 2];\n          stackIn = stackIn.next;\n          r_out_sum += pr = stackOut.r;\n          g_out_sum += pg = stackOut.g;\n          b_out_sum += pb = stackOut.b;\n          r_in_sum -= pr;\n          g_in_sum -= pg;\n          b_in_sum -= pb;\n          stackOut = stackOut.next;\n          yi += width;\n        }\n      }\n\n      return this;\n    });\n    return Caman.Filter.register(\"stackBlur\", function (radius) {\n      return this.processPlugin(\"stackBlur\", [radius]);\n    });\n  })();\n\n  Caman.Filter.register(\"threshold\", function (adjust) {\n    return this.process(\"threshold\", function (rgba) {\n      var luminance;\n      luminance = 0.2126 * rgba.r + 0.7152 * rgba.g + 0.0722 * rgba.b;\n\n      if (luminance < adjust) {\n        rgba.r = 0;\n        rgba.g = 0;\n        rgba.b = 0;\n      } else {\n        rgba.r = 255;\n        rgba.g = 255;\n        rgba.b = 255;\n      }\n\n      return rgba;\n    });\n  });\n}).call(this);","map":{"version":3,"sources":["/Users/zakstratton/Documents/design-tool/node_modules/caman/dist/caman.full.js"],"names":["$","Analyze","Blender","Calculate","Caman","CamanParser","Canvas","Convert","Event","Fiber","Filter","IO","Image","Layer","Log","Module","Pixel","Plugin","Renderer","Root","Store","Util","fs","moduleKeywords","slice","vignetteFilters","__indexOf","indexOf","item","i","l","length","__slice","__hasProp","hasOwnProperty","__bind","fn","me","apply","arguments","__extends","child","parent","key","call","ctor","constructor","prototype","__super__","obj","value","_ref","extended","includes","included","delegate","args","source","target","_i","_len","_results","pop","push","aliasFunction","to","from","_this","aliasProperty","Object","defineProperty","get","set","val","func","Array","sel","root","document","exports","querySelector","uniqid","id","extend","copy","dest","prop","src","clampRGB","copyAttributes","opts","attr","_ref1","attributes","except","nodeName","setAttribute","nodeValue","dataArray","NodeJS","window","Uint8Array","require","_super","version","release","date","DEBUG","allowRevert","crossOrigin","remoteProxy","proxyParam","autoload","toString","getAttrId","canvas","getAttribute","nodeFileReady","callback","finishInit","bind","imageLoaded","parseInt","isNaN","has","execute","initializedPixelData","originalPixelData","cropCoordinates","x","y","cropped","resized","pixelStack","layerStack","canvasQueue","currentLayer","scaled","analyze","renderer","domIsLoaded","parseArguments","setup","cb","listener","setTimeout","readyState","debug","addEventListener","initObj","initType","imageUrl","setInitObject","options","toLowerCase","initNode","initImage","initCanvas","readFile","err","data","image","imageWidth","imageHeight","createElement","context","getContext","parentNode","replaceChild","imageAdjustments","waitForImageLoaded","needsHiDPISwap","hiDPIReplacement","swapped","isRemote","proxyUrl","isImageLoaded","onload","complete","naturalWidth","width","height","naturalHeight","hiDPIRatio","pixel","originalWidth","preScaledWidth","originalHeight","preScaledHeight","hiDPIAdjustments","hasId","assignId","drawImage","imageData","getImageData","pixelData","dimensions","put","reloadCanvasData","resetOriginalPixelData","hiDPIDisabled","ratio","style","scale","backingStoreRatio","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","hiDPICapable","replaceCanvas","newCanvas","oldCanvas","render","trigger","putImageData","revert","updateContext","originalVisiblePixels","reset","ctx","coord","endX","endY","pixels","scaledCanvas","startX","startY","_j","_ref2","_ref3","locationToCoordinates","process","name","processFn","add","type","Type","Single","processKernel","adjust","divisor","bias","Kernel","processPlugin","plugin","newLayer","layer","LayerDequeue","LayerFinished","executeLayer","pushContext","popContext","applyCurrentLayer","applyToParent","c","calculateLevels","levels","numPixels","_k","r","g","b","DOMUpdated","img","imgs","parser","querySelectorAll","parse","INST_REGEX","ele","ready","dataStr","caman","e","filter","inst","instFunc","m","unparsedInstructions","RegExp","match","Function","_error","toImage","blenders","register","rgbaLayer","rgbaParent","distance","x1","y1","x2","y2","Math","sqrt","pow","randomRange","min","max","getFloat","rand","random","toFixed","round","luminance","rgba","bezier","start","ctrl1","ctrl2","end","lowBound","highBound","Ax","Ay","Bx","By","Cx","Cy","curveX","curveY","j","leftCoord","rightCoord","t","x0","x3","y0","y3","hexToRGB","hex","charAt","substr","rgbToHSL","d","h","s","hslToRGB","p","q","hueToRGB","rgbToHSV","v","hsvToRGB","f","floor","rgbToXYZ","z","xyzToRGB","xyzToLab","a","whiteX","whiteY","whiteZ","labToXYZ","rgbToLab","xyz","labToRGB","events","types","event","listen","_fn","_type","LoadOverlay","filterFunc","domainRegex","corsEnabled","isURLRemote","url","matches","domain","remoteCheck","info","encodeURIComponent","useProxy","lang","langToExt","ruby","python","perl","javascript","save","nodeSave","browserSave","toBase64","replace","location","href","file","overwrite","stats","statSync","isFile","writeFile","toBuffer","toDataURL","blendingMode","opacity","layerID","createImageData","setBlendingMode","mode","copyParent","parentData","fillColor","overlayImage","renderQueue","layerData","result","Logger","console","log","coordinatesToLocation","loc","setContext","locationXY","pixelAtLocation","getPixelRelative","horiz","vert","newLoc","putPixelRelative","nowLoc","getPixel","putPixel","toKey","toHex","includeAlpha","plugins","Blocks","cpus","processNext","modPixelData","job","finishedFn","currentJob","shift","loadOverlay","executePlugin","executeFilter","eachBlock","blockN","blockPixelLength","bnum","lastBlockN","n","blocksDone","run","blockFinished","renderBlock","renderKernel","blockNum","totalBlocks","startPixel","endPixel","adjustSize","builder","builderIndex","k","kernel","res","blocksFinished","items","search","flush","color","amt","avg","abs","hsv","level","rgb","chan","red","green","blue","chans","cps","split","reverse","curves","newDims","error","degrees","brightness","strength","gamma","colorize","size","center","dist","div","defaults","dim","percent","cornerRadius","method","coords","left","right","bottom","top","corners","maxDist","radialDist","BlurStack","getLinearGradientMap","getRadialGradientMap","mul_table","shg_table","centerX","centerY","angle","mirrored","cnv","gradient","cos","sin","createLinearGradient","addColorStop","fillStyle","fillRect","radius1","radius2","createRadialGradient","next","radiusData","radius","increaseFactor","blurLevels","b_in_sum","b_out_sum","b_sum","blend","currentIndex","g_in_sum","g_out_sum","g_sum","heightMinus1","iblend","idx","imagePixels","index","iradius","lookupValue","mul_sum","pb","pg","pr","r_in_sum","r_out_sum","r_sum","radiusPixels","radiusPlus1","rbs","shg_sum","stack","stackEnd","stackIn","stackOut","stackStart","steps","sumFactor","w4","wh","wh4","widthMinus1","yi","yp","yw","_l","_m","_n","_o","_p","_q","_r","focusWidth","startRadius","radiusFactor","PI","numOfAreas","numOfValues","vignette","greyscale","contrast","noise","sepia","channels","exposure","saturation","grey","vibrance","sharpen","posterize","clip","stackBlur","hue","to_radians","translate","rotate","restore"],"mappings":"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","sourcesContent":["// Generated by CoffeeScript 1.6.2\n(function() {\n  var $, Analyze, Blender, Calculate, Caman, CamanParser, Canvas, Convert, Event, Fiber, Filter, IO, Image, Layer, Log, Module, Pixel, Plugin, Renderer, Root, Store, Util, fs, moduleKeywords, slice, vignetteFilters,\n    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    __slice = [].slice,\n    __hasProp = {}.hasOwnProperty,\n    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\n  moduleKeywords = ['extended', 'included'];\n\n  Module = (function() {\n    function Module() {}\n\n    Module[\"extends\"] = function(obj) {\n      var key, value, _ref;\n\n      for (key in obj) {\n        value = obj[key];\n        if (__indexOf.call(moduleKeywords, key) < 0) {\n          this[key] = value;\n        }\n      }\n      if ((_ref = obj.extended) != null) {\n        _ref.apply(this);\n      }\n      return this;\n    };\n\n    Module.includes = function(obj) {\n      var key, value, _ref;\n\n      for (key in obj) {\n        value = obj[key];\n        if (__indexOf.call(moduleKeywords, key) < 0) {\n          this.prototype[key] = value;\n        }\n      }\n      if ((_ref = obj.included) != null) {\n        _ref.apply(this);\n      }\n      return this;\n    };\n\n    Module.delegate = function() {\n      var args, source, target, _i, _len, _results;\n\n      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n      target = args.pop();\n      _results = [];\n      for (_i = 0, _len = args.length; _i < _len; _i++) {\n        source = args[_i];\n        _results.push(this.prototype[source] = target.prototype[source]);\n      }\n      return _results;\n    };\n\n    Module.aliasFunction = function(to, from) {\n      var _this = this;\n\n      return this.prototype[to] = function() {\n        var args;\n\n        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n        return _this.prototype[from].apply(_this, args);\n      };\n    };\n\n    Module.aliasProperty = function(to, from) {\n      return Object.defineProperty(this.prototype, to, {\n        get: function() {\n          return this[from];\n        },\n        set: function(val) {\n          return this[from] = val;\n        }\n      });\n    };\n\n    Module.included = function(func) {\n      return func.call(this, this.prototype);\n    };\n\n    return Module;\n\n  })();\n\n  slice = Array.prototype.slice;\n\n  $ = function(sel, root) {\n    if (root == null) {\n      root = document;\n    }\n    if (typeof sel === \"object\" || (typeof exports !== \"undefined\" && exports !== null)) {\n      return sel;\n    }\n    return root.querySelector(sel);\n  };\n\n  Util = (function() {\n    function Util() {}\n\n    Util.uniqid = (function() {\n      var id;\n\n      id = 0;\n      return {\n        get: function() {\n          return id++;\n        }\n      };\n    })();\n\n    Util.extend = function() {\n      var copy, dest, obj, prop, src, _i, _len;\n\n      obj = arguments[0], src = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      dest = obj;\n      for (_i = 0, _len = src.length; _i < _len; _i++) {\n        copy = src[_i];\n        for (prop in copy) {\n          if (!__hasProp.call(copy, prop)) continue;\n          dest[prop] = copy[prop];\n        }\n      }\n      return dest;\n    };\n\n    Util.clampRGB = function(val) {\n      if (val < 0) {\n        return 0;\n      }\n      if (val > 255) {\n        return 255;\n      }\n      return val;\n    };\n\n    Util.copyAttributes = function(from, to, opts) {\n      var attr, _i, _len, _ref, _ref1, _results;\n\n      if (opts == null) {\n        opts = {};\n      }\n      _ref = from.attributes;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        attr = _ref[_i];\n        if ((opts.except != null) && (_ref1 = attr.nodeName, __indexOf.call(opts.except, _ref1) >= 0)) {\n          continue;\n        }\n        _results.push(to.setAttribute(attr.nodeName, attr.nodeValue));\n      }\n      return _results;\n    };\n\n    Util.dataArray = function(length) {\n      if (length == null) {\n        length = 0;\n      }\n      if (Caman.NodeJS || (window.Uint8Array != null)) {\n        return new Uint8Array(length);\n      }\n      return new Array(length);\n    };\n\n    return Util;\n\n  })();\n\n  if (typeof exports !== \"undefined\" && exports !== null) {\n    Root = exports;\n    Canvas = require('canvas');\n    Image = Canvas.Image;\n    Fiber = require('fibers');\n    fs = require('fs');\n  } else {\n    Root = window;\n  }\n\n  Caman = (function(_super) {\n    __extends(Caman, _super);\n\n    Caman.version = {\n      release: \"4.1.2\",\n      date: \"7/27/2013\"\n    };\n\n    Caman.DEBUG = false;\n\n    Caman.allowRevert = true;\n\n    Caman.crossOrigin = \"anonymous\";\n\n    Caman.remoteProxy = \"\";\n\n    Caman.proxyParam = \"camanProxyUrl\";\n\n    Caman.NodeJS = typeof exports !== \"undefined\" && exports !== null;\n\n    Caman.autoload = !Caman.NodeJS;\n\n    Caman.toString = function() {\n      return \"Version \" + Caman.version.release + \", Released \" + Caman.version.date;\n    };\n\n    Caman.getAttrId = function(canvas) {\n      if (Caman.NodeJS) {\n        return true;\n      }\n      if (typeof canvas === \"string\") {\n        canvas = $(canvas);\n      }\n      if (!((canvas != null) && (canvas.getAttribute != null))) {\n        return null;\n      }\n      return canvas.getAttribute('data-caman-id');\n    };\n\n    function Caman() {\n      this.nodeFileReady = __bind(this.nodeFileReady, this);\n      var args, callback, id,\n        _this = this;\n\n      if (arguments.length === 0) {\n        throw \"Invalid arguments\";\n      }\n      if (this instanceof Caman) {\n        this.finishInit = this.finishInit.bind(this);\n        this.imageLoaded = this.imageLoaded.bind(this);\n        args = arguments[0];\n        if (!Caman.NodeJS) {\n          id = parseInt(Caman.getAttrId(args[0]), 10);\n          callback = typeof args[1] === \"function\" ? args[1] : typeof args[2] === \"function\" ? args[2] : function() {};\n          if (!isNaN(id) && Store.has(id)) {\n            return Store.execute(id, callback);\n          }\n        }\n        this.id = Util.uniqid.get();\n        this.initializedPixelData = this.originalPixelData = null;\n        this.cropCoordinates = {\n          x: 0,\n          y: 0\n        };\n        this.cropped = false;\n        this.resized = false;\n        this.pixelStack = [];\n        this.layerStack = [];\n        this.canvasQueue = [];\n        this.currentLayer = null;\n        this.scaled = false;\n        this.analyze = new Analyze(this);\n        this.renderer = new Renderer(this);\n        this.domIsLoaded(function() {\n          _this.parseArguments(args);\n          return _this.setup();\n        });\n        return this;\n      } else {\n        return new Caman(arguments);\n      }\n    }\n\n    Caman.prototype.domIsLoaded = function(cb) {\n      var listener,\n        _this = this;\n\n      if (Caman.NodeJS) {\n        return setTimeout(function() {\n          return cb.call(_this);\n        }, 0);\n      } else {\n        if (document.readyState === \"complete\") {\n          Log.debug(\"DOM initialized\");\n          return setTimeout(function() {\n            return cb.call(_this);\n          }, 0);\n        } else {\n          listener = function() {\n            if (document.readyState === \"complete\") {\n              Log.debug(\"DOM initialized\");\n              return cb.call(_this);\n            }\n          };\n          return document.addEventListener(\"readystatechange\", listener, false);\n        }\n      }\n    };\n\n    Caman.prototype.parseArguments = function(args) {\n      var key, val, _ref, _results;\n\n      if (args.length === 0) {\n        throw \"Invalid arguments given\";\n      }\n      this.initObj = null;\n      this.initType = null;\n      this.imageUrl = null;\n      this.callback = function() {};\n      this.setInitObject(args[0]);\n      if (args.length === 1) {\n        return;\n      }\n      switch (typeof args[1]) {\n        case \"string\":\n          this.imageUrl = args[1];\n          break;\n        case \"function\":\n          this.callback = args[1];\n      }\n      if (args.length === 2) {\n        return;\n      }\n      this.callback = args[2];\n      if (args.length === 4) {\n        _ref = args[4];\n        _results = [];\n        for (key in _ref) {\n          if (!__hasProp.call(_ref, key)) continue;\n          val = _ref[key];\n          _results.push(this.options[key] = val);\n        }\n        return _results;\n      }\n    };\n\n    Caman.prototype.setInitObject = function(obj) {\n      if (Caman.NodeJS) {\n        this.initObj = obj;\n        this.initType = 'node';\n        return;\n      }\n      if (typeof obj === \"object\") {\n        this.initObj = obj;\n      } else {\n        this.initObj = $(obj);\n      }\n      if (this.initObj == null) {\n        throw \"Could not find image or canvas for initialization.\";\n      }\n      return this.initType = this.initObj.nodeName.toLowerCase();\n    };\n\n    Caman.prototype.setup = function() {\n      switch (this.initType) {\n        case \"node\":\n          return this.initNode();\n        case \"img\":\n          return this.initImage();\n        case \"canvas\":\n          return this.initCanvas();\n      }\n    };\n\n    Caman.prototype.initNode = function() {\n      Log.debug(\"Initializing for NodeJS\");\n      if (typeof this.initObj === \"string\") {\n        return fs.readFile(this.initObj, this.nodeFileReady);\n      } else {\n        return this.nodeFileReady(null, this.initObj);\n      }\n    };\n\n    Caman.prototype.nodeFileReady = function(err, data) {\n      if (err) {\n        throw err;\n      }\n      this.image = new Image();\n      this.image.src = data;\n      Log.debug(\"Image loaded. Width = \" + (this.imageWidth()) + \", Height = \" + (this.imageHeight()));\n      this.canvas = new Canvas(this.imageWidth(), this.imageHeight());\n      return this.finishInit();\n    };\n\n    Caman.prototype.initImage = function() {\n      this.image = this.initObj;\n      this.canvas = document.createElement('canvas');\n      this.context = this.canvas.getContext('2d');\n      Util.copyAttributes(this.image, this.canvas, {\n        except: ['src']\n      });\n      this.image.parentNode.replaceChild(this.canvas, this.image);\n      this.imageAdjustments();\n      return this.waitForImageLoaded();\n    };\n\n    Caman.prototype.initCanvas = function() {\n      this.canvas = this.initObj;\n      this.context = this.canvas.getContext('2d');\n      if (this.imageUrl != null) {\n        this.image = document.createElement('img');\n        this.image.src = this.imageUrl;\n        this.imageAdjustments();\n        return this.waitForImageLoaded();\n      } else {\n        return this.finishInit();\n      }\n    };\n\n    Caman.prototype.imageAdjustments = function() {\n      if (this.needsHiDPISwap()) {\n        Log.debug(this.image.src, \"->\", this.hiDPIReplacement());\n        this.swapped = true;\n        this.image.src = this.hiDPIReplacement();\n      }\n      if (IO.isRemote(this.image)) {\n        this.image.src = IO.proxyUrl(this.image.src);\n        return Log.debug(\"Remote image detected, using URL = \" + this.image.src);\n      }\n    };\n\n    Caman.prototype.waitForImageLoaded = function() {\n      if (this.isImageLoaded()) {\n        return this.imageLoaded();\n      } else {\n        return this.image.onload = this.imageLoaded;\n      }\n    };\n\n    Caman.prototype.isImageLoaded = function() {\n      if (!this.image.complete) {\n        return false;\n      }\n      if ((this.image.naturalWidth != null) && this.image.naturalWidth === 0) {\n        return false;\n      }\n      return true;\n    };\n\n    Caman.prototype.imageWidth = function() {\n      return this.image.width || this.image.naturalWidth;\n    };\n\n    Caman.prototype.imageHeight = function() {\n      return this.image.height || this.image.naturalHeight;\n    };\n\n    Caman.prototype.imageLoaded = function() {\n      Log.debug(\"Image loaded. Width = \" + (this.imageWidth()) + \", Height = \" + (this.imageHeight()));\n      if (this.swapped) {\n        this.canvas.width = this.imageWidth() / this.hiDPIRatio();\n        this.canvas.height = this.imageHeight() / this.hiDPIRatio();\n      } else {\n        this.canvas.width = this.imageWidth();\n        this.canvas.height = this.imageHeight();\n      }\n      return this.finishInit();\n    };\n\n    Caman.prototype.finishInit = function() {\n      var i, pixel, _i, _len, _ref;\n\n      if (this.context == null) {\n        this.context = this.canvas.getContext('2d');\n      }\n      this.originalWidth = this.preScaledWidth = this.width = this.canvas.width;\n      this.originalHeight = this.preScaledHeight = this.height = this.canvas.height;\n      this.hiDPIAdjustments();\n      if (!this.hasId()) {\n        this.assignId();\n      }\n      if (this.image != null) {\n        this.context.drawImage(this.image, 0, 0, this.imageWidth(), this.imageHeight(), 0, 0, this.preScaledWidth, this.preScaledHeight);\n      }\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      this.pixelData = this.imageData.data;\n      if (Caman.allowRevert) {\n        this.initializedPixelData = Util.dataArray(this.pixelData.length);\n        this.originalPixelData = Util.dataArray(this.pixelData.length);\n        _ref = this.pixelData;\n        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n          pixel = _ref[i];\n          this.initializedPixelData[i] = pixel;\n          this.originalPixelData[i] = pixel;\n        }\n      }\n      this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n      if (!Caman.NodeJS) {\n        Store.put(this.id, this);\n      }\n      this.callback.call(this, this);\n      return this.callback = function() {};\n    };\n\n    Caman.prototype.reloadCanvasData = function() {\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      return this.pixelData = this.imageData.data;\n    };\n\n    Caman.prototype.resetOriginalPixelData = function() {\n      var i, pixel, _i, _len, _ref, _results;\n\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n      this.originalPixelData = Util.dataArray(this.pixelData.length);\n      _ref = this.pixelData;\n      _results = [];\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n        _results.push(this.originalPixelData[i] = pixel);\n      }\n      return _results;\n    };\n\n    Caman.prototype.hasId = function() {\n      return Caman.getAttrId(this.canvas) != null;\n    };\n\n    Caman.prototype.assignId = function() {\n      if (Caman.NodeJS || this.canvas.getAttribute('data-caman-id')) {\n        return;\n      }\n      return this.canvas.setAttribute('data-caman-id', this.id);\n    };\n\n    Caman.prototype.hiDPIDisabled = function() {\n      return this.canvas.getAttribute('data-caman-hidpi-disabled') !== null;\n    };\n\n    Caman.prototype.hiDPIAdjustments = function() {\n      var ratio;\n\n      if (Caman.NodeJS || !this.needsHiDPISwap()) {\n        return;\n      }\n      ratio = this.hiDPIRatio();\n      if (ratio !== 1) {\n        Log.debug(\"HiDPI ratio = \" + ratio);\n        this.scaled = true;\n        this.preScaledWidth = this.canvas.width;\n        this.preScaledHeight = this.canvas.height;\n        this.canvas.width = this.preScaledWidth * ratio;\n        this.canvas.height = this.preScaledHeight * ratio;\n        this.canvas.style.width = \"\" + this.preScaledWidth + \"px\";\n        this.canvas.style.height = \"\" + this.preScaledHeight + \"px\";\n        this.context.scale(ratio, ratio);\n        this.width = this.originalWidth = this.canvas.width;\n        return this.height = this.originalHeight = this.canvas.height;\n      }\n    };\n\n    Caman.prototype.hiDPIRatio = function() {\n      var backingStoreRatio, devicePixelRatio;\n\n      devicePixelRatio = window.devicePixelRatio || 1;\n      backingStoreRatio = this.context.webkitBackingStorePixelRatio || this.context.mozBackingStorePixelRatio || this.context.msBackingStorePixelRatio || this.context.oBackingStorePixelRatio || this.context.backingStorePixelRatio || 1;\n      return devicePixelRatio / backingStoreRatio;\n    };\n\n    Caman.prototype.hiDPICapable = function() {\n      return (window.devicePixelRatio != null) && window.devicePixelRatio !== 1;\n    };\n\n    Caman.prototype.needsHiDPISwap = function() {\n      if (this.hiDPIDisabled() || !this.hiDPICapable()) {\n        return false;\n      }\n      return this.hiDPIReplacement() !== null;\n    };\n\n    Caman.prototype.hiDPIReplacement = function() {\n      if (this.image == null) {\n        return null;\n      }\n      return this.image.getAttribute('data-caman-hidpi');\n    };\n\n    Caman.prototype.replaceCanvas = function(newCanvas) {\n      var oldCanvas;\n\n      oldCanvas = this.canvas;\n      this.canvas = newCanvas;\n      this.context = this.canvas.getContext('2d');\n      if (!Caman.NodeJS) {\n        oldCanvas.parentNode.replaceChild(this.canvas, oldCanvas);\n      }\n      this.width = this.canvas.width;\n      this.height = this.canvas.height;\n      this.reloadCanvasData();\n      return this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n    };\n\n    Caman.prototype.render = function(callback) {\n      var _this = this;\n\n      if (callback == null) {\n        callback = function() {};\n      }\n      Event.trigger(this, \"renderStart\");\n      return this.renderer.execute(function() {\n        _this.context.putImageData(_this.imageData, 0, 0);\n        return callback.call(_this);\n      });\n    };\n\n    Caman.prototype.revert = function(updateContext) {\n      var i, pixel, _i, _len, _ref;\n\n      if (updateContext == null) {\n        updateContext = true;\n      }\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n      _ref = this.originalVisiblePixels();\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n        this.pixelData[i] = pixel;\n      }\n      if (updateContext) {\n        return this.context.putImageData(this.imageData, 0, 0);\n      }\n    };\n\n    Caman.prototype.reset = function() {\n      var canvas, ctx, i, imageData, pixel, pixelData, _i, _len, _ref;\n\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = this.originalWidth;\n      canvas.height = this.originalHeight;\n      ctx = canvas.getContext('2d');\n      imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      pixelData = imageData.data;\n      _ref = this.initializedPixelData;\n      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n        pixel = _ref[i];\n        pixelData[i] = pixel;\n      }\n      ctx.putImageData(imageData, 0, 0);\n      this.cropCoordinates = {\n        x: 0,\n        y: 0\n      };\n      this.resized = false;\n      return this.replaceCanvas(canvas);\n    };\n\n    Caman.prototype.originalVisiblePixels = function() {\n      var canvas, coord, ctx, endX, endY, i, imageData, pixel, pixelData, pixels, scaledCanvas, startX, startY, width, _i, _j, _len, _ref, _ref1, _ref2, _ref3;\n\n      if (!Caman.allowRevert) {\n        throw \"Revert disabled\";\n      }\n      pixels = [];\n      startX = this.cropCoordinates.x;\n      endX = startX + this.width;\n      startY = this.cropCoordinates.y;\n      endY = startY + this.height;\n      if (this.resized) {\n        canvas = document.createElement('canvas');\n        canvas.width = this.originalWidth;\n        canvas.height = this.originalHeight;\n        ctx = canvas.getContext('2d');\n        imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        pixelData = imageData.data;\n        _ref = this.originalPixelData;\n        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n          pixel = _ref[i];\n          pixelData[i] = pixel;\n        }\n        ctx.putImageData(imageData, 0, 0);\n        scaledCanvas = document.createElement('canvas');\n        scaledCanvas.width = this.width;\n        scaledCanvas.height = this.height;\n        ctx = scaledCanvas.getContext('2d');\n        ctx.drawImage(canvas, 0, 0, this.originalWidth, this.originalHeight, 0, 0, this.width, this.height);\n        pixelData = ctx.getImageData(0, 0, this.width, this.height).data;\n        width = this.width;\n      } else {\n        pixelData = this.originalPixelData;\n        width = this.originalWidth;\n      }\n      for (i = _j = 0, _ref1 = pixelData.length; _j < _ref1; i = _j += 4) {\n        coord = Pixel.locationToCoordinates(i, width);\n        if (((startX <= (_ref2 = coord.x) && _ref2 < endX)) && ((startY <= (_ref3 = coord.y) && _ref3 < endY))) {\n          pixels.push(pixelData[i], pixelData[i + 1], pixelData[i + 2], pixelData[i + 3]);\n        }\n      }\n      return pixels;\n    };\n\n    Caman.prototype.process = function(name, processFn) {\n      this.renderer.add({\n        type: Filter.Type.Single,\n        name: name,\n        processFn: processFn\n      });\n      return this;\n    };\n\n    Caman.prototype.processKernel = function(name, adjust, divisor, bias) {\n      var i, _i, _ref;\n\n      if (divisor == null) {\n        divisor = null;\n      }\n      if (bias == null) {\n        bias = 0;\n      }\n      if (divisor == null) {\n        divisor = 0;\n        for (i = _i = 0, _ref = adjust.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n          divisor += adjust[i];\n        }\n      }\n      this.renderer.add({\n        type: Filter.Type.Kernel,\n        name: name,\n        adjust: adjust,\n        divisor: divisor,\n        bias: bias\n      });\n      return this;\n    };\n\n    Caman.prototype.processPlugin = function(plugin, args) {\n      this.renderer.add({\n        type: Filter.Type.Plugin,\n        plugin: plugin,\n        args: args\n      });\n      return this;\n    };\n\n    Caman.prototype.newLayer = function(callback) {\n      var layer;\n\n      layer = new Layer(this);\n      this.canvasQueue.push(layer);\n      this.renderer.add({\n        type: Filter.Type.LayerDequeue\n      });\n      callback.call(layer);\n      this.renderer.add({\n        type: Filter.Type.LayerFinished\n      });\n      return this;\n    };\n\n    Caman.prototype.executeLayer = function(layer) {\n      return this.pushContext(layer);\n    };\n\n    Caman.prototype.pushContext = function(layer) {\n      this.layerStack.push(this.currentLayer);\n      this.pixelStack.push(this.pixelData);\n      this.currentLayer = layer;\n      return this.pixelData = layer.pixelData;\n    };\n\n    Caman.prototype.popContext = function() {\n      this.pixelData = this.pixelStack.pop();\n      return this.currentLayer = this.layerStack.pop();\n    };\n\n    Caman.prototype.applyCurrentLayer = function() {\n      return this.currentLayer.applyToParent();\n    };\n\n    return Caman;\n\n  })(Module);\n\n  Root.Caman = Caman;\n\n  Caman.Analyze = (function() {\n    function Analyze(c) {\n      this.c = c;\n    }\n\n    Analyze.prototype.calculateLevels = function() {\n      var i, levels, numPixels, _i, _j, _k, _ref;\n\n      levels = {\n        r: {},\n        g: {},\n        b: {}\n      };\n      for (i = _i = 0; _i <= 255; i = ++_i) {\n        levels.r[i] = 0;\n        levels.g[i] = 0;\n        levels.b[i] = 0;\n      }\n      for (i = _j = 0, _ref = this.c.pixelData.length; _j < _ref; i = _j += 4) {\n        levels.r[this.c.pixelData[i]]++;\n        levels.g[this.c.pixelData[i + 1]]++;\n        levels.b[this.c.pixelData[i + 2]]++;\n      }\n      numPixels = this.c.pixelData.length / 4;\n      for (i = _k = 0; _k <= 255; i = ++_k) {\n        levels.r[i] /= numPixels;\n        levels.g[i] /= numPixels;\n        levels.b[i] /= numPixels;\n      }\n      return levels;\n    };\n\n    return Analyze;\n\n  })();\n\n  Analyze = Caman.Analyze;\n\n  Caman.DOMUpdated = function() {\n    var img, imgs, parser, _i, _len, _results;\n\n    imgs = document.querySelectorAll(\"img[data-caman]\");\n    if (!(imgs.length > 0)) {\n      return;\n    }\n    _results = [];\n    for (_i = 0, _len = imgs.length; _i < _len; _i++) {\n      img = imgs[_i];\n      _results.push(parser = new CamanParser(img, function() {\n        this.parse();\n        return this.execute();\n      }));\n    }\n    return _results;\n  };\n\n  if (Caman.autoload) {\n    (function() {\n      if (document.readyState === \"complete\") {\n        return Caman.DOMUpdated();\n      } else {\n        return document.addEventListener(\"DOMContentLoaded\", Caman.DOMUpdated, false);\n      }\n    })();\n  }\n\n  CamanParser = (function() {\n    var INST_REGEX;\n\n    INST_REGEX = \"(\\\\w+)\\\\((.*?)\\\\)\";\n\n    function CamanParser(ele, ready) {\n      this.dataStr = ele.getAttribute('data-caman');\n      this.caman = Caman(ele, ready.bind(this));\n    }\n\n    CamanParser.prototype.parse = function() {\n      var args, e, filter, func, inst, instFunc, m, r, unparsedInstructions, _i, _len, _ref, _results;\n\n      this.ele = this.caman.canvas;\n      r = new RegExp(INST_REGEX, 'g');\n      unparsedInstructions = this.dataStr.match(r);\n      if (!(unparsedInstructions.length > 0)) {\n        return;\n      }\n      r = new RegExp(INST_REGEX);\n      _results = [];\n      for (_i = 0, _len = unparsedInstructions.length; _i < _len; _i++) {\n        inst = unparsedInstructions[_i];\n        _ref = inst.match(r), m = _ref[0], filter = _ref[1], args = _ref[2];\n        instFunc = new Function(\"return function() {        this.\" + filter + \"(\" + args + \");      };\");\n        try {\n          func = instFunc();\n          _results.push(func.call(this.caman));\n        } catch (_error) {\n          e = _error;\n          _results.push(Log.debug(e));\n        }\n      }\n      return _results;\n    };\n\n    CamanParser.prototype.execute = function() {\n      var ele;\n\n      ele = this.ele;\n      return this.caman.render(function() {\n        return ele.parentNode.replaceChild(this.toImage(), ele);\n      });\n    };\n\n    return CamanParser;\n\n  })();\n\n  Caman.Blender = (function() {\n    function Blender() {}\n\n    Blender.blenders = {};\n\n    Blender.register = function(name, func) {\n      return this.blenders[name] = func;\n    };\n\n    Blender.execute = function(name, rgbaLayer, rgbaParent) {\n      return this.blenders[name](rgbaLayer, rgbaParent);\n    };\n\n    return Blender;\n\n  })();\n\n  Blender = Caman.Blender;\n\n  Caman.Calculate = (function() {\n    function Calculate() {}\n\n    Calculate.distance = function(x1, y1, x2, y2) {\n      return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n    };\n\n    Calculate.randomRange = function(min, max, getFloat) {\n      var rand;\n\n      if (getFloat == null) {\n        getFloat = false;\n      }\n      rand = min + (Math.random() * (max - min));\n      if (getFloat) {\n        return rand.toFixed(getFloat);\n      } else {\n        return Math.round(rand);\n      }\n    };\n\n    Calculate.luminance = function(rgba) {\n      return (0.299 * rgba.r) + (0.587 * rgba.g) + (0.114 * rgba.b);\n    };\n\n    Calculate.bezier = function(start, ctrl1, ctrl2, end, lowBound, highBound) {\n      var Ax, Ay, Bx, By, Cx, Cy, bezier, curveX, curveY, i, j, leftCoord, rightCoord, t, x0, x1, x2, x3, y0, y1, y2, y3, _i, _j, _k, _ref, _ref1;\n\n      x0 = start[0];\n      y0 = start[1];\n      x1 = ctrl1[0];\n      y1 = ctrl1[1];\n      x2 = ctrl2[0];\n      y2 = ctrl2[1];\n      x3 = end[0];\n      y3 = end[1];\n      bezier = {};\n      Cx = parseInt(3 * (x1 - x0), 10);\n      Bx = 3 * (x2 - x1) - Cx;\n      Ax = x3 - x0 - Cx - Bx;\n      Cy = 3 * (y1 - y0);\n      By = 3 * (y2 - y1) - Cy;\n      Ay = y3 - y0 - Cy - By;\n      for (i = _i = 0; _i < 1000; i = ++_i) {\n        t = i / 1000;\n        curveX = Math.round((Ax * Math.pow(t, 3)) + (Bx * Math.pow(t, 2)) + (Cx * t) + x0);\n        curveY = Math.round((Ay * Math.pow(t, 3)) + (By * Math.pow(t, 2)) + (Cy * t) + y0);\n        if (lowBound && curveY < lowBound) {\n          curveY = lowBound;\n        } else if (highBound && curveY > highBound) {\n          curveY = highBound;\n        }\n        bezier[curveX] = curveY;\n      }\n      if (bezier.length < end[0] + 1) {\n        for (i = _j = 0, _ref = end[0]; 0 <= _ref ? _j <= _ref : _j >= _ref; i = 0 <= _ref ? ++_j : --_j) {\n          if (bezier[i] == null) {\n            leftCoord = [i - 1, bezier[i - 1]];\n            for (j = _k = i, _ref1 = end[0]; i <= _ref1 ? _k <= _ref1 : _k >= _ref1; j = i <= _ref1 ? ++_k : --_k) {\n              if (bezier[j] != null) {\n                rightCoord = [j, bezier[j]];\n                break;\n              }\n            }\n            bezier[i] = leftCoord[1] + ((rightCoord[1] - leftCoord[1]) / (rightCoord[0] - leftCoord[0])) * (i - leftCoord[0]);\n          }\n        }\n      }\n      if (bezier[end[0]] == null) {\n        bezier[end[0]] = bezier[end[0] - 1];\n      }\n      return bezier;\n    };\n\n    return Calculate;\n\n  })();\n\n  Calculate = Caman.Calculate;\n\n  Caman.Convert = (function() {\n    function Convert() {}\n\n    Convert.hexToRGB = function(hex) {\n      var b, g, r;\n\n      if (hex.charAt(0) === \"#\") {\n        hex = hex.substr(1);\n      }\n      r = parseInt(hex.substr(0, 2), 16);\n      g = parseInt(hex.substr(2, 2), 16);\n      b = parseInt(hex.substr(4, 2), 16);\n      return {\n        r: r,\n        g: g,\n        b: b\n      };\n    };\n\n    Convert.rgbToHSL = function(r, g, b) {\n      var d, h, l, max, min, s;\n\n      if (typeof r === \"object\") {\n        g = r.g;\n        b = r.b;\n        r = r.r;\n      }\n      r /= 255;\n      g /= 255;\n      b /= 255;\n      max = Math.max(r, g, b);\n      min = Math.min(r, g, b);\n      l = (max + min) / 2;\n      if (max === min) {\n        h = s = 0;\n      } else {\n        d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        h = (function() {\n          switch (max) {\n            case r:\n              return (g - b) / d + (g < b ? 6 : 0);\n            case g:\n              return (b - r) / d + 2;\n            case b:\n              return (r - g) / d + 4;\n          }\n        })();\n        h /= 6;\n      }\n      return {\n        h: h,\n        s: s,\n        l: l\n      };\n    };\n\n    Convert.hslToRGB = function(h, s, l) {\n      var b, g, p, q, r;\n\n      if (typeof h === \"object\") {\n        s = h.s;\n        l = h.l;\n        h = h.h;\n      }\n      if (s === 0) {\n        r = g = b = l;\n      } else {\n        q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        p = 2 * l - q;\n        r = this.hueToRGB(p, q, h + 1 / 3);\n        g = this.hueToRGB(p, q, h);\n        b = this.hueToRGB(p, q, h - 1 / 3);\n      }\n      return {\n        r: r * 255,\n        g: g * 255,\n        b: b * 255\n      };\n    };\n\n    Convert.hueToRGB = function(p, q, t) {\n      if (t < 0) {\n        t += 1;\n      }\n      if (t > 1) {\n        t -= 1;\n      }\n      if (t < 1 / 6) {\n        return p + (q - p) * 6 * t;\n      }\n      if (t < 1 / 2) {\n        return q;\n      }\n      if (t < 2 / 3) {\n        return p + (q - p) * (2 / 3 - t) * 6;\n      }\n      return p;\n    };\n\n    Convert.rgbToHSV = function(r, g, b) {\n      var d, h, max, min, s, v;\n\n      r /= 255;\n      g /= 255;\n      b /= 255;\n      max = Math.max(r, g, b);\n      min = Math.min(r, g, b);\n      v = max;\n      d = max - min;\n      s = max === 0 ? 0 : d / max;\n      if (max === min) {\n        h = 0;\n      } else {\n        h = (function() {\n          switch (max) {\n            case r:\n              return (g - b) / d + (g < b ? 6 : 0);\n            case g:\n              return (b - r) / d + 2;\n            case b:\n              return (r - g) / d + 4;\n          }\n        })();\n        h /= 6;\n      }\n      return {\n        h: h,\n        s: s,\n        v: v\n      };\n    };\n\n    Convert.hsvToRGB = function(h, s, v) {\n      var b, f, g, i, p, q, r, t;\n\n      i = Math.floor(h * 6);\n      f = h * 6 - i;\n      p = v * (1 - s);\n      q = v * (1 - f * s);\n      t = v * (1 - (1 - f) * s);\n      switch (i % 6) {\n        case 0:\n          r = v;\n          g = t;\n          b = p;\n          break;\n        case 1:\n          r = q;\n          g = v;\n          b = p;\n          break;\n        case 2:\n          r = p;\n          g = v;\n          b = t;\n          break;\n        case 3:\n          r = p;\n          g = q;\n          b = v;\n          break;\n        case 4:\n          r = t;\n          g = p;\n          b = v;\n          break;\n        case 5:\n          r = v;\n          g = p;\n          b = q;\n      }\n      return {\n        r: Math.floor(r * 255),\n        g: Math.floor(g * 255),\n        b: Math.floor(b * 255)\n      };\n    };\n\n    Convert.rgbToXYZ = function(r, g, b) {\n      var x, y, z;\n\n      r /= 255;\n      g /= 255;\n      b /= 255;\n      if (r > 0.04045) {\n        r = Math.pow((r + 0.055) / 1.055, 2.4);\n      } else {\n        r /= 12.92;\n      }\n      if (g > 0.04045) {\n        g = Math.pow((g + 0.055) / 1.055, 2.4);\n      } else {\n        g /= 12.92;\n      }\n      if (b > 0.04045) {\n        b = Math.pow((b + 0.055) / 1.055, 2.4);\n      } else {\n        b /= 12.92;\n      }\n      x = r * 0.4124 + g * 0.3576 + b * 0.1805;\n      y = r * 0.2126 + g * 0.7152 + b * 0.0722;\n      z = r * 0.0193 + g * 0.1192 + b * 0.9505;\n      return {\n        x: x * 100,\n        y: y * 100,\n        z: z * 100\n      };\n    };\n\n    Convert.xyzToRGB = function(x, y, z) {\n      var b, g, r;\n\n      x /= 100;\n      y /= 100;\n      z /= 100;\n      r = (3.2406 * x) + (-1.5372 * y) + (-0.4986 * z);\n      g = (-0.9689 * x) + (1.8758 * y) + (0.0415 * z);\n      b = (0.0557 * x) + (-0.2040 * y) + (1.0570 * z);\n      if (r > 0.0031308) {\n        r = (1.055 * Math.pow(r, 0.4166666667)) - 0.055;\n      } else {\n        r *= 12.92;\n      }\n      if (g > 0.0031308) {\n        g = (1.055 * Math.pow(g, 0.4166666667)) - 0.055;\n      } else {\n        g *= 12.92;\n      }\n      if (b > 0.0031308) {\n        b = (1.055 * Math.pow(b, 0.4166666667)) - 0.055;\n      } else {\n        b *= 12.92;\n      }\n      return {\n        r: r * 255,\n        g: g * 255,\n        b: b * 255\n      };\n    };\n\n    Convert.xyzToLab = function(x, y, z) {\n      var a, b, l, whiteX, whiteY, whiteZ;\n\n      if (typeof x === \"object\") {\n        y = x.y;\n        z = x.z;\n        x = x.x;\n      }\n      whiteX = 95.047;\n      whiteY = 100.0;\n      whiteZ = 108.883;\n      x /= whiteX;\n      y /= whiteY;\n      z /= whiteZ;\n      if (x > 0.008856451679) {\n        x = Math.pow(x, 0.3333333333);\n      } else {\n        x = (7.787037037 * x) + 0.1379310345;\n      }\n      if (y > 0.008856451679) {\n        y = Math.pow(y, 0.3333333333);\n      } else {\n        y = (7.787037037 * y) + 0.1379310345;\n      }\n      if (z > 0.008856451679) {\n        z = Math.pow(z, 0.3333333333);\n      } else {\n        z = (7.787037037 * z) + 0.1379310345;\n      }\n      l = 116 * y - 16;\n      a = 500 * (x - y);\n      b = 200 * (y - z);\n      return {\n        l: l,\n        a: a,\n        b: b\n      };\n    };\n\n    Convert.labToXYZ = function(l, a, b) {\n      var x, y, z;\n\n      if (typeof l === \"object\") {\n        a = l.a;\n        b = l.b;\n        l = l.l;\n      }\n      y = (l + 16) / 116;\n      x = y + (a / 500);\n      z = y - (b / 200);\n      if (x > 0.2068965517) {\n        x = x * x * x;\n      } else {\n        x = 0.1284185493 * (x - 0.1379310345);\n      }\n      if (y > 0.2068965517) {\n        y = y * y * y;\n      } else {\n        y = 0.1284185493 * (y - 0.1379310345);\n      }\n      if (z > 0.2068965517) {\n        z = z * z * z;\n      } else {\n        z = 0.1284185493 * (z - 0.1379310345);\n      }\n      return {\n        x: x * 95.047,\n        y: y * 100.0,\n        z: z * 108.883\n      };\n    };\n\n    Convert.rgbToLab = function(r, g, b) {\n      var xyz;\n\n      if (typeof r === \"object\") {\n        g = r.g;\n        b = r.b;\n        r = r.r;\n      }\n      xyz = this.rgbToXYZ(r, g, b);\n      return this.xyzToLab(xyz);\n    };\n\n    Convert.labToRGB = function(l, a, b) {};\n\n    return Convert;\n\n  })();\n\n  Convert = Caman.Convert;\n\n  Caman.Event = (function() {\n    function Event() {}\n\n    Event.events = {};\n\n    Event.types = [\"processStart\", \"processComplete\", \"renderStart\", \"renderFinished\", \"blockStarted\", \"blockFinished\"];\n\n    Event.trigger = function(target, type, data) {\n      var event, _i, _len, _ref, _results;\n\n      if (data == null) {\n        data = null;\n      }\n      if (this.events[type] && this.events[type].length) {\n        _ref = this.events[type];\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          event = _ref[_i];\n          if (event.target === null || target.id === event.target.id) {\n            _results.push(event.fn.call(target, data));\n          } else {\n            _results.push(void 0);\n          }\n        }\n        return _results;\n      }\n    };\n\n    Event.listen = function(target, type, fn) {\n      var _fn, _type;\n\n      if (typeof target === \"string\") {\n        _type = target;\n        _fn = type;\n        target = null;\n        type = _type;\n        fn = _fn;\n      }\n      if (__indexOf.call(this.types, type) < 0) {\n        return false;\n      }\n      if (!this.events[type]) {\n        this.events[type] = [];\n      }\n      this.events[type].push({\n        target: target,\n        fn: fn\n      });\n      return true;\n    };\n\n    return Event;\n\n  })();\n\n  Event = Caman.Event;\n\n  Caman.Filter = (function() {\n    function Filter() {}\n\n    Filter.Type = {\n      Single: 1,\n      Kernel: 2,\n      LayerDequeue: 3,\n      LayerFinished: 4,\n      LoadOverlay: 5,\n      Plugin: 6\n    };\n\n    Filter.register = function(name, filterFunc) {\n      return Caman.prototype[name] = filterFunc;\n    };\n\n    return Filter;\n\n  })();\n\n  Filter = Caman.Filter;\n\n  Caman.IO = (function() {\n    function IO() {}\n\n    IO.domainRegex = /(?:(?:http|https):\\/\\/)((?:\\w+)\\.(?:(?:\\w|\\.)+))/;\n\n    IO.isRemote = function(img) {\n      if (img == null) {\n        return false;\n      }\n      if (this.corsEnabled(img)) {\n        return false;\n      }\n      return this.isURLRemote(img.src);\n    };\n\n    IO.corsEnabled = function(img) {\n      var _ref;\n\n      return (img.crossOrigin != null) && ((_ref = img.crossOrigin.toLowerCase()) === 'anonymous' || _ref === 'use-credentials');\n    };\n\n    IO.isURLRemote = function(url) {\n      var matches;\n\n      matches = url.match(this.domainRegex);\n      if (matches) {\n        return matches[1] !== document.domain;\n      } else {\n        return false;\n      }\n    };\n\n    IO.remoteCheck = function(src) {\n      if (this.isURLRemote(src)) {\n        if (!Caman.remoteProxy.length) {\n          Log.info(\"Attempting to load a remote image without a configured proxy. URL: \" + src);\n        } else {\n          if (Caman.isURLRemote(Caman.remoteProxy)) {\n            Log.info(\"Cannot use a remote proxy for loading images.\");\n            return;\n          }\n          return this.proxyUrl(src);\n        }\n      }\n    };\n\n    IO.proxyUrl = function(src) {\n      return \"\" + Caman.remoteProxy + \"?\" + Caman.proxyParam + \"=\" + (encodeURIComponent(src));\n    };\n\n    IO.useProxy = function(lang) {\n      var langToExt;\n\n      langToExt = {\n        ruby: 'rb',\n        python: 'py',\n        perl: 'pl',\n        javascript: 'js'\n      };\n      lang = lang.toLowerCase();\n      if (langToExt[lang] != null) {\n        lang = langToExt[lang];\n      }\n      return \"proxies/caman_proxy.\" + lang;\n    };\n\n    return IO;\n\n  })();\n\n  Caman.prototype.save = function() {\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      return this.nodeSave.apply(this, arguments);\n    } else {\n      return this.browserSave.apply(this, arguments);\n    }\n  };\n\n  Caman.prototype.browserSave = function(type) {\n    var image;\n\n    if (type == null) {\n      type = \"png\";\n    }\n    type = type.toLowerCase();\n    image = this.toBase64(type).replace(\"image/\" + type, \"image/octet-stream\");\n    return document.location.href = image;\n  };\n\n  Caman.prototype.nodeSave = function(file, overwrite) {\n    var e, stats;\n\n    if (overwrite == null) {\n      overwrite = true;\n    }\n    try {\n      stats = fs.statSync(file);\n      if (stats.isFile() && !overwrite) {\n        return false;\n      }\n    } catch (_error) {\n      e = _error;\n      Log.debug(\"Creating output file \" + file);\n    }\n    return fs.writeFile(file, this.canvas.toBuffer(), function() {\n      return Log.debug(\"Finished writing to \" + file);\n    });\n  };\n\n  Caman.prototype.toImage = function(type) {\n    var img;\n\n    img = document.createElement('img');\n    img.src = this.toBase64(type);\n    img.width = this.dimensions.width;\n    img.height = this.dimensions.height;\n    if (window.devicePixelRatio) {\n      img.width /= window.devicePixelRatio;\n      img.height /= window.devicePixelRatio;\n    }\n    return img;\n  };\n\n  Caman.prototype.toBase64 = function(type) {\n    if (type == null) {\n      type = \"png\";\n    }\n    type = type.toLowerCase();\n    return this.canvas.toDataURL(\"image/\" + type);\n  };\n\n  IO = Caman.IO;\n\n  Caman.Layer = (function() {\n    function Layer(c) {\n      this.c = c;\n      this.filter = this.c;\n      this.options = {\n        blendingMode: 'normal',\n        opacity: 1.0\n      };\n      this.layerID = Util.uniqid.get();\n      this.canvas = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      this.canvas.width = this.c.dimensions.width;\n      this.canvas.height = this.c.dimensions.height;\n      this.context = this.canvas.getContext('2d');\n      this.context.createImageData(this.canvas.width, this.canvas.height);\n      this.imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      this.pixelData = this.imageData.data;\n    }\n\n    Layer.prototype.newLayer = function(cb) {\n      return this.c.newLayer.call(this.c, cb);\n    };\n\n    Layer.prototype.setBlendingMode = function(mode) {\n      this.options.blendingMode = mode;\n      return this;\n    };\n\n    Layer.prototype.opacity = function(opacity) {\n      this.options.opacity = opacity / 100;\n      return this;\n    };\n\n    Layer.prototype.copyParent = function() {\n      var i, parentData, _i, _ref;\n\n      parentData = this.c.pixelData;\n      for (i = _i = 0, _ref = this.c.pixelData.length; _i < _ref; i = _i += 4) {\n        this.pixelData[i] = parentData[i];\n        this.pixelData[i + 1] = parentData[i + 1];\n        this.pixelData[i + 2] = parentData[i + 2];\n        this.pixelData[i + 3] = parentData[i + 3];\n      }\n      return this;\n    };\n\n    Layer.prototype.fillColor = function() {\n      return this.c.fillColor.apply(this.c, arguments);\n    };\n\n    Layer.prototype.overlayImage = function(image) {\n      if (typeof image === \"object\") {\n        image = image.src;\n      } else if (typeof image === \"string\" && image[0] === \"#\") {\n        image = $(image).src;\n      }\n      if (!image) {\n        return this;\n      }\n      this.c.renderer.renderQueue.push({\n        type: Filter.Type.LoadOverlay,\n        src: image,\n        layer: this\n      });\n      return this;\n    };\n\n    Layer.prototype.applyToParent = function() {\n      var i, layerData, parentData, result, rgbaLayer, rgbaParent, _i, _ref, _results;\n\n      parentData = this.c.pixelStack[this.c.pixelStack.length - 1];\n      layerData = this.c.pixelData;\n      _results = [];\n      for (i = _i = 0, _ref = layerData.length; _i < _ref; i = _i += 4) {\n        rgbaParent = {\n          r: parentData[i],\n          g: parentData[i + 1],\n          b: parentData[i + 2],\n          a: parentData[i + 3]\n        };\n        rgbaLayer = {\n          r: layerData[i],\n          g: layerData[i + 1],\n          b: layerData[i + 2],\n          a: layerData[i + 3]\n        };\n        result = Blender.execute(this.options.blendingMode, rgbaLayer, rgbaParent);\n        result.r = Util.clampRGB(result.r);\n        result.g = Util.clampRGB(result.g);\n        result.b = Util.clampRGB(result.b);\n        if (result.a == null) {\n          result.a = rgbaLayer.a;\n        }\n        parentData[i] = rgbaParent.r - ((rgbaParent.r - result.r) * (this.options.opacity * (result.a / 255)));\n        parentData[i + 1] = rgbaParent.g - ((rgbaParent.g - result.g) * (this.options.opacity * (result.a / 255)));\n        _results.push(parentData[i + 2] = rgbaParent.b - ((rgbaParent.b - result.b) * (this.options.opacity * (result.a / 255))));\n      }\n      return _results;\n    };\n\n    return Layer;\n\n  })();\n\n  Layer = Caman.Layer;\n\n  Caman.Logger = (function() {\n    function Logger() {\n      var name, _i, _len, _ref;\n\n      _ref = ['log', 'info', 'warn', 'error'];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        name = _ref[_i];\n        this[name] = (function(name) {\n          return function() {\n            var args, e;\n\n            args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n            if (!Caman.DEBUG) {\n              return;\n            }\n            try {\n              return console[name].apply(console, args);\n            } catch (_error) {\n              e = _error;\n              return console[name](args);\n            }\n          };\n        })(name);\n      }\n      this.debug = this.log;\n    }\n\n    return Logger;\n\n  })();\n\n  Log = new Caman.Logger();\n\n  Caman.Pixel = (function() {\n    Pixel.coordinatesToLocation = function(x, y, width) {\n      return (y * width + x) * 4;\n    };\n\n    Pixel.locationToCoordinates = function(loc, width) {\n      var x, y;\n\n      y = Math.floor(loc / (width * 4));\n      x = (loc % (width * 4)) / 4;\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    function Pixel(r, g, b, a, c) {\n      this.r = r != null ? r : 0;\n      this.g = g != null ? g : 0;\n      this.b = b != null ? b : 0;\n      this.a = a != null ? a : 255;\n      this.c = c != null ? c : null;\n      this.loc = 0;\n    }\n\n    Pixel.prototype.setContext = function(c) {\n      return this.c = c;\n    };\n\n    Pixel.prototype.locationXY = function() {\n      var x, y;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      y = this.c.dimensions.height - Math.floor(this.loc / (this.c.dimensions.width * 4));\n      x = (this.loc % (this.c.dimensions.width * 4)) / 4;\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    Pixel.prototype.pixelAtLocation = function(loc) {\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      return new Pixel(this.c.pixelData[loc], this.c.pixelData[loc + 1], this.c.pixelData[loc + 2], this.c.pixelData[loc + 3], this.c);\n    };\n\n    Pixel.prototype.getPixelRelative = function(horiz, vert) {\n      var newLoc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      newLoc = this.loc + (this.c.dimensions.width * 4 * (vert * -1)) + (4 * horiz);\n      if (newLoc > this.c.pixelData.length || newLoc < 0) {\n        return new Pixel(0, 0, 0, 255, this.c);\n      }\n      return this.pixelAtLocation(newLoc);\n    };\n\n    Pixel.prototype.putPixelRelative = function(horiz, vert, rgba) {\n      var nowLoc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      nowLoc = this.loc + (this.c.dimensions.width * 4 * (vert * -1)) + (4 * horiz);\n      if (newLoc > this.c.pixelData.length || newLoc < 0) {\n        return;\n      }\n      this.c.pixelData[newLoc] = rgba.r;\n      this.c.pixelData[newLoc + 1] = rgba.g;\n      this.c.pixelData[newLoc + 2] = rgba.b;\n      this.c.pixelData[newLoc + 3] = rgba.a;\n      return true;\n    };\n\n    Pixel.prototype.getPixel = function(x, y) {\n      var loc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      loc = this.coordinatesToLocation(x, y, this.width);\n      return this.pixelAtLocation(loc);\n    };\n\n    Pixel.prototype.putPixel = function(x, y, rgba) {\n      var loc;\n\n      if (this.c == null) {\n        throw \"Requires a CamanJS context\";\n      }\n      loc = this.coordinatesToLocation(x, y, this.width);\n      this.c.pixelData[loc] = rgba.r;\n      this.c.pixelData[loc + 1] = rgba.g;\n      this.c.pixelData[loc + 2] = rgba.b;\n      return this.c.pixelData[loc + 3] = rgba.a;\n    };\n\n    Pixel.prototype.toString = function() {\n      return this.toKey();\n    };\n\n    Pixel.prototype.toHex = function(includeAlpha) {\n      var hex;\n\n      if (includeAlpha == null) {\n        includeAlpha = false;\n      }\n      hex = '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16);\n      if (includeAlpha) {\n        return hex + this.a.toString(16);\n      } else {\n        return hex;\n      }\n    };\n\n    return Pixel;\n\n  })();\n\n  Pixel = Caman.Pixel;\n\n  Caman.Plugin = (function() {\n    function Plugin() {}\n\n    Plugin.plugins = {};\n\n    Plugin.register = function(name, plugin) {\n      return this.plugins[name] = plugin;\n    };\n\n    Plugin.execute = function(context, name, args) {\n      return this.plugins[name].apply(context, args);\n    };\n\n    return Plugin;\n\n  })();\n\n  Plugin = Caman.Plugin;\n\n  Caman.Renderer = (function() {\n    Renderer.Blocks = Caman.NodeJS ? require('os').cpus().length : 4;\n\n    function Renderer(c) {\n      this.c = c;\n      this.processNext = __bind(this.processNext, this);\n      this.renderQueue = [];\n      this.modPixelData = null;\n    }\n\n    Renderer.prototype.add = function(job) {\n      if (job == null) {\n        return;\n      }\n      return this.renderQueue.push(job);\n    };\n\n    Renderer.prototype.processNext = function() {\n      var layer;\n\n      if (this.renderQueue.length === 0) {\n        Event.trigger(this, \"renderFinished\");\n        if (this.finishedFn != null) {\n          this.finishedFn.call(this.c);\n        }\n        return this;\n      }\n      this.currentJob = this.renderQueue.shift();\n      switch (this.currentJob.type) {\n        case Filter.Type.LayerDequeue:\n          layer = this.c.canvasQueue.shift();\n          this.c.executeLayer(layer);\n          return this.processNext();\n        case Filter.Type.LayerFinished:\n          this.c.applyCurrentLayer();\n          this.c.popContext();\n          return this.processNext();\n        case Filter.Type.LoadOverlay:\n          return this.loadOverlay(this.currentJob.layer, this.currentJob.src);\n        case Filter.Type.Plugin:\n          return this.executePlugin();\n        default:\n          return this.executeFilter();\n      }\n    };\n\n    Renderer.prototype.execute = function(callback) {\n      this.finishedFn = callback;\n      this.modPixelData = Util.dataArray(this.c.pixelData.length);\n      return this.processNext();\n    };\n\n    Renderer.prototype.eachBlock = function(fn) {\n      var blockN, blockPixelLength, bnum, end, f, i, lastBlockN, n, start, _i, _ref, _results,\n        _this = this;\n\n      this.blocksDone = 0;\n      n = this.c.pixelData.length;\n      blockPixelLength = Math.floor((n / 4) / Renderer.Blocks);\n      blockN = blockPixelLength * 4;\n      lastBlockN = blockN + ((n / 4) % Renderer.Blocks) * 4;\n      _results = [];\n      for (i = _i = 0, _ref = Renderer.Blocks; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        start = i * blockN;\n        end = start + (i === Renderer.Blocks - 1 ? lastBlockN : blockN);\n        if (Caman.NodeJS) {\n          f = Fiber(function() {\n            return fn.call(_this, i, start, end);\n          });\n          bnum = f.run();\n          _results.push(this.blockFinished(bnum));\n        } else {\n          _results.push(setTimeout((function(i, start, end) {\n            return function() {\n              return fn.call(_this, i, start, end);\n            };\n          })(i, start, end), 0));\n        }\n      }\n      return _results;\n    };\n\n    Renderer.prototype.executeFilter = function() {\n      Event.trigger(this.c, \"processStart\", this.currentJob);\n      if (this.currentJob.type === Filter.Type.Single) {\n        return this.eachBlock(this.renderBlock);\n      } else {\n        return this.eachBlock(this.renderKernel);\n      }\n    };\n\n    Renderer.prototype.executePlugin = function() {\n      Log.debug(\"Executing plugin \" + this.currentJob.plugin);\n      Plugin.execute(this.c, this.currentJob.plugin, this.currentJob.args);\n      Log.debug(\"Plugin \" + this.currentJob.plugin + \" finished!\");\n      return this.processNext();\n    };\n\n    Renderer.prototype.renderBlock = function(bnum, start, end) {\n      var i, pixel, _i;\n\n      Log.debug(\"Block #\" + bnum + \" - Filter: \" + this.currentJob.name + \", Start: \" + start + \", End: \" + end);\n      Event.trigger(this.c, \"blockStarted\", {\n        blockNum: bnum,\n        totalBlocks: Renderer.Blocks,\n        startPixel: start,\n        endPixel: end\n      });\n      pixel = new Pixel();\n      pixel.setContext(this.c);\n      for (i = _i = start; _i < end; i = _i += 4) {\n        pixel.loc = i;\n        pixel.r = this.c.pixelData[i];\n        pixel.g = this.c.pixelData[i + 1];\n        pixel.b = this.c.pixelData[i + 2];\n        pixel.a = this.c.pixelData[i + 3];\n        this.currentJob.processFn(pixel);\n        this.c.pixelData[i] = Util.clampRGB(pixel.r);\n        this.c.pixelData[i + 1] = Util.clampRGB(pixel.g);\n        this.c.pixelData[i + 2] = Util.clampRGB(pixel.b);\n        this.c.pixelData[i + 3] = Util.clampRGB(pixel.a);\n      }\n      if (Caman.NodeJS) {\n        return Fiber[\"yield\"](bnum);\n      } else {\n        return this.blockFinished(bnum);\n      }\n    };\n\n    Renderer.prototype.renderKernel = function(bnum, start, end) {\n      var adjust, adjustSize, bias, builder, builderIndex, divisor, i, j, k, kernel, n, name, p, pixel, res, _i, _j, _k;\n\n      name = this.currentJob.name;\n      bias = this.currentJob.bias;\n      divisor = this.currentJob.divisor;\n      n = this.c.pixelData.length;\n      adjust = this.currentJob.adjust;\n      adjustSize = Math.sqrt(adjust.length);\n      kernel = [];\n      Log.debug(\"Rendering kernel - Filter: \" + this.currentJob.name);\n      start = Math.max(start, this.c.dimensions.width * 4 * ((adjustSize - 1) / 2));\n      end = Math.min(end, n - (this.c.dimensions.width * 4 * ((adjustSize - 1) / 2)));\n      builder = (adjustSize - 1) / 2;\n      pixel = new Pixel();\n      pixel.setContext(this.c);\n      for (i = _i = start; _i < end; i = _i += 4) {\n        pixel.loc = i;\n        builderIndex = 0;\n        for (j = _j = -builder; -builder <= builder ? _j <= builder : _j >= builder; j = -builder <= builder ? ++_j : --_j) {\n          for (k = _k = builder; builder <= -builder ? _k <= -builder : _k >= -builder; k = builder <= -builder ? ++_k : --_k) {\n            p = pixel.getPixelRelative(j, k);\n            kernel[builderIndex * 3] = p.r;\n            kernel[builderIndex * 3 + 1] = p.g;\n            kernel[builderIndex * 3 + 2] = p.b;\n            builderIndex++;\n          }\n        }\n        res = this.processKernel(adjust, kernel, divisor, bias);\n        this.modPixelData[i] = Util.clampRGB(res.r);\n        this.modPixelData[i + 1] = Util.clampRGB(res.g);\n        this.modPixelData[i + 2] = Util.clampRGB(res.b);\n        this.modPixelData[i + 3] = this.c.pixelData[i + 3];\n      }\n      if (Caman.NodeJS) {\n        return Fiber[\"yield\"](bnum);\n      } else {\n        return this.blockFinished(bnum);\n      }\n    };\n\n    Renderer.prototype.blockFinished = function(bnum) {\n      var i, _i, _ref;\n\n      if (bnum >= 0) {\n        Log.debug(\"Block #\" + bnum + \" finished! Filter: \" + this.currentJob.name);\n      }\n      this.blocksDone++;\n      Event.trigger(this.c, \"blockFinished\", {\n        blockNum: bnum,\n        blocksFinished: this.blocksDone,\n        totalBlocks: Renderer.Blocks\n      });\n      if (this.blocksDone === Renderer.Blocks) {\n        if (this.currentJob.type === Filter.Type.Kernel) {\n          for (i = _i = 0, _ref = this.c.pixelData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n            this.c.pixelData[i] = this.modPixelData[i];\n          }\n        }\n        if (bnum >= 0) {\n          Log.debug(\"Filter \" + this.currentJob.name + \" finished!\");\n        }\n        Event.trigger(this.c, \"processComplete\", this.currentJob);\n        return this.processNext();\n      }\n    };\n\n    Renderer.prototype.processKernel = function(adjust, kernel, divisor, bias) {\n      var i, val, _i, _ref;\n\n      val = {\n        r: 0,\n        g: 0,\n        b: 0\n      };\n      for (i = _i = 0, _ref = adjust.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        val.r += adjust[i] * kernel[i * 3];\n        val.g += adjust[i] * kernel[i * 3 + 1];\n        val.b += adjust[i] * kernel[i * 3 + 2];\n      }\n      val.r = (val.r / divisor) + bias;\n      val.g = (val.g / divisor) + bias;\n      val.b = (val.b / divisor) + bias;\n      return val;\n    };\n\n    Renderer.prototype.loadOverlay = function(layer, src) {\n      var img, proxyUrl,\n        _this = this;\n\n      img = document.createElement('img');\n      img.onload = function() {\n        layer.context.drawImage(img, 0, 0, _this.c.dimensions.width, _this.c.dimensions.height);\n        layer.imageData = layer.context.getImageData(0, 0, _this.c.dimensions.width, _this.c.dimensions.height);\n        layer.pixelData = layer.imageData.data;\n        _this.c.pixelData = layer.pixelData;\n        return _this.processNext();\n      };\n      proxyUrl = IO.remoteCheck(src);\n      return img.src = proxyUrl != null ? proxyUrl : src;\n    };\n\n    return Renderer;\n\n  })();\n\n  Renderer = Caman.Renderer;\n\n  Caman.Store = (function() {\n    function Store() {}\n\n    Store.items = {};\n\n    Store.has = function(search) {\n      return this.items[search] != null;\n    };\n\n    Store.get = function(search) {\n      return this.items[search];\n    };\n\n    Store.put = function(name, obj) {\n      return this.items[name] = obj;\n    };\n\n    Store.execute = function(search, callback) {\n      var _this = this;\n\n      setTimeout(function() {\n        return callback.call(_this.get(search), _this.get(search));\n      }, 0);\n      return this.get(search);\n    };\n\n    Store.flush = function(name) {\n      if (name == null) {\n        name = false;\n      }\n      if (name) {\n        return delete this.items[name];\n      } else {\n        return this.items = {};\n      }\n    };\n\n    return Store;\n\n  })();\n\n  Store = Caman.Store;\n\n  Blender.register(\"normal\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaLayer.r,\n      g: rgbaLayer.g,\n      b: rgbaLayer.b\n    };\n  });\n\n  Blender.register(\"multiply\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: (rgbaLayer.r * rgbaParent.r) / 255,\n      g: (rgbaLayer.g * rgbaParent.g) / 255,\n      b: (rgbaLayer.b * rgbaParent.b) / 255\n    };\n  });\n\n  Blender.register(\"screen\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: 255 - (((255 - rgbaLayer.r) * (255 - rgbaParent.r)) / 255),\n      g: 255 - (((255 - rgbaLayer.g) * (255 - rgbaParent.g)) / 255),\n      b: 255 - (((255 - rgbaLayer.b) * (255 - rgbaParent.b)) / 255)\n    };\n  });\n\n  Blender.register(\"overlay\", function(rgbaLayer, rgbaParent) {\n    var result;\n\n    result = {};\n    result.r = rgbaParent.r > 128 ? 255 - 2 * (255 - rgbaLayer.r) * (255 - rgbaParent.r) / 255 : (rgbaParent.r * rgbaLayer.r * 2) / 255;\n    result.g = rgbaParent.g > 128 ? 255 - 2 * (255 - rgbaLayer.g) * (255 - rgbaParent.g) / 255 : (rgbaParent.g * rgbaLayer.g * 2) / 255;\n    result.b = rgbaParent.b > 128 ? 255 - 2 * (255 - rgbaLayer.b) * (255 - rgbaParent.b) / 255 : (rgbaParent.b * rgbaLayer.b * 2) / 255;\n    return result;\n  });\n\n  Blender.register(\"difference\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaLayer.r - rgbaParent.r,\n      g: rgbaLayer.g - rgbaParent.g,\n      b: rgbaLayer.b - rgbaParent.b\n    };\n  });\n\n  Blender.register(\"addition\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r + rgbaLayer.r,\n      g: rgbaParent.g + rgbaLayer.g,\n      b: rgbaParent.b + rgbaLayer.b\n    };\n  });\n\n  Blender.register(\"exclusion\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: 128 - 2 * (rgbaParent.r - 128) * (rgbaLayer.r - 128) / 255,\n      g: 128 - 2 * (rgbaParent.g - 128) * (rgbaLayer.g - 128) / 255,\n      b: 128 - 2 * (rgbaParent.b - 128) * (rgbaLayer.b - 128) / 255\n    };\n  });\n\n  Blender.register(\"softLight\", function(rgbaLayer, rgbaParent) {\n    var result;\n\n    result = {};\n    result.r = rgbaParent.r > 128 ? 255 - ((255 - rgbaParent.r) * (255 - (rgbaLayer.r - 128))) / 255 : (rgbaParent.r * (rgbaLayer.r + 128)) / 255;\n    result.g = rgbaParent.g > 128 ? 255 - ((255 - rgbaParent.g) * (255 - (rgbaLayer.g - 128))) / 255 : (rgbaParent.g * (rgbaLayer.g + 128)) / 255;\n    result.b = rgbaParent.b > 128 ? 255 - ((255 - rgbaParent.b) * (255 - (rgbaLayer.b - 128))) / 255 : (rgbaParent.b * (rgbaLayer.b + 128)) / 255;\n    return result;\n  });\n\n  Blender.register(\"lighten\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r > rgbaLayer.r ? rgbaParent.r : rgbaLayer.r,\n      g: rgbaParent.g > rgbaLayer.g ? rgbaParent.g : rgbaLayer.g,\n      b: rgbaParent.b > rgbaLayer.b ? rgbaParent.b : rgbaLayer.b\n    };\n  });\n\n  Blender.register(\"darken\", function(rgbaLayer, rgbaParent) {\n    return {\n      r: rgbaParent.r > rgbaLayer.r ? rgbaLayer.r : rgbaParent.r,\n      g: rgbaParent.g > rgbaLayer.g ? rgbaLayer.g : rgbaParent.g,\n      b: rgbaParent.b > rgbaLayer.b ? rgbaLayer.b : rgbaParent.b\n    };\n  });\n\n  Filter.register(\"fillColor\", function() {\n    var color;\n\n    if (arguments.length === 1) {\n      color = Convert.hexToRGB(arguments[0]);\n    } else {\n      color = {\n        r: arguments[0],\n        g: arguments[1],\n        b: arguments[2]\n      };\n    }\n    return this.process(\"fillColor\", function(rgba) {\n      rgba.r = color.r;\n      rgba.g = color.g;\n      rgba.b = color.b;\n      rgba.a = 255;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"brightness\", function(adjust) {\n    adjust = Math.floor(255 * (adjust / 100));\n    return this.process(\"brightness\", function(rgba) {\n      rgba.r += adjust;\n      rgba.g += adjust;\n      rgba.b += adjust;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"saturation\", function(adjust) {\n    adjust *= -0.01;\n    return this.process(\"saturation\", function(rgba) {\n      var max;\n\n      max = Math.max(rgba.r, rgba.g, rgba.b);\n      if (rgba.r !== max) {\n        rgba.r += (max - rgba.r) * adjust;\n      }\n      if (rgba.g !== max) {\n        rgba.g += (max - rgba.g) * adjust;\n      }\n      if (rgba.b !== max) {\n        rgba.b += (max - rgba.b) * adjust;\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"vibrance\", function(adjust) {\n    adjust *= -1;\n    return this.process(\"vibrance\", function(rgba) {\n      var amt, avg, max;\n\n      max = Math.max(rgba.r, rgba.g, rgba.b);\n      avg = (rgba.r + rgba.g + rgba.b) / 3;\n      amt = ((Math.abs(max - avg) * 2 / 255) * adjust) / 100;\n      if (rgba.r !== max) {\n        rgba.r += (max - rgba.r) * amt;\n      }\n      if (rgba.g !== max) {\n        rgba.g += (max - rgba.g) * amt;\n      }\n      if (rgba.b !== max) {\n        rgba.b += (max - rgba.b) * amt;\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"greyscale\", function(adjust) {\n    return this.process(\"greyscale\", function(rgba) {\n      var avg;\n\n      avg = Calculate.luminance(rgba);\n      rgba.r = avg;\n      rgba.g = avg;\n      rgba.b = avg;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"contrast\", function(adjust) {\n    adjust = Math.pow((adjust + 100) / 100, 2);\n    return this.process(\"contrast\", function(rgba) {\n      rgba.r /= 255;\n      rgba.r -= 0.5;\n      rgba.r *= adjust;\n      rgba.r += 0.5;\n      rgba.r *= 255;\n      rgba.g /= 255;\n      rgba.g -= 0.5;\n      rgba.g *= adjust;\n      rgba.g += 0.5;\n      rgba.g *= 255;\n      rgba.b /= 255;\n      rgba.b -= 0.5;\n      rgba.b *= adjust;\n      rgba.b += 0.5;\n      rgba.b *= 255;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"hue\", function(adjust) {\n    return this.process(\"hue\", function(rgba) {\n      var b, g, h, hsv, r, _ref;\n\n      hsv = Convert.rgbToHSV(rgba.r, rgba.g, rgba.b);\n      h = hsv.h * 100;\n      h += Math.abs(adjust);\n      h = h % 100;\n      h /= 100;\n      hsv.h = h;\n      _ref = Convert.hsvToRGB(hsv.h, hsv.s, hsv.v), r = _ref.r, g = _ref.g, b = _ref.b;\n      rgba.r = r;\n      rgba.g = g;\n      rgba.b = b;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"colorize\", function() {\n    var level, rgb;\n\n    if (arguments.length === 2) {\n      rgb = Convert.hexToRGB(arguments[0]);\n      level = arguments[1];\n    } else if (arguments.length === 4) {\n      rgb = {\n        r: arguments[0],\n        g: arguments[1],\n        b: arguments[2]\n      };\n      level = arguments[3];\n    }\n    return this.process(\"colorize\", function(rgba) {\n      rgba.r -= (rgba.r - rgb.r) * (level / 100);\n      rgba.g -= (rgba.g - rgb.g) * (level / 100);\n      rgba.b -= (rgba.b - rgb.b) * (level / 100);\n      return rgba;\n    });\n  });\n\n  Filter.register(\"invert\", function() {\n    return this.process(\"invert\", function(rgba) {\n      rgba.r = 255 - rgba.r;\n      rgba.g = 255 - rgba.g;\n      rgba.b = 255 - rgba.b;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"sepia\", function(adjust) {\n    if (adjust == null) {\n      adjust = 100;\n    }\n    adjust /= 100;\n    return this.process(\"sepia\", function(rgba) {\n      rgba.r = Math.min(255, (rgba.r * (1 - (0.607 * adjust))) + (rgba.g * (0.769 * adjust)) + (rgba.b * (0.189 * adjust)));\n      rgba.g = Math.min(255, (rgba.r * (0.349 * adjust)) + (rgba.g * (1 - (0.314 * adjust))) + (rgba.b * (0.168 * adjust)));\n      rgba.b = Math.min(255, (rgba.r * (0.272 * adjust)) + (rgba.g * (0.534 * adjust)) + (rgba.b * (1 - (0.869 * adjust))));\n      return rgba;\n    });\n  });\n\n  Filter.register(\"gamma\", function(adjust) {\n    return this.process(\"gamma\", function(rgba) {\n      rgba.r = Math.pow(rgba.r / 255, adjust) * 255;\n      rgba.g = Math.pow(rgba.g / 255, adjust) * 255;\n      rgba.b = Math.pow(rgba.b / 255, adjust) * 255;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"noise\", function(adjust) {\n    adjust = Math.abs(adjust) * 2.55;\n    return this.process(\"noise\", function(rgba) {\n      var rand;\n\n      rand = Calculate.randomRange(adjust * -1, adjust);\n      rgba.r += rand;\n      rgba.g += rand;\n      rgba.b += rand;\n      return rgba;\n    });\n  });\n\n  Filter.register(\"clip\", function(adjust) {\n    adjust = Math.abs(adjust) * 2.55;\n    return this.process(\"clip\", function(rgba) {\n      if (rgba.r > 255 - adjust) {\n        rgba.r = 255;\n      } else if (rgba.r < adjust) {\n        rgba.r = 0;\n      }\n      if (rgba.g > 255 - adjust) {\n        rgba.g = 255;\n      } else if (rgba.g < adjust) {\n        rgba.g = 0;\n      }\n      if (rgba.b > 255 - adjust) {\n        rgba.b = 255;\n      } else if (rgba.b < adjust) {\n        rgba.b = 0;\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"channels\", function(options) {\n    var chan, value;\n\n    if (typeof options !== \"object\") {\n      return this;\n    }\n    for (chan in options) {\n      if (!__hasProp.call(options, chan)) continue;\n      value = options[chan];\n      if (value === 0) {\n        delete options[chan];\n        continue;\n      }\n      options[chan] /= 100;\n    }\n    if (options.length === 0) {\n      return this;\n    }\n    return this.process(\"channels\", function(rgba) {\n      if (options.red != null) {\n        if (options.red > 0) {\n          rgba.r += (255 - rgba.r) * options.red;\n        } else {\n          rgba.r -= rgba.r * Math.abs(options.red);\n        }\n      }\n      if (options.green != null) {\n        if (options.green > 0) {\n          rgba.g += (255 - rgba.g) * options.green;\n        } else {\n          rgba.g -= rgba.g * Math.abs(options.green);\n        }\n      }\n      if (options.blue != null) {\n        if (options.blue > 0) {\n          rgba.b += (255 - rgba.b) * options.blue;\n        } else {\n          rgba.b -= rgba.b * Math.abs(options.blue);\n        }\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"curves\", function() {\n    var bezier, chans, cps, ctrl1, ctrl2, end, i, start, _i, _j, _ref, _ref1;\n\n    chans = arguments[0], cps = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n    if (typeof chans === \"string\") {\n      chans = chans.split(\"\");\n    }\n    if (chans[0] === \"v\") {\n      chans = ['r', 'g', 'b'];\n    }\n    if (cps.length < 3 || cps.length > 4) {\n      throw \"Invalid number of arguments to curves filter\";\n    }\n    start = cps[0];\n    ctrl1 = cps[1];\n    ctrl2 = cps.length === 4 ? cps[2] : cps[1];\n    end = cps[cps.length - 1];\n    bezier = Calculate.bezier(start, ctrl1, ctrl2, end, 0, 255);\n    if (start[0] > 0) {\n      for (i = _i = 0, _ref = start[0]; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\n        bezier[i] = start[1];\n      }\n    }\n    if (end[0] < 255) {\n      for (i = _j = _ref1 = end[0]; _ref1 <= 255 ? _j <= 255 : _j >= 255; i = _ref1 <= 255 ? ++_j : --_j) {\n        bezier[i] = end[1];\n      }\n    }\n    return this.process(\"curves\", function(rgba) {\n      var _k, _ref2;\n\n      for (i = _k = 0, _ref2 = chans.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {\n        rgba[chans[i]] = bezier[rgba[chans[i]]];\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"exposure\", function(adjust) {\n    var ctrl1, ctrl2, p;\n\n    p = Math.abs(adjust) / 100;\n    ctrl1 = [0, 255 * p];\n    ctrl2 = [255 - (255 * p), 255];\n    if (adjust < 0) {\n      ctrl1 = ctrl1.reverse();\n      ctrl2 = ctrl2.reverse();\n    }\n    return this.curves('rgb', [0, 0], ctrl1, ctrl2, [255, 255]);\n  });\n\n  Caman.Plugin.register(\"crop\", function(width, height, x, y) {\n    var canvas, ctx;\n\n    if (x == null) {\n      x = 0;\n    }\n    if (y == null) {\n      y = 0;\n    }\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas(width, height);\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = width;\n      canvas.height = height;\n    }\n    ctx = canvas.getContext('2d');\n    ctx.drawImage(this.canvas, x, y, width, height, 0, 0, width, height);\n    this.cropCoordinates = {\n      x: x,\n      y: y\n    };\n    this.cropped = true;\n    return this.replaceCanvas(canvas);\n  });\n\n  Caman.Plugin.register(\"resize\", function(newDims) {\n    var canvas, ctx;\n\n    if (newDims == null) {\n      newDims = null;\n    }\n    if (newDims === null || ((newDims.width == null) && (newDims.height == null))) {\n      Log.error(\"Invalid or missing dimensions given for resize\");\n      return;\n    }\n    if (newDims.width == null) {\n      newDims.width = this.canvas.width * newDims.height / this.canvas.height;\n    } else if (newDims.height == null) {\n      newDims.height = this.canvas.height * newDims.width / this.canvas.width;\n    }\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas(newDims.width, newDims.height);\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n      canvas.width = newDims.width;\n      canvas.height = newDims.height;\n    }\n    ctx = canvas.getContext('2d');\n    ctx.drawImage(this.canvas, 0, 0, this.canvas.width, this.canvas.height, 0, 0, newDims.width, newDims.height);\n    this.resized = true;\n    return this.replaceCanvas(canvas);\n  });\n\n  Caman.Filter.register(\"crop\", function() {\n    return this.processPlugin(\"crop\", Array.prototype.slice.call(arguments, 0));\n  });\n\n  Caman.Filter.register(\"resize\", function() {\n    return this.processPlugin(\"resize\", Array.prototype.slice.call(arguments, 0));\n  });\n\n  Caman.Filter.register(\"boxBlur\", function() {\n    return this.processKernel(\"Box Blur\", [1, 1, 1, 1, 1, 1, 1, 1, 1]);\n  });\n\n  Caman.Filter.register(\"heavyRadialBlur\", function() {\n    return this.processKernel(\"Heavy Radial Blur\", [0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0]);\n  });\n\n  Caman.Filter.register(\"gaussianBlur\", function() {\n    return this.processKernel(\"Gaussian Blur\", [1, 4, 6, 4, 1, 4, 16, 24, 16, 4, 6, 24, 36, 24, 6, 4, 16, 24, 16, 4, 1, 4, 6, 4, 1]);\n  });\n\n  Caman.Filter.register(\"motionBlur\", function(degrees) {\n    var kernel;\n\n    if (degrees === 0 || degrees === 180) {\n      kernel = [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0];\n    } else if ((degrees > 0 && degrees < 90) || (degrees > 180 && degrees < 270)) {\n      kernel = [0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0];\n    } else if (degrees === 90 || degrees === 270) {\n      kernel = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    } else {\n      kernel = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];\n    }\n    return this.processKernel(\"Motion Blur\", kernel);\n  });\n\n  Caman.Filter.register(\"sharpen\", function(amt) {\n    if (amt == null) {\n      amt = 100;\n    }\n    amt /= 100;\n    return this.processKernel(\"Sharpen\", [0, -amt, 0, -amt, 4 * amt + 1, -amt, 0, -amt, 0]);\n  });\n\n  vignetteFilters = {\n    brightness: function(rgba, amt, opts) {\n      rgba.r = rgba.r - (rgba.r * amt * opts.strength);\n      rgba.g = rgba.g - (rgba.g * amt * opts.strength);\n      rgba.b = rgba.b - (rgba.b * amt * opts.strength);\n      return rgba;\n    },\n    gamma: function(rgba, amt, opts) {\n      rgba.r = Math.pow(rgba.r / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      rgba.g = Math.pow(rgba.g / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      rgba.b = Math.pow(rgba.b / 255, Math.max(10 * amt * opts.strength, 1)) * 255;\n      return rgba;\n    },\n    colorize: function(rgba, amt, opts) {\n      rgba.r -= (rgba.r - opts.color.r) * amt;\n      rgba.g -= (rgba.g - opts.color.g) * amt;\n      rgba.b -= (rgba.b - opts.color.b) * amt;\n      return rgba;\n    }\n  };\n\n  Filter.register(\"vignette\", function(size, strength) {\n    var bezier, center, end, start;\n\n    if (strength == null) {\n      strength = 60;\n    }\n    if (typeof size === \"string\" && size.substr(-1) === \"%\") {\n      if (this.dimensions.height > this.dimensions.width) {\n        size = this.dimensions.width * (parseInt(size.substr(0, size.length - 1), 10) / 100);\n      } else {\n        size = this.dimensions.height * (parseInt(size.substr(0, size.length - 1), 10) / 100);\n      }\n    }\n    strength /= 100;\n    center = [this.dimensions.width / 2, this.dimensions.height / 2];\n    start = Math.sqrt(Math.pow(center[0], 2) + Math.pow(center[1], 2));\n    end = start - size;\n    bezier = Calculate.bezier([0, 1], [30, 30], [70, 60], [100, 80]);\n    return this.process(\"vignette\", function(rgba) {\n      var dist, div, loc;\n\n      loc = rgba.locationXY();\n      dist = Calculate.distance(loc.x, loc.y, center[0], center[1]);\n      if (dist > end) {\n        div = Math.max(1, (bezier[Math.round(((dist - end) / size) * 100)] / 10) * strength);\n        rgba.r = Math.pow(rgba.r / 255, div) * 255;\n        rgba.g = Math.pow(rgba.g / 255, div) * 255;\n        rgba.b = Math.pow(rgba.b / 255, div) * 255;\n      }\n      return rgba;\n    });\n  });\n\n  Filter.register(\"rectangularVignette\", function(opts) {\n    var defaults, dim, percent, size, _i, _len, _ref;\n\n    defaults = {\n      strength: 50,\n      cornerRadius: 0,\n      method: 'brightness',\n      color: {\n        r: 0,\n        g: 0,\n        b: 0\n      }\n    };\n    opts = Util.extend(defaults, opts);\n    if (!opts.size) {\n      return this;\n    } else if (typeof opts.size === \"string\") {\n      percent = parseInt(opts.size, 10) / 100;\n      opts.size = {\n        width: this.dimensions.width * percent,\n        height: this.dimensions.height * percent\n      };\n    } else if (typeof opts.size === \"object\") {\n      _ref = [\"width\", \"height\"];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        dim = _ref[_i];\n        if (typeof opts.size[dim] === \"string\") {\n          opts.size[dim] = this.dimensions[dim] * (parseInt(opts.size[dim], 10) / 100);\n        }\n      }\n    } else if (opts.size === \"number\") {\n      size = opts.size;\n      opts.size = {\n        width: size,\n        height: size\n      };\n    }\n    if (typeof opts.cornerRadius === \"string\") {\n      opts.cornerRadius = (opts.size.width / 2) * (parseInt(opts.cornerRadius, 10) / 100);\n    }\n    opts.strength /= 100;\n    opts.size.width = Math.floor(opts.size.width);\n    opts.size.height = Math.floor(opts.size.height);\n    opts.image = {\n      width: this.dimensions.width,\n      height: this.dimensions.height\n    };\n    if (opts.method === \"colorize\" && typeof opts.color === \"string\") {\n      opts.color = Convert.hexToRGB(opts.color);\n    }\n    opts.coords = {\n      left: (this.dimensions.width - opts.size.width) / 2,\n      right: this.dimensions.width - opts.coords.left,\n      bottom: (this.dimensions.height - opts.size.height) / 2,\n      top: this.dimensions.height - opts.coords.bottom\n    };\n    opts.corners = [\n      {\n        x: opts.coords.left + opts.cornerRadius,\n        y: opts.coords.top - opts.cornerRadius\n      }, {\n        x: opts.coords.right - opts.cornerRadius,\n        y: opts.coords.top - opts.cornerRadius\n      }, {\n        x: opts.coords.right - opts.cornerRadius,\n        y: opts.coords.bottom + opts.cornerRadius\n      }, {\n        x: opts.coords.left + opts.cornerRadius,\n        y: opts.coords.bottom + opts.cornerRadius\n      }\n    ];\n    opts.maxDist = Calculate.distance(0, 0, opts.corners[3].x, opts.corners[3].y) - opts.cornerRadius;\n    return this.process(\"rectangularVignette\", function(rgba) {\n      var amt, loc, radialDist;\n\n      loc = rgba.locationXY();\n      if ((loc.x > opts.corners[0].x && loc.x < opts.corners[1].x) && (loc.y > opts.coords.bottom && loc.y < opts.coords.top)) {\n        return rgba;\n      }\n      if ((loc.x > opts.coords.left && loc.x < opts.coords.right) && (loc.y > opts.corners[3].y && loc.y < opts.corners[2].y)) {\n        return rgba;\n      }\n      if (loc.x > opts.corners[0].x && loc.x < opts.corners[1].x && loc.y > opts.coords.top) {\n        amt = (loc.y - opts.coords.top) / opts.maxDist;\n      } else if (loc.y > opts.corners[2].y && loc.y < opts.corners[1].y && loc.x > opts.coords.right) {\n        amt = (loc.x - opts.coords.right) / opts.maxDist;\n      } else if (loc.x > opts.corners[0].x && loc.x < opts.corners[1].x && loc.y < opts.coords.bottom) {\n        amt = (opts.coords.bottom - loc.y) / opts.maxDist;\n      } else if (loc.y > opts.corners[2].y && loc.y < opts.corners[1].y && loc.x < opts.coords.left) {\n        amt = (opts.coords.left - loc.x) / opts.maxDist;\n      } else if (loc.x <= opts.corners[0].x && loc.y >= opts.corners[0].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[0].x, opts.corners[0].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x >= opts.corners[1].x && loc.y >= opts.corners[1].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[1].x, opts.corners[1].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x >= opts.corners[2].x && loc.y <= opts.corners[2].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[2].x, opts.corners[2].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      } else if (loc.x <= opts.corners[3].x && loc.y <= opts.corners[3].y) {\n        radialDist = Caman.distance(loc.x, loc.y, opts.corners[3].x, opts.corners[3].y);\n        amt = (radialDist - opts.cornerRadius) / opts.maxDist;\n      }\n      if (amt < 0) {\n        return rgba;\n      }\n      return vignetteFilters[opts.method](rgba, amt, opts);\n    });\n  });\n\n  /*\n  CompoundBlur - Blurring with varying radii for Canvas\n  \n  Version:   0.1\n  Author:  Mario Klingemann\n  Contact:   mario@quasimondo.com\n  Website:  http://www.quasimondo.com/StackBlurForCanvas\n  Twitter:  @quasimondo\n  Modified By: Ryan LeFevre (@meltingice)\n  \n  In case you find this class useful - especially in commercial projects -\n  I am not totally unhappy for a small donation to my PayPal account\n  mario@quasimondo.de\n  \n  Copyright (c) 2011 Mario Klingemann\n  \n  Permission is hereby granted, free of charge, to any person\n  obtaining a copy of this software and associated documentation\n  files (the \"Software\"), to deal in the Software without\n  restriction, including without limitation the rights to use,\n  copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following\n  conditions:\n  \n  The above copyright notice and this permission notice shall be\n  included in all copies or substantial portions of the Software.\n  \n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n  WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n  */\n\n\n  (function() {\n    var BlurStack, getLinearGradientMap, getRadialGradientMap, mul_table, shg_table;\n\n    mul_table = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\n    shg_table = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n    getLinearGradientMap = function(width, height, centerX, centerY, angle, length, mirrored) {\n      var cnv, context, gradient, x1, x2, y1, y2;\n\n      cnv = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      cnv.width = width;\n      cnv.height = height;\n      x1 = centerX + Math.cos(angle) * length * 0.5;\n      y1 = centerY + Math.sin(angle) * length * 0.5;\n      x2 = centerX - Math.cos(angle) * length * 0.5;\n      y2 = centerY - Math.sin(angle) * length * 0.5;\n      context = cnv.getContext(\"2d\");\n      gradient = context.createLinearGradient(x1, y1, x2, y2);\n      if (!mirrored) {\n        gradient.addColorStop(0, \"white\");\n        gradient.addColorStop(1, \"black\");\n      } else {\n        gradient.addColorStop(0, \"white\");\n        gradient.addColorStop(0.5, \"black\");\n        gradient.addColorStop(1, \"white\");\n      }\n      context.fillStyle = gradient;\n      context.fillRect(0, 0, width, height);\n      return context.getImageData(0, 0, width, height);\n    };\n    getRadialGradientMap = function(width, height, centerX, centerY, radius1, radius2) {\n      var cnv, context, gradient;\n\n      cnv = typeof exports !== \"undefined\" && exports !== null ? new Canvas() : document.createElement('canvas');\n      cnv.width = width;\n      cnv.height = height;\n      context = cnv.getContext(\"2d\");\n      gradient = context.createRadialGradient(centerX, centerY, radius1, centerX, centerY, radius2);\n      gradient.addColorStop(1, \"white\");\n      gradient.addColorStop(0, \"black\");\n      context.fillStyle = gradient;\n      context.fillRect(0, 0, width, height);\n      return context.getImageData(0, 0, width, height);\n    };\n    BlurStack = function() {\n      this.r = 0;\n      this.g = 0;\n      this.b = 0;\n      this.a = 0;\n      return this.next = null;\n    };\n    Caman.Plugin.register(\"compoundBlur\", function(radiusData, radius, increaseFactor, blurLevels) {\n      var b_in_sum, b_out_sum, b_sum, blend, currentIndex, div, g_in_sum, g_out_sum, g_sum, height, heightMinus1, i, iblend, idx, imagePixels, index, iradius, lookupValue, mul_sum, p, pb, pg, pixels, pr, r_in_sum, r_out_sum, r_sum, radiusPixels, radiusPlus1, rbs, shg_sum, stack, stackEnd, stackIn, stackOut, stackStart, steps, sumFactor, w4, wh, wh4, width, widthMinus1, x, y, yi, yp, yw, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;\n\n      width = this.dimensions.width;\n      height = this.dimensions.height;\n      imagePixels = this.pixelData;\n      radiusPixels = radiusData.data;\n      wh = width * height;\n      wh4 = wh << 2;\n      pixels = [];\n      for (i = _i = 0; 0 <= wh4 ? _i < wh4 : _i > wh4; i = 0 <= wh4 ? ++_i : --_i) {\n        pixels[i] = imagePixels[i];\n      }\n      currentIndex = 0;\n      steps = blurLevels;\n      blurLevels -= 1;\n      while (steps-- >= 0) {\n        iradius = (radius + 0.5) | 0;\n        if (iradius === 0) {\n          continue;\n        }\n        if (iradius > 256) {\n          iradius = 256;\n        }\n        div = iradius + iradius + 1;\n        w4 = width << 2;\n        widthMinus1 = width - 1;\n        heightMinus1 = height - 1;\n        radiusPlus1 = iradius + 1;\n        sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n        stackStart = new BlurStack();\n        stackEnd = void 0;\n        stack = stackStart;\n        for (i = _j = 1; 1 <= div ? _j < div : _j > div; i = 1 <= div ? ++_j : --_j) {\n          stack = stack.next = new BlurStack();\n          if (i === radiusPlus1) {\n            stackEnd = stack;\n          }\n        }\n        stack.next = stackStart;\n        stackIn = null;\n        stackOut = null;\n        yw = yi = 0;\n        mul_sum = mul_table[iradius];\n        shg_sum = shg_table[iradius];\n        for (y = _k = 0; 0 <= height ? _k < height : _k > height; y = 0 <= height ? ++_k : --_k) {\n          r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n          r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n          g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n          b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n          r_sum += sumFactor * pr;\n          g_sum += sumFactor * pg;\n          b_sum += sumFactor * pb;\n          stack = stackStart;\n          for (i = _l = 0; 0 <= radiusPlus1 ? _l < radiusPlus1 : _l > radiusPlus1; i = 0 <= radiusPlus1 ? ++_l : --_l) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n          }\n          for (i = _m = 1; 1 <= radiusPlus1 ? _m < radiusPlus1 : _m > radiusPlus1; i = 1 <= radiusPlus1 ? ++_m : --_m) {\n            p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n            r_sum += (stack.r = (pr = pixels[p])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[p + 1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[p + 2])) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            stack = stack.next;\n          }\n          stackIn = stackStart;\n          stackOut = stackEnd;\n          for (x = _n = 0; 0 <= width ? _n < width : _n > width; x = 0 <= width ? ++_n : --_n) {\n            pixels[yi] = (r_sum * mul_sum) >> shg_sum;\n            pixels[yi + 1] = (g_sum * mul_sum) >> shg_sum;\n            pixels[yi + 2] = (b_sum * mul_sum) >> shg_sum;\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            p = (yw + ((p = x + radiusPlus1) < widthMinus1 ? p : widthMinus1)) << 2;\n            r_in_sum += (stackIn.r = pixels[p]);\n            g_in_sum += (stackIn.g = pixels[p + 1]);\n            b_in_sum += (stackIn.b = pixels[p + 2]);\n            r_sum += r_in_sum;\n            g_sum += g_in_sum;\n            b_sum += b_in_sum;\n            stackIn = stackIn.next;\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            stackOut = stackOut.next;\n            yi += 4;\n          }\n          yw += width;\n        }\n        for (x = _o = 0; 0 <= width ? _o < width : _o > width; x = 0 <= width ? ++_o : --_o) {\n          g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n          yi = x << 2;\n          r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n          g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n          b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n          r_sum += sumFactor * pr;\n          g_sum += sumFactor * pg;\n          b_sum += sumFactor * pb;\n          stack = stackStart;\n          for (i = _p = 0; 0 <= radiusPlus1 ? _p < radiusPlus1 : _p > radiusPlus1; i = 0 <= radiusPlus1 ? ++_p : --_p) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n          }\n          yp = width;\n          for (i = _q = 1; 1 <= radiusPlus1 ? _q < radiusPlus1 : _q > radiusPlus1; i = 1 <= radiusPlus1 ? ++_q : --_q) {\n            yi = (yp + x) << 2;\n            r_sum += (stack.r = (pr = pixels[yi])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[yi + 1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[yi + 2])) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            stack = stack.next;\n            if (i < heightMinus1) {\n              yp += width;\n            }\n          }\n          yi = x;\n          stackIn = stackStart;\n          stackOut = stackEnd;\n          for (y = _r = 0; 0 <= height ? _r < height : _r > height; y = 0 <= height ? ++_r : --_r) {\n            p = yi << 2;\n            pixels[p] = (r_sum * mul_sum) >> shg_sum;\n            pixels[p + 1] = (g_sum * mul_sum) >> shg_sum;\n            pixels[p + 2] = (b_sum * mul_sum) >> shg_sum;\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            p = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width)) << 2;\n            r_sum += (r_in_sum += (stackIn.r = pixels[p]));\n            g_sum += (g_in_sum += (stackIn.g = pixels[p + 1]));\n            b_sum += (b_in_sum += (stackIn.b = pixels[p + 2]));\n            stackIn = stackIn.next;\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            stackOut = stackOut.next;\n            yi += width;\n          }\n        }\n        radius *= increaseFactor;\n        i = wh;\n        while (--i > -1) {\n          idx = i << 2;\n          lookupValue = (radiusPixels[idx + 2] & 0xff) / 255.0 * blurLevels;\n          index = lookupValue | 0;\n          if (index === currentIndex) {\n            blend = 256.0 * (lookupValue - (lookupValue | 0));\n            iblend = 256 - blend;\n            imagePixels[idx] = (imagePixels[idx] * iblend + pixels[idx] * blend) >> 8;\n            imagePixels[idx + 1] = (imagePixels[idx + 1] * iblend + pixels[idx + 1] * blend) >> 8;\n            imagePixels[idx + 2] = (imagePixels[idx + 2] * iblend + pixels[idx + 2] * blend) >> 8;\n          } else if (index === currentIndex + 1) {\n            imagePixels[idx] = pixels[idx];\n            imagePixels[idx + 1] = pixels[idx + 1];\n            imagePixels[idx + 2] = pixels[idx + 2];\n          }\n        }\n        currentIndex++;\n      }\n      return this;\n    });\n    Caman.Filter.register(\"tiltShift\", function(opts) {\n      var defaults, gradient;\n\n      defaults = {\n        center: {\n          x: this.dimensions.width / 2,\n          y: this.dimensions.height / 2\n        },\n        angle: 45,\n        focusWidth: 200,\n        startRadius: 3,\n        radiusFactor: 1.5,\n        steps: 3\n      };\n      opts = Util.extend(defaults, opts);\n      opts.angle *= Math.PI / 180;\n      gradient = getLinearGradientMap(this.dimensions.width, this.dimensions.height, opts.center.x, opts.center.y, opts.angle, opts.focusWidth, true);\n      return this.processPlugin(\"compoundBlur\", [gradient, opts.startRadius, opts.radiusFactor, opts.steps]);\n    });\n    return Caman.Filter.register(\"radialBlur\", function(opts) {\n      var defaults, gradient, radius1, radius2;\n\n      defaults = {\n        size: 50,\n        center: {\n          x: this.dimensions.width / 2,\n          y: this.dimensions.height / 2\n        },\n        startRadius: 3,\n        radiusFactor: 1.5,\n        steps: 3,\n        radius: null\n      };\n      opts = Util.extend(defaults, opts);\n      if (!opts.radius) {\n        opts.radius = this.dimensions.width < this.dimensions.height ? this.dimensions.height : this.dimensions.width;\n      }\n      radius1 = (opts.radius / 2) - opts.size;\n      radius2 = opts.radius / 2;\n      gradient = getRadialGradientMap(this.dimensions.width, this.dimensions.height, opts.center.x, opts.center.y, radius1, radius2);\n      return this.processPlugin(\"compoundBlur\", [gradient, opts.startRadius, opts.radiusFactor, opts.steps]);\n    });\n  })();\n\n  Caman.Filter.register(\"edgeEnhance\", function() {\n    return this.processKernel(\"Edge Enhance\", [0, 0, 0, -1, 1, 0, 0, 0, 0]);\n  });\n\n  Caman.Filter.register(\"edgeDetect\", function() {\n    return this.processKernel(\"Edge Detect\", [-1, -1, -1, -1, 8, -1, -1, -1, -1]);\n  });\n\n  Caman.Filter.register(\"emboss\", function() {\n    return this.processKernel(\"Emboss\", [-2, -1, 0, -1, 1, 1, 0, 1, 2]);\n  });\n\n  Caman.Filter.register(\"posterize\", function(adjust) {\n    var numOfAreas, numOfValues;\n\n    numOfAreas = 256 / adjust;\n    numOfValues = 255 / (adjust - 1);\n    return this.process(\"posterize\", function(rgba) {\n      rgba.r = Math.floor(Math.floor(rgba.r / numOfAreas) * numOfValues);\n      rgba.g = Math.floor(Math.floor(rgba.g / numOfAreas) * numOfValues);\n      rgba.b = Math.floor(Math.floor(rgba.b / numOfAreas) * numOfValues);\n      return rgba;\n    });\n  });\n\n  Caman.Filter.register(\"vintage\", function(vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n    this.greyscale();\n    this.contrast(5);\n    this.noise(3);\n    this.sepia(100);\n    this.channels({\n      red: 8,\n      blue: 2,\n      green: 4\n    });\n    this.gamma(0.87);\n    if (vignette) {\n      return this.vignette(\"40%\", 30);\n    }\n  });\n\n  Caman.Filter.register(\"lomo\", function(vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n    this.brightness(15);\n    this.exposure(15);\n    this.curves('rgb', [0, 0], [200, 0], [155, 255], [255, 255]);\n    this.saturation(-20);\n    this.gamma(1.8);\n    if (vignette) {\n      this.vignette(\"50%\", 60);\n    }\n    return this.brightness(5);\n  });\n\n  Caman.Filter.register(\"clarity\", function(grey) {\n    if (grey == null) {\n      grey = false;\n    }\n    this.vibrance(20);\n    this.curves('rgb', [5, 0], [130, 150], [190, 220], [250, 255]);\n    this.sharpen(15);\n    this.vignette(\"45%\", 20);\n    if (grey) {\n      this.greyscale();\n      this.contrast(4);\n    }\n    return this;\n  });\n\n  Caman.Filter.register(\"sinCity\", function() {\n    this.contrast(100);\n    this.brightness(15);\n    this.exposure(10);\n    this.posterize(80);\n    this.clip(30);\n    return this.greyscale();\n  });\n\n  Caman.Filter.register(\"sunrise\", function() {\n    this.exposure(3.5);\n    this.saturation(-5);\n    this.vibrance(50);\n    this.sepia(60);\n    this.colorize(\"#e87b22\", 10);\n    this.channels({\n      red: 8,\n      blue: 8\n    });\n    this.contrast(5);\n    this.gamma(1.2);\n    return this.vignette(\"55%\", 25);\n  });\n\n  Caman.Filter.register(\"crossProcess\", function() {\n    this.exposure(5);\n    this.colorize(\"#e87b22\", 4);\n    this.sepia(20);\n    this.channels({\n      blue: 8,\n      red: 3\n    });\n    this.curves('b', [0, 0], [100, 150], [180, 180], [255, 255]);\n    this.contrast(15);\n    this.vibrance(75);\n    return this.gamma(1.6);\n  });\n\n  Caman.Filter.register(\"orangePeel\", function() {\n    this.curves('rgb', [0, 0], [100, 50], [140, 200], [255, 255]);\n    this.vibrance(-30);\n    this.saturation(-30);\n    this.colorize('#ff9000', 30);\n    this.contrast(-5);\n    return this.gamma(1.4);\n  });\n\n  Caman.Filter.register(\"love\", function() {\n    this.brightness(5);\n    this.exposure(8);\n    this.contrast(4);\n    this.colorize('#c42007', 30);\n    this.vibrance(50);\n    return this.gamma(1.3);\n  });\n\n  Caman.Filter.register(\"grungy\", function() {\n    this.gamma(1.5);\n    this.clip(25);\n    this.saturation(-60);\n    this.contrast(5);\n    this.noise(5);\n    return this.vignette(\"50%\", 30);\n  });\n\n  Caman.Filter.register(\"jarques\", function() {\n    this.saturation(-35);\n    this.curves('b', [20, 0], [90, 120], [186, 144], [255, 230]);\n    this.curves('r', [0, 0], [144, 90], [138, 120], [255, 255]);\n    this.curves('g', [10, 0], [115, 105], [148, 100], [255, 248]);\n    this.curves('rgb', [0, 0], [120, 100], [128, 140], [255, 255]);\n    return this.sharpen(20);\n  });\n\n  Caman.Filter.register(\"pinhole\", function() {\n    this.greyscale();\n    this.sepia(10);\n    this.exposure(10);\n    this.contrast(15);\n    return this.vignette(\"60%\", 35);\n  });\n\n  Caman.Filter.register(\"oldBoot\", function() {\n    this.saturation(-20);\n    this.vibrance(-50);\n    this.gamma(1.1);\n    this.sepia(30);\n    this.channels({\n      red: -10,\n      blue: 5\n    });\n    this.curves('rgb', [0, 0], [80, 50], [128, 230], [255, 255]);\n    return this.vignette(\"60%\", 30);\n  });\n\n  Caman.Filter.register(\"glowingSun\", function(vignette) {\n    if (vignette == null) {\n      vignette = true;\n    }\n    this.brightness(10);\n    this.newLayer(function() {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(80);\n      this.copyParent();\n      this.filter.gamma(0.8);\n      this.filter.contrast(50);\n      return this.filter.exposure(10);\n    });\n    this.newLayer(function() {\n      this.setBlendingMode(\"softLight\");\n      this.opacity(80);\n      return this.fillColor(\"#f49600\");\n    });\n    this.exposure(20);\n    this.gamma(0.8);\n    if (vignette) {\n      return this.vignette(\"45%\", 20);\n    }\n  });\n\n  Caman.Filter.register(\"hazyDays\", function() {\n    this.gamma(1.2);\n    this.newLayer(function() {\n      this.setBlendingMode(\"overlay\");\n      this.opacity(60);\n      this.copyParent();\n      this.filter.channels({\n        red: 5\n      });\n      return this.filter.stackBlur(15);\n    });\n    this.newLayer(function() {\n      this.setBlendingMode(\"addition\");\n      this.opacity(40);\n      return this.fillColor(\"#6899ba\");\n    });\n    this.newLayer(function() {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(35);\n      this.copyParent();\n      this.filter.brightness(40);\n      this.filter.vibrance(40);\n      this.filter.exposure(30);\n      this.filter.contrast(15);\n      this.filter.curves('r', [0, 40], [128, 128], [128, 128], [255, 215]);\n      this.filter.curves('g', [0, 40], [128, 128], [128, 128], [255, 215]);\n      this.filter.curves('b', [0, 40], [128, 128], [128, 128], [255, 215]);\n      return this.filter.stackBlur(5);\n    });\n    this.curves('r', [20, 0], [128, 158], [128, 128], [235, 255]);\n    this.curves('g', [20, 0], [128, 128], [128, 128], [235, 255]);\n    this.curves('b', [20, 0], [128, 108], [128, 128], [235, 255]);\n    return this.vignette(\"45%\", 20);\n  });\n\n  Caman.Filter.register(\"herMajesty\", function() {\n    this.brightness(40);\n    this.colorize(\"#ea1c5d\", 10);\n    this.curves('b', [0, 10], [128, 180], [190, 190], [255, 255]);\n    this.newLayer(function() {\n      this.setBlendingMode('overlay');\n      this.opacity(50);\n      this.copyParent();\n      this.filter.gamma(0.7);\n      return this.newLayer(function() {\n        this.setBlendingMode('normal');\n        this.opacity(60);\n        return this.fillColor('#ea1c5d');\n      });\n    });\n    this.newLayer(function() {\n      this.setBlendingMode('multiply');\n      this.opacity(60);\n      this.copyParent();\n      this.filter.saturation(50);\n      this.filter.hue(90);\n      return this.filter.contrast(10);\n    });\n    this.gamma(1.4);\n    this.vibrance(-30);\n    this.newLayer(function() {\n      this.opacity(10);\n      return this.fillColor('#e5f0ff');\n    });\n    return this;\n  });\n\n  Caman.Filter.register(\"nostalgia\", function() {\n    this.saturation(20);\n    this.gamma(1.4);\n    this.greyscale();\n    this.contrast(5);\n    this.sepia(100);\n    this.channels({\n      red: 8,\n      blue: 2,\n      green: 4\n    });\n    this.gamma(0.8);\n    this.contrast(5);\n    this.exposure(10);\n    this.newLayer(function() {\n      this.setBlendingMode('overlay');\n      this.copyParent();\n      this.opacity(55);\n      return this.filter.stackBlur(10);\n    });\n    return this.vignette(\"50%\", 30);\n  });\n\n  Caman.Filter.register(\"hemingway\", function() {\n    this.greyscale();\n    this.contrast(10);\n    this.gamma(0.9);\n    this.newLayer(function() {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(40);\n      this.copyParent();\n      this.filter.exposure(15);\n      this.filter.contrast(15);\n      return this.filter.channels({\n        green: 10,\n        red: 5\n      });\n    });\n    this.sepia(30);\n    this.curves('rgb', [0, 10], [120, 90], [180, 200], [235, 255]);\n    this.channels({\n      red: 5,\n      green: -2\n    });\n    return this.exposure(15);\n  });\n\n  Caman.Filter.register(\"concentrate\", function() {\n    this.sharpen(40);\n    this.saturation(-50);\n    this.channels({\n      red: 3\n    });\n    this.newLayer(function() {\n      this.setBlendingMode(\"multiply\");\n      this.opacity(80);\n      this.copyParent();\n      this.filter.sharpen(5);\n      this.filter.contrast(50);\n      this.filter.exposure(10);\n      return this.filter.channels({\n        blue: 5\n      });\n    });\n    return this.brightness(10);\n  });\n\n  Caman.Plugin.register(\"rotate\", function(degrees) {\n    var angle, canvas, ctx, height, to_radians, width, x, y;\n\n    angle = degrees % 360;\n    if (angle === 0) {\n      return this.dimensions = {\n        width: this.canvas.width,\n        height: this.canvas.height\n      };\n    }\n    to_radians = Math.PI / 180;\n    if (typeof exports !== \"undefined\" && exports !== null) {\n      canvas = new Canvas();\n    } else {\n      canvas = document.createElement('canvas');\n      Util.copyAttributes(this.canvas, canvas);\n    }\n    if (angle === 90 || angle === -270 || angle === 270 || angle === -90) {\n      width = this.canvas.height;\n      height = this.canvas.width;\n      x = width / 2;\n      y = height / 2;\n    } else if (angle === 180) {\n      width = this.canvas.width;\n      height = this.canvas.height;\n      x = width / 2;\n      y = height / 2;\n    } else {\n      width = Math.sqrt(Math.pow(this.originalWidth, 2) + Math.pow(this.originalHeight, 2));\n      height = width;\n      x = this.canvas.height / 2;\n      y = this.canvas.width / 2;\n    }\n    canvas.width = width;\n    canvas.height = height;\n    ctx = canvas.getContext('2d');\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle * to_radians);\n    ctx.drawImage(this.canvas, -this.canvas.width / 2, -this.canvas.height / 2, this.canvas.width, this.canvas.height);\n    ctx.restore();\n    return this.replaceCanvas(canvas);\n  });\n\n  Caman.Filter.register(\"rotate\", function() {\n    return this.processPlugin(\"rotate\", Array.prototype.slice.call(arguments, 0));\n  });\n\n  /*\n  StackBlur - a fast almost Gaussian Blur For Canvas v0.31 modified for CamanJS\n  \n  Version:   0.31\n  Author:    Mario Klingemann\n  Contact:   mario@quasimondo.com\n  Website:  http://www.quasimondo.com/StackBlurForCanvas\n  Twitter:  @quasimondo\n  Modified By: Ryan LeFevre (@meltingice)\n  \n  In case you find this class useful - especially in commercial projects -\n  I am not totally unhappy for a small donation to my PayPal account\n  mario@quasimondo.de\n  \n  Or support me on flattr: \n  https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n  \n  Copyright (c) 2010 Mario Klingemann\n  \n  Permission is hereby granted, free of charge, to any person\n  obtaining a copy of this software and associated documentation\n  files (the \"Software\"), to deal in the Software without\n  restriction, including without limitation the rights to use,\n  copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following\n  conditions:\n  \n  The above copyright notice and this permission notice shall be\n  included in all copies or substantial portions of the Software.\n  \n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n  WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n  */\n\n\n  (function() {\n    var BlurStack, mul_table, shg_table;\n\n    mul_table = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\n    shg_table = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n    BlurStack = function() {\n      this.r = 0;\n      this.g = 0;\n      this.b = 0;\n      this.a = 0;\n      return this.next = null;\n    };\n    Caman.Plugin.register(\"stackBlur\", function(radius) {\n      var b_in_sum, b_out_sum, b_sum, div, g_in_sum, g_out_sum, g_sum, height, heightMinus1, i, mul_sum, p, pb, pg, pixels, pr, r_in_sum, r_out_sum, r_sum, radiusPlus1, rbs, shg_sum, stack, stackEnd, stackIn, stackOut, stackStart, sumFactor, w4, width, widthMinus1, x, y, yi, yp, yw, _i, _j, _k, _l, _m, _n, _o, _p, _q;\n\n      if (isNaN(radius) || radius < 1) {\n        return;\n      }\n      radius |= 0;\n      pixels = this.pixelData;\n      width = this.dimensions.width;\n      height = this.dimensions.height;\n      div = radius + radius + 1;\n      w4 = width << 2;\n      widthMinus1 = width - 1;\n      heightMinus1 = height - 1;\n      radiusPlus1 = radius + 1;\n      sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n      stackStart = new BlurStack();\n      stack = stackStart;\n      for (i = _i = 1; 1 <= div ? _i < div : _i > div; i = 1 <= div ? ++_i : --_i) {\n        stack = stack.next = new BlurStack();\n        if (i === radiusPlus1) {\n          stackEnd = stack;\n        }\n      }\n      stack.next = stackStart;\n      stackIn = null;\n      stackOut = null;\n      yw = yi = 0;\n      mul_sum = mul_table[radius];\n      shg_sum = shg_table[radius];\n      for (y = _j = 0; 0 <= height ? _j < height : _j > height; y = 0 <= height ? ++_j : --_j) {\n        r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        stack = stackStart;\n        for (i = _k = 0; 0 <= radiusPlus1 ? _k < radiusPlus1 : _k > radiusPlus1; i = 0 <= radiusPlus1 ? ++_k : --_k) {\n          stack.r = pr;\n          stack.g = pg;\n          stack.b = pb;\n          stack = stack.next;\n        }\n        for (i = _l = 1; 1 <= radiusPlus1 ? _l < radiusPlus1 : _l > radiusPlus1; i = 1 <= radiusPlus1 ? ++_l : --_l) {\n          p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n          r_sum += (stack.r = (pr = pixels[p])) * (rbs = radiusPlus1 - i);\n          g_sum += (stack.g = (pg = pixels[p + 1])) * rbs;\n          b_sum += (stack.b = (pb = pixels[p + 2])) * rbs;\n          r_in_sum += pr;\n          g_in_sum += pg;\n          b_in_sum += pb;\n          stack = stack.next;\n        }\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (x = _m = 0; 0 <= width ? _m < width : _m > width; x = 0 <= width ? ++_m : --_m) {\n          pixels[yi] = (r_sum * mul_sum) >> shg_sum;\n          pixels[yi + 1] = (g_sum * mul_sum) >> shg_sum;\n          pixels[yi + 2] = (b_sum * mul_sum) >> shg_sum;\n          r_sum -= r_out_sum;\n          g_sum -= g_out_sum;\n          b_sum -= b_out_sum;\n          r_out_sum -= stackIn.r;\n          g_out_sum -= stackIn.g;\n          b_out_sum -= stackIn.b;\n          p = (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\n          r_in_sum += (stackIn.r = pixels[p]);\n          g_in_sum += (stackIn.g = pixels[p + 1]);\n          b_in_sum += (stackIn.b = pixels[p + 2]);\n          r_sum += r_in_sum;\n          g_sum += g_in_sum;\n          b_sum += b_in_sum;\n          stackIn = stackIn.next;\n          r_out_sum += (pr = stackOut.r);\n          g_out_sum += (pg = stackOut.g);\n          b_out_sum += (pb = stackOut.b);\n          r_in_sum -= pr;\n          g_in_sum -= pg;\n          b_in_sum -= pb;\n          stackOut = stackOut.next;\n          yi += 4;\n        }\n        yw += width;\n      }\n      for (x = _n = 0; 0 <= width ? _n < width : _n > width; x = 0 <= width ? ++_n : --_n) {\n        g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n        yi = x << 2;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        stack = stackStart;\n        for (i = _o = 0; 0 <= radiusPlus1 ? _o < radiusPlus1 : _o > radiusPlus1; i = 0 <= radiusPlus1 ? ++_o : --_o) {\n          stack.r = pr;\n          stack.g = pg;\n          stack.b = pb;\n          stack = stack.next;\n        }\n        yp = width;\n        for (i = _p = 1; 1 <= radius ? _p <= radius : _p >= radius; i = 1 <= radius ? ++_p : --_p) {\n          yi = (yp + x) << 2;\n          r_sum += (stack.r = (pr = pixels[yi])) * (rbs = radiusPlus1 - i);\n          g_sum += (stack.g = (pg = pixels[yi + 1])) * rbs;\n          b_sum += (stack.b = (pb = pixels[yi + 2])) * rbs;\n          r_in_sum += pr;\n          g_in_sum += pg;\n          b_in_sum += pb;\n          stack = stack.next;\n          if (i < heightMinus1) {\n            yp += width;\n          }\n        }\n        yi = x;\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (y = _q = 0; 0 <= height ? _q < height : _q > height; y = 0 <= height ? ++_q : --_q) {\n          p = yi << 2;\n          pixels[p] = (r_sum * mul_sum) >> shg_sum;\n          pixels[p + 1] = (g_sum * mul_sum) >> shg_sum;\n          pixels[p + 2] = (b_sum * mul_sum) >> shg_sum;\n          r_sum -= r_out_sum;\n          g_sum -= g_out_sum;\n          b_sum -= b_out_sum;\n          r_out_sum -= stackIn.r;\n          g_out_sum -= stackIn.g;\n          b_out_sum -= stackIn.b;\n          p = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width)) << 2;\n          r_sum += (r_in_sum += (stackIn.r = pixels[p]));\n          g_sum += (g_in_sum += (stackIn.g = pixels[p + 1]));\n          b_sum += (b_in_sum += (stackIn.b = pixels[p + 2]));\n          stackIn = stackIn.next;\n          r_out_sum += (pr = stackOut.r);\n          g_out_sum += (pg = stackOut.g);\n          b_out_sum += (pb = stackOut.b);\n          r_in_sum -= pr;\n          g_in_sum -= pg;\n          b_in_sum -= pb;\n          stackOut = stackOut.next;\n          yi += width;\n        }\n      }\n      return this;\n    });\n    return Caman.Filter.register(\"stackBlur\", function(radius) {\n      return this.processPlugin(\"stackBlur\", [radius]);\n    });\n  })();\n\n  Caman.Filter.register(\"threshold\", function(adjust) {\n    return this.process(\"threshold\", function(rgba) {\n      var luminance;\n\n      luminance = (0.2126 * rgba.r) + (0.7152 * rgba.g) + (0.0722 * rgba.b);\n      if (luminance < adjust) {\n        rgba.r = 0;\n        rgba.g = 0;\n        rgba.b = 0;\n      } else {\n        rgba.r = 255;\n        rgba.g = 255;\n        rgba.b = 255;\n      }\n      return rgba;\n    });\n  });\n\n}).call(this);\n"]},"metadata":{},"sourceType":"script"}